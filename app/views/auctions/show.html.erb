<script src='/assets/auctions.js'></script>
<br>
<br>



<br>
<div class = "details">
<strong>Amount:</strong> $<%= @auction.amount %><br>
<strong>Category:</strong> <%= @auction.category %><br>



<strong>Time Remaining:</strong><div id="countdowntimertxt" class="countdowntimer">00:00:00</div>
</div>
<br>


<div class = "bid">
    <div class="open-modal">
    <button><a href="#openModal">BID NOW</a></button>
    </div>
</div>
    <div id="openModal" class="modalDialog">
    <div>
    <a href="#close" title="Close" class="close"></a>
    <!-- <p><%# if (current_user == nil) %> -->
        <div>
           
             
              <%= form_for @photo, as: :photo, url: photo_create_path, method: :post do |f| %>
                <%= f.hidden_field :auction_id, :value => @auction.id %>
                <%= f.hidden_field :user_id, :value => @current_user.id %>
                <div>
                    Name: <%= f.text_area :name, class: "form-control" %>
                </div><br>
                <div>
                    Upload Image: <%= f.file_field :image, class: "form-control" %>
                </div><br>
                <div>
                    Description: <%= f.text_area :description, class: "form-control" %>
                </div><br>
            
                <div><%= submit_tag("Post New Item", class: "btn btn-danger") %></div>
                <br>
             <% end %> 
            
        </div>
    </div>
</div>

   
            <div class="row">       
                <h1 id="index_title">Current Bids</h1>

                <% @photos.each do |j| %>
                    <div class="thumbs">
                     
                        <h2>Name:</h2> <h3><%= j.name %></h3><br> 
                        <%= link_to image_tag(j.image, size: "200x190"), photo_path(j) %>  
                        <h2>Description:</h2> <h3><%= j.description %></h3><br> 
                    </div>
                <% end %> 

            </div>              
   

</div>
  <div class="buttons">
    <span class="cash-button">
       <%= link_to "Put up some CA$H", new_auction_path, :method => :get %>
    </span>
    <span class="shopping-button">
       <%= link_to "Start Selling", auctions_path, :method => :get %>
    </span>  
  </div>

  <br>
  <br>
  <br>
  <div>
   <span class="dashboard-button">
       <%= link_to "Your Dashboard", dashboard_path, :method => :get %>
   </span> 
  </div> 

    
    <script>
    // var time = <%=raw @auction.created_at.to_i %>
    var aucCreated = <%=raw (@auction.created_at.to_f * 1000).to_i %>
    var auctionLength = <%=raw (@auction.auction_period) %>
    console.log("auc length", auctionLength);
    console.log("when auc was created", aucCreated);
    var test = new Date();
    var testAgain = test.getTime();
    console.log("current time", testAgain);
    var timeLeft = (aucCreated+auctionLength) - testAgain;
    var timeElasped = testAgain - aucCreated;
    console.log(timeElasped);
    console.log("amt of time left", timeLeft);
    var sTime = new Date().getTime();
    console.log("what");
    //countDown is the time left of the auction
    var countDown = 3600;
     // Number of seconds to count down from.        
    // var eTime = sTime+(countDown * 1000);
    // console.log(eTime)
    Number.prototype.toFixedDown = function(digits) {
        var re = new RegExp("(\\d+\\.\\d{" + digits + "})(\\d)"),
            m = this.toString().match(re);
        return m ? parseFloat(m[1]) : this.valueOf();
    };
    var timeLeftAgain = (timeLeft/1000).toFixedDown(0);
    console.log(timeLeftAgain);
 
    function UpdateCountDownTime() {
        var cTime = new Date().getTime();
        console.log('this is running still');
        var diff = cTime - sTime;
        // var diff =
        var timeStr = '';
        // diff is the time to start counting down from
        var seconds = timeLeftAgain - Math.floor(diff/1000);
        if (seconds >= 0) {
            var hours = Math.floor(seconds / 3600);
            var minutes = Math.floor( (seconds-(hours*3600)) / 60);
            seconds -= (hours*3600) + (minutes*60);
            if( hours < 10 ){
                timeStr = "0" + hours;
            }else{
                timeStr = hours;
            }
            if( minutes < 10 ){
                timeStr = timeStr + ":0" + minutes;
            }else{
                timeStr = timeStr + ":" + minutes;
            }
            if( seconds < 10){
                timeStr = timeStr + ":0" + seconds;
            }else{
                timeStr = timeStr + ":" + seconds;
            }
            // console.log(seconds)
            document.getElementById("countdowntimertxt").innerHTML = timeStr;
        }else{
            document.getElementById("countdowntimertxt").style.display="none";
            clearInterval(counter);
        }
    }
    UpdateCountDownTime();
    //every .5 seconds run UpdateCountDownTime to display the clock
    var counter = setInterval(UpdateCountDownTime, 500);
    </script>