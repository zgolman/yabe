var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n();t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");if(t){t=t.split(" ")[1].split(",");T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)]}}else if(o<10){o++;setTimeout(arguments.callee,10);return}n.removeChild(r);s=null;M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312)){V(r,!0);if(i){s.success=!0;s.ref=_(r);i(s)}}else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall;u.width=o.getAttribute("width")||"0";u.height=o.getAttribute("height")||"0";o.getAttribute("class")&&(u.styleclass=o.getAttribute("class"));o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else{H(o);i&&i(s)}}else{V(r,!0);if(i){var p=_(r);if(p&&typeof p.SetVariable!=e){s.success=!0;s.ref=p}i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0;g=i||null;y={success:!1,id:r};var o=R(r);if(o){if(o.nodeName=="OBJECT"){v=B(o);m=null}else{v=o;m=r}t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew";c.setAttribute("id",r);o.parentNode.insertBefore(c,o);o.style.display="none";(function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)})()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e);t.parentNode.replaceChild(B(e),t);e.style.display="none";(function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)})()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>";p[p.length]=n.id;o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u);o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t);r.setAttribute("value",n);e.appendChild(r)}function I(e){var t=R(e);if(t&&t.nodeName=="OBJECT")if(T.ie&&T.win){t.style.display="none";(function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)})()}else t.parentNode.removeChild(t)}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n);d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");n[0]=parseInt(n[0],10);n[1]=parseInt(n[1],10)||0;n[2]=parseInt(n[2],10)||0;return t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";if(s){E=null;S=null}if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css");f.setAttribute("media",u);E=o.appendChild(f);T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]);S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t){g=f.plugins[n].description;if(g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)){l=!0;v=!1;g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1");m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10);m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10);m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}}else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);if(y){g=y.GetVariable("$version");if(g){v=!0;g=g.split(" ")[1].split(",");m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}}}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C();if(!b){typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1);if(T.ie&&T.win){a.attachEvent(o,function(){if(a.readyState=="complete"){a.detachEvent(o,arguments.callee);C()}});u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()}T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}();L(C)}}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e;i.swfVersion=t;i.expressInstall=n;i.callbackFn=r;h[h.length]=i;V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};if(T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o){V(r,!1);k(function(){i+="";s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n;p.width=i;p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0);h.success=!0;h.ref=y}else{if(u&&D()){p.data=u;P(p,v,r,c);return}V(r,!0)}c&&c(h)})}else c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);if(e&&v){e.parentNode.replaceChild(v,e);if(m){V(m,!0);T.ie&&T.win&&(v.style.display="block")}g&&g(y)}w=!1}}}}();(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;i.indexOf("drag")!==0&&(i="drag"+i);r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){i[e]!==undefined&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(e.data(this,r.datakey))return;var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)},teardown:function(){var n=e.data(this,r.datakey)||{};if(n.related)return;e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)},init:function(i){if(r.touched)return;var s=i.data,o;if(i.which!=0&&s.which>0&&i.which!=s.which)return;if(e(i.target).is(s.not))return;if(s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)return;r.touched=i.type=="touchstart"?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;o=r.hijack(i,"draginit",s);if(!s.propagates)return;o=r.flatten(o);if(o&&o.length){s.interactions=[];e.each(o,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);if(!r.touched||s.live)return!1},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var s=i.data;switch(i.type){case!s.dragging&&"touchmove":i.preventDefault();case!s.dragging&&"mousemove":if(Math.pow(i.pageX-s.pageX,2)+Math.pow(i.pageY-s.pageY,2)<Math.pow(s.distance,2))break;i.target=s.target;r.hijack(i,"dragstart",s);s.propagates&&(s.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(s.dragging){r.hijack(i,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(i,s);break}i.type="mouseup"};case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.hijack(i,"dragend",s)}r.textselect(!0);s.click===!1&&s.dragging&&e.data(s.mousedown,"suppress.click",(new Date).getTime()+5);s.dragging=r.touched=!1}},hijack:function(n,i,s,o,u){if(!s)return;var a={event:n.originalEvent,type:n.type},f=i.indexOf("drop")?"drag":"drop",l,c=o||0,h,p,d,v=isNaN(o)?s.interactions.length:o;n.type=i;n.originalEvent=null;s.results=[];do if(h=s.interactions[c]){if(i!=="dragend"&&h.cancelled)continue;d=r.properties(n,s,h);h.results=[];e(u||h[f]||s.droppable).each(function(o,u){d.target=u;n.isPropagationStopped=function(){return!1};l=u?t.dispatch.call(u,n,d):null;if(l===!1){if(f=="drag"){h.cancelled=!0;s.propagates-=1}i=="drop"&&(h[f][o]=null)}else i=="dropinit"&&h.droppable.push(r.element(l)||u);i=="dragstart"&&(h.proxy=e(r.element(l)||h.drag)[0]);h.results.push(l);delete n.result;if(i!=="dropinit")return l});s.results[c]=r.flatten(h.results);i=="dropinit"&&(h.droppable=r.flatten(h.droppable));i=="dragstart"&&!h.cancelled&&d.update()}while(++c<v);n.type=a.type;n.originalEvent=a.event;return r.flatten(s.results)},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(t&&"type"in t&&e.data(this,"suppress."+t.type)-(new Date).getTime()>0){e.removeData(this,"suppress."+t.type);return}return i.apply(this,arguments)};var s=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(s.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r})(jQuery);$.getObject("Pb.Component.Element.Toggle",!0).Toggle=function(){function e(e){this.init(e)}var t={container:null,dragging:!1,init:function(e){if(!e.container)return;this.container=$(e.container);this.bindEvents()},bindEvents:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".toggle");if(e.length&&t.length){this.initialOffset=e.offset().left;this.parentOffset=this.container.offset().left;e.drag("start",$.proxy(function(t,n){this.mouseOffset=t.pageX-e.offset().left;n.limit={};n.limit.left=3;n.limit.right=35;e.addClass("dragging")},this)).drag($.proxy(function(t,n){var r=t.pageX-this.parentOffset-this.mouseOffset,i=r;i<n.limit.left?i=n.limit.left:i>n.limit.right&&(i=n.limit.right);e.css({left:i})},this)).drag("end",$.proxy(function(n,r){this.preventClick=!0;n.stopPropagation();e.removeClass("dragging");var i=n.pageX-this.parentOffset,s=t.hasClass("on");i>r.limit.left+12&&!s||i<r.limit.right-12&&s?this.toggle():s?e.css("left",r.limit.right):e.css("left",r.limit.left)},this));t.on("click",$.proxy(function(){this.preventClick?this.preventClick=!1:this.toggle()},this))}},toggle:function(){var e=$(this.container).find(".ball"),t=$(this.container).find(".ballOn"),n=$(this.container).find(".ballOff"),r=$(this.container).find(".toggle");if(!r.hasClass("on")){r.addClass("on");e.css("left","35px");t.css("display","block");n.hide();this.container.trigger("Pb.Component.Element.Toggle.Toggle::on")}else{r.removeClass("on");e.css("left","3px");t.hide();n.css("display","block");this.container.trigger("Pb.Component.Element.Toggle.Toggle::off")}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Print",!0).PrintLink=function(){function e(e){this.init(e);this.bindAction()}var t={init:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".printAction",eventType:"click",event:"PrintLink::Print"}}));if(typeof PIO!="undefined"){$("#cartMenu .count").html(PIO.getNumItems());PIO.config({recipeId:Pb.Data.Shared.get("pioConfig").isAol?Pb.Data.Shared.get("pioConfig").aolRecipeId:Pb.Data.Shared.get("pioConfig").recipeId,url:Pb.Data.Shared.get("pioConfig").url,preload:{on:!0}})}$(window).on("popstate",$.proxy(function(e){var t=e.state||e.originalEvent.state;typeof PIO!="undefined"&&t&&t.category&&!t.product&&PIO.close()},this));$(document).on("click",".printCurrency",function(e){e.preventDefault();PIO.msg("show-currencies")}).on("click",".printUnits",function(e){e.preventDefault();PIO.msg("show-measures")}).on("click",".printShipping",function(e){e.preventDefault();PIO.msg("change-country")})},bindAction:function(){$(document).on("PrintLink::Print",$.proxy(function(e){if($(e.pbEventTarget).data("name")==="Flat Cards")window.location="/print/greetingcards";else if(typeof PIO!="undefined"){var t=this.buildPrintData(e);if(t){PIO.open(t);Pb.Track.tr("print_widget_open");$("html, body").animate({scrollTop:0},750)}}},this))},buildPrintData:function(e){var t,n=e.pbData,r=$(e.pbEventTarget),i={},s=Pb.Data.Shared.get("loggedInUser"),o=Pb.Data.Shared.get("pioConfig"),u=Pb.Data.get("secureUrl")+o.cssUrl,a=this,f=Pb.Data.Shared.get("pioConfig").url.replace("/widget/","").replace("http://","").replace("https://","");if(s&&s.baseCobaltUri){s.baseCobaltUri.substr(s.baseCobaltUri.length-1)!=="/"&&(s.baseCobaltUri+="/");i={pb_token:o.access_token,pb_refresh_token:o.refresh_token,pb_username:s.username,pb_base_uri:s.baseCobaltUri}}t={recipeId:Pb.Data.Shared.get("pioConfig").isAol?Pb.Data.Shared.get("pioConfig").aolRecipeId:Pb.Data.Shared.get("pioConfig").recipeId,canUseMap:!1,vars:i,url:Pb.Data.Shared.get("pioConfig").url,helpUrl:"http://support.photobucket.com/hc/en-us/categories/200154330-Print",embedInElement:document.getElementById("main"),productsUrl:Pb.Data.get("secureUrl")+"print",confirmationUrl:Pb.Data.get("secureUrl")+"print/confirmation",usePushState:!!history.pushState,fns:{onOpen:$.proxy(function(){$("#main > div, .hideInWidget").hide();$(".showInWidget").show();$("#footer, #main").addClass("inWidget");PIO.getNumItems()&&Pb.PageTracker.addGoogleAnalyticsPartnerEvent(Pb.Data.Shared.get("pioConfig").googleAccount,f,"print.io","widget","opened:With Items",PIO.getNumItems());a.addPrintAbandonmentWarning()},a),onClose:$.proxy(function(e){return a.currentTemplate==="tpl-product-a"||a.currentTemplate==="tpl-product-b"||a.orderId||a.currentTemplate==="tpl-cart"?!0:confirm("Any unsaved changes or items not in your cart will be lost. Are you sure you want to leave?")},a),onCartChange:$.proxy(function(e){$.cookie("pio",PIO.getNumItems(),{expires:7,domain:".photobucket.com",path:"/"});$(document).trigger("Printio::cartChanged")},a),onEvent:function(e,t){if(typeof console!="undefined"&&Pb.Data.get("version")==="development"){console.log("key: "+e);console.log(t);console.log("-------------------------------------------------")}if(e==="close"){$("#main > div, .hideInCart, .hideInWidget").show();$(".showInWidget, .showInCart").hide();$("#footer, #main").removeClass("inWidget");PIO.getNumItems()&&Pb.PageTracker.addGoogleAnalyticsPartnerEvent(Pb.Data.Shared.get("pioConfig").googleAccount,f,"print.io","widget","closed:With Items",PIO.getNumItems());a.removePrintAbandonmentWarning()}if(e==="section-init"){a.currentTemplate=t.tplName;if(t.tplName==="tpl-cart"||t.tplName==="tpl-shipping"||t.tplName==="tpl-shipment-review"||t.tplName==="tpl-address-validation"||t.tplName==="tpl-billing-a"){$(".hideInCart").hide();$(".showInCart").css("display","block")}else{$(".hideInCart").show();$(".showInCart").hide()}}e==="analytics-pageview"&&Pb.PageTracker.addGoogleAnalyticsPartnerPageView(Pb.Data.Shared.get("pioConfig").googleAccount,f,t.page,t.title,"print.io");if(e==="analytics-send"){PIO.close();$("body").html("");if(!a.paypal){document.location.href="/print/confirmation?orderid="+a.orderId;return}}e==="paypal"&&(a.paypal=!0);if(e==="onOrderSubmit"){a.orderId=t.id;$.cookie("pio",null,{expires:-1,domain:".photobucket.com",path:"/"})}}}};typeof u!="undefined"&&(t.style={cssUrl:u});if(r){r.data("product")&&$.extend(t,{items:[{productId:r.data("product"),templateName:r.data("templateid")?r.data("templateid"):"",sku:r.data("sku")?r.data("sku"):""}],goTo:"tpl-product-b"});r.data("customize")&&$.extend(t,{goToCustomize:!0});(r.data("template")||e.template)&&$.extend(t,{goTo:e.template?e.template:r.data("template")})}if(e.printProductTemplateData){var l=e.printProductTemplateData;$.extend(t,{items:[{productId:l.product,templateName:l.templateName,sku:l.sku}],goTo:l.goto})}if(!n)return t;switch(n.pbdkey){case Pb.Data.Shared.MEDIA:var c=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA);if(c.mediaType==="image"&&c.cp){$.extend(t,{images:[c.originalUrl.replace("http://i","http://oi")]});return t}break;case Pb.Data.Shared.ALBUM:var h=Pb.Data.Shared.get(Pb.Data.Shared.ALBUM),p="/api/user/"+h.ownername+"/album/"+h.location+"/media/print";Pb.Ajax.ajax({url:p,type:"get",success:function(e){$.extend(t,{images:e.data});PIO.open(t);Pb.Track.tr("print_widget_open")},error:function(){PIO.open(t);Pb.Track.tr("print_widget_open")},messageHandler:function(){return!0}});break;default:return t}},warnOnPageUnload:function(e){if(this.currentTemplate==="tpl-product-a"||this.currentTemplate==="tpl-product-b"||this.orderId||this.currentTemplate==="tpl-cart")return;return e.returnValue='Any unsaved changes or items not in your cart will be lost. Are you sure you want to leave?"'},addPrintAbandonmentWarning:function(){this.pageLevelAbandonmentEvents=[];$._data(window,"events").beforeunload&&$.each($._data(window,"events").beforeunload,$.proxy(function(e,t){if(t){this.pageLevelAbandonmentEvents.push(t);t.namespace?$(window).off("beforeunload."+t.namespace):$(window).off("beforeunload")}},this));$(window).on("beforeunload.printAbandonment",$.proxy(this.warnOnPageUnload,this))},removePrintAbandonmentWarning:function(){$(window).off(".printAbandonment");this.pageLevelAbandonmentEvents&&this.pageLevelAbandonmentEvents.length&&$.each(this.pageLevelAbandonmentEvents,function(e,t){t.namespace?$(window).on("beforeunload."+t.namespace,t.handler):$(window).on("beforeunload",t.handler)})}},n;$.extend(e.prototype,t);Pb.InitEventQueue.addToDomReady(function(){n=new e},Pb.InitEventQueue.HIGH_PRIORITY);return e}();$.getObject("Pb",!0).DetailInit=function(){function e(e){var n=Pb.Data.get(Pb.Data.Shared.MEDIA).fullsizeUrl,r;r={mediaUrl:n,firstFetch:!0};Pb.Ajax.ajax({url:e,data:r,type:"get",success:$.proxy(function(e){var n=Pb.Data.get(Pb.Data.Shared.MEDIA),r=e.mediaData;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,r,"",!1);var i=e.fetcherData.currentOffset;if(r.hasOwnProperty(i)&&Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[i].fullsizeUrl===r[i].fullsizeUrl)t(n,i);else for(var s in Pb.Data.get(Pb.Data.Shared.MEDIA_SET))if(Pb.Data.get(Pb.Data.Shared.MEDIA_SET).hasOwnProperty(s)&&Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[s].fullsizeUrl===r[s].fullsizeUrl){i=s;t(n,s);break}var o=$("#stotal");if(o.length>0){o.html(e.fetcherData.total);$(".breadcrumbNav .breadcrumb").css("visibility","visible")}var u=$.Event("Detail::first_batch_received",{currentOffset:i,fetcherData:e.fetcherData,filmStripData:e.filmStripData});$(document).trigger(u)},this)})}function t(e,t){var n=Pb.Data.get(Pb.Data.Shared.MEDIA_SET)[t];n.placeHold=!1;n.fsWidth=e.fsWidth;n.fsHeight=e.fsHeight;n.rsWidth=e.rsWidth;n.rsHeight=e.rsHeight;n.offset=t;n.thumbUrl=e.thumbUrl;n.fullsizeUrl=e.fullsizeUrl;Pb.Data.add(Pb.Data.Shared.MEDIA,n)}function n(){typeof Pb.Component.Common!="undefined"&&typeof Pb.Component.Common.Comments!="undefined"&&new Pb.Component.Common.Comments({commentTarget:Pb.Data.Shared.get(Pb.Data.Shared.MEDIA)});var e=$.Event("Pb.Component.Detail.Detail::current_media_update",{newTarget:Pb.Data.get(Pb.Data.Shared.MEDIA)}),t=Pb.Data.get(Pb.Data.Shared.MEDIA);promoImageThumb=$(".promoImage");if(t){var n=t.path.split(".").pop().toLowerCase();if(t.mediaType==="image"&&n!=="gif"&&t.cp){$(".printPromoContainer").show();$(".framedPromoLink").attr("href","/print/homedecor/framedprints?media="+encodeURI(t.linkUrl));$(".canvasPromoLink").attr("href","/print/homedecor/canvasprints?media="+encodeURI(t.linkUrl));$(".cardPromoLink").attr("href","/print/greetingcards");t.fsHeight>t.fsWidth?promoImageThumb.attr("style","background-position: initial; background-image: url('"+t.fullsizeUrl+"');"):promoImageThumb.attr("style","background-position: center; background-image: url('"+t.fullsizeUrl+"');")}else $(".printPromoContainer").hide()}$(document).trigger(e)}return{init:e,initPrivate:n}}();$.getObject("Pb.Component.Detail",!0).Fetcher=function(){function e(e){this.init(e)}var t={libData:null,offset:null,prevOffset:null,total:null,direction:null,context:null,filters:null,init:function(e){this.offset=e.currentOffset;this.prevOffset=this.offset;this.total=e.total;this.context=e.context;this.query=e.query;Pb.Data.add("detailQuery",this.query);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();this.bindEvents()},setLibDataMinMax:function(){var e=0,t,n,r,i=this.convertToArray(this.libData);for(r in i)if(i.hasOwnProperty(r)){if(r==="pbdkey")continue;e===0&&(t=parseInt(i[r].id,10));n=parseInt(i[r].id,10);e++}Pb.Data.add("libDataMin",t);Pb.Data.add("libDataMax",n);Pb.Data.add("libDataCount",e)},bindEvents:function(){$(document).on("Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.Detail.MediaManager::media_manager_update",$.proxy(this.handleSlideUpdate,this));$(document).on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",$.proxy(this.handleSlideUpdate,this))},handleSlideUpdate:function(e){this.fetchMore(e)},fetchMore:function(e){var t="/component/Detail-"+this.context,n=e.dir,r,i;t+="?"+this.query;!e.startOffset&&e.startOffset!==0?r=n===-1?Pb.Data.get("libDataMin"):Pb.Data.get("libDataMax")+1:r=e.startOffset;i={offset:r,dir:n};Pb.Ajax.ajax({url:t,data:i,type:"get",success:$.proxy(function(e){var t,r,i;if(Object.keys(e).length>0){r=this.findRange(e,n);if(!r)return;n===-1?t=this.prependToData(e):t=this.appendToData(e);Pb.Data.Shared.put(Pb.Data.Shared.MEDIA_SET,t,"",!1);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.setLibDataMinMax();i=$.Event("Pb.Component.Detail.Fetcher::libdata_update",{dir:n,startOffset:r.low,endOffset:r.high});$(document).trigger(i)}},this)})},prependToData:function(e){var t=$.extend(e,this.libData);return t},appendToData:function(e){var t=$.extend(this.libData,e);return t},findRange:function(e,t){var n,r,i=0,s=this.findCount(e)-1;if(t===-1)for(n in e){if(this.libData.hasOwnProperty(n)){i++;continue}if(e.hasOwnProperty(n)){r={low:parseInt(n,10),high:parseInt(n,10)+s-i};return r}}else{var o=1;for(n in e){n=parseInt(n,10)+s-o+1;n=n.toString();o+=2;if(this.libData.hasOwnProperty(n)){i++;continue}if(e.hasOwnProperty(n)){r={low:parseInt(n,10)+i-s,high:parseInt(n,10)};return r}}}},findCount:function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},convertToArray:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t.sort(function(e,t){return parseInt(e.id,10)-parseInt(t.id,10)})}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Detail",!0).Detail=function(){function e(e){this.init(e)}var t={oldData:null,currentData:null,mediaSet:null,currentOffset:null,context:null,linkCodesInited:!1,profilePic:null,profileOwnerName:null,profileLink:null,likeCnt:null,viewCnt:null,commentCnt:null,linksHeading:null,description:null,isMobile:!1,loggedInUser:null,isFollowing:!1,promoImageThumb:null,cardPromoLink:null,framedPromoLink:null,canvasPromoLink:null,profilePicUrl:"/component/Common-ProfilePic-ProfilePic",init:function(e){this.currentData=Pb.Data.get(Pb.Data.Shared.MEDIA);this.mediaSet=Pb.Data.get(Pb.Data.Shared.MEDIA_SET);this.onView();typeof e.currentIndex!="undefined"&&(this.currentOffset=parseInt(e.currentIndex,10));e.context&&(this.context=e.context);if(this.currentData.isFollowing){$("a.follow").text("");$("a.follow").append("<span>Following</span>")}this.isMobile=Pb.Data.get("isMobile");this.loggedInUser=Pb.Data.get("loggedInUserData");this.mediaDesc=$(".mediaDescription").first();this.currentData.hashtagMedia?this.mediaDesc.hide():this.mediaDesc.show();this.updatePageState();this.getUpdateableElements();this.attachSharedKey();this.updatePrintPromos();Pb.Component.Ad.AdRefresh.initMediaDetail();this.bindEvents();$("#linksHelp").tooltip({placement:"left",delay:{show:300,hide:100}})},updatePageState:function(){var e={offset:this.currentOffset},t=document.location.href,n=t.indexOf("?")!==-1?document.location.href.slice(window.location.href.indexOf("?")):"",r=this.currentData.linkUrl+n,i={replace:!0,state:e,url:r,title:$("title").text()};$(document).trigger($.Event("HistoryManager::updatePageHistory",i))},getUpdateableElements:function(){this.profilePic=$(".profileWrapper img.avatar");this.profileOwnerName=$("#profileOwnerName");this.profileLink=this.profileOwnerName.parent();this.profileImgLink=$(".profileWrapper a");this.likeCnt=$("#likeCount");this.viewCnt=$("#viewCount");this.commentCnt=$("#commentCount");this.linksHeading=$(".sidebar div.linkcodes").parent().find(".accordion-heading a");this.followLink=$("a.follow");this.promoImageThumb=$(".promoImage");this.cardPromoLink=$(".cardPromoLink");this.framedPromoLink=$(".framedPromoLink");this.canvasPromoLink=$(".canvasPromoLink");var e=$(".mediaDescription"),t=e.find("span.editable-field").first();t.length>0?this.description=t:this.description=e},attachSharedKey:function(){Pb.Data.Shared.attach($(".detailWrapper"),Pb.Data.Shared.MEDIA)},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",$.proxy(this.handleCurrentMediaUpdate,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.updatePageElements,this));e.on("Pb.Component.Common.Follow.FollowAction::action_complete",$.proxy(this.handleUpdateFollowing,this));History.Adapter.bind(window,"statechange",$.proxy(this.checkHistory,this));this.bindDescription();e.on("click",".comment-post",function(){Pb.Track.tr("detailpage_comment_post_click")});if(typeof Pb.Animation!="undefined"){var t=.2*window.innerWidth,n=75>t?t:75;$("#mediaTemplate").swipe({swipeLeft:function(){$(document).trigger($.Event("Pb.Component.Media.Media::media_next_swipe"))},swipeRight:function(){$(document).trigger($.Event("Pb.Component.Media.Media::media_previous_swipe"))},allowPageScroll:"vertical",maxTimeThreshold:5e3,fingers:1,threshold:n});Pb.Animation.setTransitionEndEvent(".slideContainer .slides",$.proxy(this.triggerMediaUpdate,this))}},bindDescription:function(){var e=this;this.mediaDesc=$(".mediaDescription .editable-field").first();this.mediaDesc.length>0&&this.mediaDesc.editInPlace({callback:function(t,n,r){e.saveDescription(n,r);n===""&&(n="Click to add description");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add description",field_type:"textarea",pb_track:function(){Pb.Track.trf("detailpage_description_click")},pb_validation:function(e,t){var n=!0;e=$.trim(e);if(e.length>2048){var r={status:0,message:"Description cannot be more than 2048 characters",details:""};Pb.Component.Element.Message.show(r);n=!1}return n}})},checkHistory:function(e){var t,n,r=History.getState();if(typeof r!="object")return;t=r.data.offset;if(typeof t!="undefined"&&this.currentOffset!==t){n=$("#thumb_"+t).find("a");if(n.length>0)n.trigger("click",["prevnextclick"]);else{var i={};i.oldOffset=this.currentOffset;i.currentOffset=t;this.handleCurrentMediaUpdate(i)}}},handleCurrentMediaUpdate:function(e){var t=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.oldData=t[e.oldOffset];this.currentData=t[e.currentOffset];this.currentOffset=e.currentOffset;Pb.Data.Shared.put(Pb.Data.Shared.MEDIA,this.currentData);var n={offset:e.currentOffset},r,i,s,o,u=this.currentData.mediaType==="image"?"photo":this.currentData.mediaType,a=this.currentData.title.length>0?this.currentData.title:this.currentData.name;if($("html").hasClass("is_ie8")){r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");s=r.indexOf("&_suid");r=r.substring(i,s)}else{r=document.location.href.slice(window.location.href.indexOf("#")+1);i=r.indexOf("?");r=i!==-1?r.substring(i):""}r=r.replace("o="+e.oldOffset,"o="+e.currentOffset);o={state:n,url:this.currentData.linkUrl.split("photobucket.com").pop()+r,title:a+" "+u+" by "+this.currentData.ownername};$(document).trigger($.Event("HistoryManager::updatePageHistory",o));typeof Pb.Animation!="undefined"&&e.oldOffset!==e.currentOffset&&Math.abs(e.oldOffset-e.currentOffset)<=1?this.animateToMedia(e):this.triggerMediaUpdate();Pb.Data.has("featureTrackingKey")&&Pb.Track.tr("detail_page_"+Pb.Data.get("featureTrackingKey")+"_view");Pb.Track.tr("detail_page_view");Pb.Track.trf("detail_pagination_click");Pb.Track.trl("media_detail_views");typeof Pb.PageTracker!="undefined"&&Pb.PageTracker.trackPageView({pb_pg:"detail"});typeof Pb.MobilePageTracker!="undefined"&&Pb.MobilePageTracker.trackPageView("mobiledetail")},triggerMediaUpdate:function(){var e=$.Event("Pb.Component.Detail.Detail::current_media_update");e.newTarget=this.currentData;$(document).trigger(e)},animateToMedia:function(e){var t=0,n=e.oldOffset<e.currentOffset?1:-1,r=0,i=$(".currentMedia"),s=$(".slideContainer").find(".slides");s.find(".mediawrapper").each(function(e,t){r+=$(t).width()});s.width(r);if(i.length){t=i.width()*n*-1;Pb.Animation.setSwipeAnimation(s,t,!0)}},updatePageElements:function(){this.updateProfile();this.updateLinkCodes();this.updateDescription();this.updateFollowButton();this.updateFlagButton();this.updatePrintPromos();setTimeout($.proxy(this.onView,this))},updateLinkCodes:function(){if(Pb.Component.Common&&Pb.Component.Common.Links){if(!this.linkCodesInited){$(".link-container").empty();var e=new Pb.Component.Common.Links.LinkCodes({selector:".link-container",prefix:"linksModule"});this.linkCodesInited=!0}$(".link-container").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:this.currentData});var t=this.currentData.mediaType;t=t.charAt(0).toUpperCase()+t.slice(1);this.linksHeading.text(t+" Links")}},updateProfile:function(){if(this.profileOwnerName.text()!==this.currentData.ownername){this.updateProfilePic();this.profileOwnerName.html(this.currentData.ownername);this.profileLink.attr("href",this.currentData.ownerprofilelink);this.profileImgLink.attr("href",this.currentData.ownerprofilelink)}},updateProfilePic:function(){if(!this.currentData.profilePicUrl){var e={url:this.profilePicUrl,type:"GET",data:{username:this.currentData.ownername,json:1},success:$.proxy(function(e){if(e.url){this.currentData.profilePicUrl=e.url;this.profilePic.attr("src",e.url)}},this)};Pb.Ajax.ajax(e)}else this.profilePic.attr("src",this.currentData.profilePicUrl)},updateDescription:function(){this.mediaDesc=$(".mediaDescription").first();if(this.currentData.hashtagMedia){this.mediaDesc.hide();return}this.mediaDesc.show();var e=this.description.find(".inplace_cancel");e.length>0&&e.trigger("click");if(this.isMobile){this.description.text(this.currentData.description);return}var t=this.currentData.description?this.currentData.description:this.currentData.io?"Click to add description":"";this.description.text(t);this.currentData.io&&this.bindDescription()},updatePrintPromos:function(){if(this.currentData){var e=this.currentData.path.split(".").pop().toLowerCase();if(this.currentData.mediaType==="image"&&e!=="gif"&&this.currentData.cp){$(".printPromoContainer").show();this.framedPromoLink.attr("href","/print/homedecor/framedprints?media="+encodeURI(this.currentData.linkUrl));this.canvasPromoLink.attr("href","/print/homedecor/canvasprints?media="+encodeURI(this.currentData.linkUrl));this.cardPromoLink.attr("href","/print/greetingcards");this.currentData.fsHeight>this.currentData.fsWidth?this.promoImageThumb.attr("style","background-position: initial; background-image: url('"+this.currentData.fullsizeUrl+"');"):this.promoImageThumb.attr("style","background-position: center; background-image: url('"+this.currentData.fullsizeUrl+"');")}else $(".printPromoContainer").hide()}},updateFollowButton:function(){var e=this.mediaSet[this.currentOffset],t=this.followLink;if(e)var n=e.isFollowing;if(t.length>0){t.attr("data-followee",this.currentData.ownername);this.loggedInUser&&(this.currentData.ownername===this.loggedInUser.username?t.hide():t.show())}if(!t.hasClass("disabled"))if(n){t.addClass("following");t.removeClass("btn-primary");t.text(""),t.append("<span>Following</span>")}else{t.removeClass("following");t.addClass("btn-primary");t.removeClass("btn-secondary");t.text("");t.append("<span>Follow</span>")}},handleUpdateFollowing:function(e){var t=Pb.Data.Shared.get("shared.mediaSet");this.updateMediaSet(t,this.currentOffset,"isFollowing",!e.action)},updateMediaSet:function(e,t,n,r){var i=e[t],s=Object.keys(e);for(var o=0,u=s.length;o<u;o+=1){var a=e[s[o]];a.ownername===i.ownername&&(a[n]=r)}},updateFlagButton:function(){var e=$("#flagBox");e.length>0&&this.loggedInUser&&(this.currentData.ownername===this.loggedInUser.username?e.hide():e.show())},onView:function(){if(!this.currentData.isPersisted)return;var e="/action/media/onView",t={mediaUrl:this.currentData.fullsizeUrl};Pb.Ajax.ajax({url:e,data:t,success:$.proxy(function(e){return e.status===1?!0:!1},this)})},saveDescription:function(e,t){var n="/action/media/updateDescription",r={description:e,mediaUrl:this.currentData.fullsizeUrl};Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentData.description=e.data.description;this.currentData.isPersisted=!0;return!0}return!1},this)})}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImagePreloader=function(){function e(e){this.init(e)}var t={pb_loadContainer:null,pb_dims:{},totalCount:0,completedCount:0,completedEventName:null,memo:null,init:function(e){},preLoad:function(e,t,n){this.totalCount=t.length;this.completedEventName=e;this.pb_dims[this.completedEventName]={};n&&(this.memo=n);this.checkPreloadContainer();var r=this;for(var i=0;i<t.length;i++){var s=$('<img id="preload_'+(e+i)+'" src="'+t[i]+'" />');this.pb_loadContainer.append(s);if(s[0].complete)this.handlePreLoadedImage(s);else{s[0].onload=function(){s=$(this);r.handlePreLoadedImage(s)};s[0].onerror=function(){s=$(this);r.handleImageLoadError(s)}}}},handlePreLoadedImage:function(e){if(this.completedCount===this.totalCount)return;var t={width:e.width(),height:e.height()},n=e.attr("src");this.pb_dims[this.completedEventName][n]=t;this.completedCount++;this.checkComplete()},handleImageLoadError:function(e){if(this.completedCount===this.totalCount)return;var t={width:0,height:0};this.pb_dims[this.completedEventName][e.attr("src")]=t;this.completedCount++;this.checkComplete()},checkComplete:function(){if(this.completedCount==this.totalCount){var e=$.Event(this.completedEventName);e.dimensions=this.pb_dims[this.completedEventName];this.memo&&(e.memo=this.memo);$(document).trigger(e)}},get:function(e){return this.pb_dims[this.completedEventName][e]},checkPreloadContainer:function(){this.pb_loadContainer=$("#pbPreload");if(this.pb_loadContainer.length===0){$("body").append('<div id="pbPreload" style="overflow:hidden; position:absolute; width: 1px; height: 0px; top: -10px; left: -10px;"></div>');this.pb_loadContainer=$("#pbPreload")}}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).ClientImageRescaler=function(){function e(e){this.init(e)}var t={maxWidth:null,maxHeight:null,init:function(e){if(e){e.width&&(this.maxWidth=e.width);e.height&&(this.maxHeight=e.height)}},setMaxWidth:function(e){this.maxWidth=e},setMaxHeight:function(e){this.maxHeight=e},rescale:function(e){var t=e.width,n=e.height;if(t>this.maxWidth){n=this.maxWidth*n/t;t=this.maxWidth}if(n>this.maxHeight){t=t/n*this.maxHeight;n=this.maxHeight}return{width:t,height:n}}};$.extend(e.prototype,t);return e}();(function(e,t){"use strict";var n=e.History=e.History||{},r=e.jQuery;if(typeof n.Adapter!="undefined")throw new Error("History.js Adapter has already been loaded...");n.Adapter={bind:function(e,t,n){r(e).bind(t,n)},trigger:function(e,t,n){r(e).trigger(t,n)},extractEventData:function(e,n,r){var i=n&&n.originalEvent&&n.originalEvent[e]||r&&r[e]||t;return i},onDomLoad:function(e){r(e)}};typeof n.init!="undefined"&&n.init()})(window);(function(e,t){"use strict";var n=e.document,r=e.setTimeout||r,i=e.clearTimeout||i,s=e.setInterval||s,o=e.History=e.History||{};if(typeof o.initHtml4!="undefined")throw new Error("History.js HTML4 Support has already been loaded...");o.initHtml4=function(){if(typeof o.initHtml4.initialized!="undefined")return!1;o.initHtml4.initialized=!0;o.enabled=!0;o.savedHashes=[];o.isLastHash=function(e){var t=o.getHashByIndex(),n;n=e===t;return n};o.saveHash=function(e){if(o.isLastHash(e))return!1;o.savedHashes.push(e);return!0};o.getHashByIndex=function(e){var t=null;typeof e=="undefined"?t=o.savedHashes[o.savedHashes.length-1]:e<0?t=o.savedHashes[o.savedHashes.length+e]:t=o.savedHashes[e];return t};o.discardedHashes={};o.discardedStates={};o.discardState=function(e,t,n){var r=o.getHashByState(e),i;i={discardedState:e,backState:n,forwardState:t};o.discardedStates[r]=i;return!0};o.discardHash=function(e,t,n){var r={discardedHash:e,backState:n,forwardState:t};o.discardedHashes[e]=r;return!0};o.discardedState=function(e){var t=o.getHashByState(e),n;n=o.discardedStates[t]||!1;return n};o.discardedHash=function(e){var t=o.discardedHashes[e]||!1;return t};o.recycleState=function(e){var t=o.getHashByState(e);o.discardedState(e)&&delete o.discardedStates[t];return!0};if(o.emulated.hashChange){o.hashChangeInit=function(){o.checkerFunction=null;var t="",r,i,u,a;if(o.isInternetExplorer()){r="historyjs-iframe";i=n.createElement("iframe");i.setAttribute("id",r);i.style.display="none";n.body.appendChild(i);i.contentWindow.document.open();i.contentWindow.document.close();u="";a=!1;o.checkerFunction=function(){if(a)return!1;a=!0;var n=o.getHash()||"",r=o.unescapeHash(i.contentWindow.document.location.hash)||"";if(n!==t){t=n;if(r!==n){u=r=n;i.contentWindow.document.open();i.contentWindow.document.close();i.contentWindow.document.location.hash=o.escapeHash(n)}o.Adapter.trigger(e,"hashchange")}else if(r!==u){u=r;o.setHash(r,!1)}a=!1;return!0}}else o.checkerFunction=function(){var n=o.getHash();if(n!==t){t=n;o.Adapter.trigger(e,"hashchange")}return!0};o.intervalList.push(s(o.checkerFunction,o.options.hashChangeInterval));return!0};o.Adapter.onDomLoad(o.hashChangeInit)}if(o.emulated.pushState){o.onHashChange=function(t){var r=t&&t.newURL||n.location.href,i=o.getHashByUrl(r),s=null,u=null,a=null,f;if(o.isLastHash(i)){o.busy(!1);return!1}o.doubleCheckComplete();o.saveHash(i);if(i&&o.isTraditionalAnchor(i)){o.Adapter.trigger(e,"anchorchange");o.busy(!1);return!1}s=o.extractState(o.getFullUrl(i||n.location.href,!1),!0);if(o.isLastSavedState(s)){o.busy(!1);return!1}u=o.getHashByState(s);f=o.discardedState(s);if(f){o.getHashByIndex(-2)===o.getHashByState(f.forwardState)?o.back(!1):o.forward(!1);return!1}o.pushState(s.data,s.title,s.url,!1);return!0};o.Adapter.bind(e,"hashchange",o.onHashChange);o.pushState=function(t,r,i,s){if(o.getHashByUrl(i))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(s!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.pushState,args:arguments,queue:s});return!1}o.busy(!0);var u=o.createStateObject(t,r,i),a=o.getHashByState(u),f=o.getState(!1),l=o.getHashByState(f),c=o.getHash();o.storeState(u);o.expectedStateId=u.id;o.recycleState(u);o.setTitle(u);if(a===l){o.busy(!1);return!1}if(a!==c&&a!==o.getShortUrl(n.location.href)){o.setHash(a,!1);return!1}o.saveState(u);o.Adapter.trigger(e,"statechange");o.busy(!1);return!0};o.replaceState=function(e,t,n,r){if(o.getHashByUrl(n))throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(r!==!1&&o.busy()){o.pushQueue({scope:o,callback:o.replaceState,args:arguments,queue:r});return!1}o.busy(!0);var i=o.createStateObject(e,t,n),s=o.getState(!1),u=o.getStateByIndex(-2);o.discardState(s,i,u);o.pushState(i.data,i.title,i.url,!1);return!0}}o.emulated.pushState&&o.getHash()&&!o.emulated.hashChange&&o.Adapter.onDomLoad(function(){o.Adapter.trigger(e,"hashchange")})};typeof o.init!="undefined"&&o.init()})(window);(function(e,t){"use strict";var n=e.console||t,r=e.document,i=e.navigator,s=e.sessionStorage||!1,o=e.setTimeout,u=e.clearTimeout,a=e.setInterval,f=e.clearInterval,l=e.JSON,c=e.alert,h=e.History=e.History||{},p=e.history;l.stringify=l.stringify||l.encode;l.parse=l.parse||l.decode;if(typeof h.init!="undefined")throw new Error("History.js Core has already been loaded...");h.init=function(){if(typeof h.Adapter=="undefined")return!1;typeof h.initCore!="undefined"&&h.initCore();typeof h.initHtml4!="undefined"&&h.initHtml4();return!0};h.initCore=function(){if(typeof h.initCore.initialized!="undefined")return!1;h.initCore.initialized=!0;h.options=h.options||{};h.options.hashChangeInterval=h.options.hashChangeInterval||100;h.options.safariPollInterval=h.options.safariPollInterval||500;h.options.doubleCheckInterval=h.options.doubleCheckInterval||500;h.options.storeInterval=h.options.storeInterval||1e3;h.options.busyDelay=h.options.busyDelay||250;h.options.debug=h.options.debug||!1;h.options.initialTitle=h.options.initialTitle||r.title;h.intervalList=[];h.clearAllIntervals=function(){var e,t=h.intervalList;if(typeof t!="undefined"&&t!==null){for(e=0;e<t.length;e++)f(t[e]);h.intervalList=null}};h.debug=function(){(h.options.debug||!1)&&h.log.apply(h,arguments)};h.log=function(){var e=typeof n!="undefined"&&typeof n.log!="undefined"&&typeof n.log.apply!="undefined",t=r.getElementById("log"),i,s,o,u,a;if(e){u=Array.prototype.slice.call(arguments);i=u.shift();typeof n.debug!="undefined"?n.debug.apply(n,[i,u]):n.log.apply(n,[i,u])}else i="\n"+arguments[0]+"\n";for(s=1,o=arguments.length;s<o;++s){a=arguments[s];if(typeof a=="object"&&typeof l!="undefined")try{a=l.stringify(a)}catch(f){}i+="\n"+a+"\n"}if(t){t.value+=i+"\n-----\n";t.scrollTop=t.scrollHeight-t.clientHeight}else e||c(i);return!0};h.getInternetExplorerMajorVersion=function(){var e=h.getInternetExplorerMajorVersion.cached=typeof h.getInternetExplorerMajorVersion.cached!="undefined"?h.getInternetExplorerMajorVersion.cached:function(){var e=3,t=r.createElement("div"),n=t.getElementsByTagName("i");while((t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&n[0]);return e>4?e:!1}();return e};h.isInternetExplorer=function(){var e=h.isInternetExplorer.cached=typeof h.isInternetExplorer.cached!="undefined"?h.isInternetExplorer.cached:Boolean(h.getInternetExplorerMajorVersion());return e};h.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in r)||h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8)};h.enabled=!h.emulated.pushState;h.bugs={setHash:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!h.emulated.pushState&&i.vendor==="Apple Computer, Inc."&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(h.isInternetExplorer()&&h.getInternetExplorerMajorVersion()<7)};h.isEmptyObject=function(e){for(var t in e)return!1;return!0};h.cloneObject=function(e){var t,n;if(e){t=l.stringify(e);n=l.parse(t)}else n={};return n};h.getRootUrl=function(){var e=r.location.protocol+"//"+(r.location.hostname||r.location.host);if(r.location.port||!1)e+=":"+r.location.port;e+="/";return e};h.getBaseHref=function(){var e=r.getElementsByTagName("base"),t=null,n="";if(e.length===1){t=e[0];n=t.href.replace(/[^\/]+$/,"")}n=n.replace(/\/+$/,"");n&&(n+="/");return n};h.getBaseUrl=function(){var e=h.getBaseHref()||h.getBasePageUrl()||h.getRootUrl();return e};h.getPageUrl=function(){var e=h.getState(!1,!1),t=(e||{}).url||r.location.href,n;n=t.replace(/\/+$/,"").replace(/[^\/]+$/,function(e,t,n){return/\./.test(e)?e:e+"/"});return n};h.getBasePageUrl=function(){var e=r.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e,t,n){return/[^\/]$/.test(e)?"":e}).replace(/\/+$/,"")+"/";return e};h.getFullUrl=function(e,t){var n=e,r=e.substring(0,1);t=typeof t=="undefined"?!0:t;/[a-z]+\:\/\//.test(e)||(r==="/"?n=h.getRootUrl()+e.replace(/^\/+/,""):r==="#"?n=h.getPageUrl().replace(/#.*/,"")+e:r==="?"?n=h.getPageUrl().replace(/[\?#].*/,"")+e:t?n=h.getBaseUrl()+e.replace(/^(\.\/)+/,""):n=h.getBasePageUrl()+e.replace(/^(\.\/)+/,""));return n.replace(/\#$/,"")};h.getShortUrl=function(e){var t=e,n=h.getBaseUrl(),r=h.getRootUrl();t=t.replace(r,"/");h.isTraditionalAnchor(t)&&(t="./"+t);t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"");return t};h.store={};h.idToState=h.idToState||{};h.stateToId=h.stateToId||{};h.urlToId=h.urlToId||{};h.storedStates=h.storedStates||[];h.savedStates=h.savedStates||[];h.normalizeStore=function(){h.store.idToState=h.store.idToState||{};h.store.urlToId=h.store.urlToId||{};h.store.stateToId=h.store.stateToId||{}};h.getState=function(e,t){typeof e=="undefined"&&(e=!0);typeof t=="undefined"&&(t=!0);var n=h.getLastSavedState();!n&&t&&(n=h.createStateObject());if(e){n=h.cloneObject(n);n.url=n.cleanUrl||n.url}return n};h.getIdByState=function(e){var t=h.extractId(e.url),n;if(!t){n=h.getStateString(e);if(typeof h.stateToId[n]!="undefined")t=h.stateToId[n];else if(typeof h.store.stateToId[n]!="undefined")t=h.store.stateToId[n];else{for(;;){t=(new Date).getTime()+String(Math.random()).replace(/\D/g,"");if(typeof h.idToState[t]=="undefined"&&typeof h.store.idToState[t]=="undefined")break}h.stateToId[n]=t;h.idToState[t]=e}}return t};h.normalizeState=function(e){var t,n;if(!e||typeof e!="object")e={};if(typeof e.normalized!="undefined")return e;if(!e.data||typeof e.data!="object")e.data={};t={};t.normalized=!0;t.title=e.title||"";t.url=h.getFullUrl(h.unescapeString(e.url||r.location.href));t.hash=h.getShortUrl(t.url);t.data=h.cloneObject(e.data);t.id=h.getIdByState(t);t.cleanUrl=t.url.replace(/\??\&_suid.*/,"");t.url=t.cleanUrl;n=!h.isEmptyObject(t.data);if(t.title||n){t.hash=h.getShortUrl(t.url).replace(/\??\&_suid.*/,"");/\?/.test(t.hash)||(t.hash+="?");t.hash+="&_suid="+t.id}t.hashedUrl=h.getFullUrl(t.hash);(h.emulated.pushState||h.bugs.safariPoll)&&h.hasUrlDuplicate(t)&&(t.url=t.hashedUrl);return t};h.createStateObject=function(e,t,n){var r={data:e,title:t,url:n};r=h.normalizeState(r);return r};h.getStateById=function(e){e=String(e);var n=h.idToState[e]||h.store.idToState[e]||t;return n};h.getStateString=function(e){var t,n,r;t=h.normalizeState(e);n={data:t.data,title:e.title,url:e.url};r=l.stringify(n);return r};h.getStateId=function(e){var t,n;t=h.normalizeState(e);n=t.id;return n};h.getHashByState=function(e){var t,n;t=h.normalizeState(e);n=t.hash;return n};h.extractId=function(e){var t,n,r;n=/(.*)\&_suid=([0-9]+)$/.exec(e);r=n?n[1]||e:e;t=n?String(n[2]||""):"";return t||!1};h.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t};h.extractState=function(e,t){var n=null,r,i;t=t||!1;r=h.extractId(e);r&&(n=h.getStateById(r));if(!n){i=h.getFullUrl(e);r=h.getIdByUrl(i)||!1;r&&(n=h.getStateById(r));!n&&t&&!h.isTraditionalAnchor(e)&&(n=h.createStateObject(null,null,i))}return n};h.getIdByUrl=function(e){var n=h.urlToId[e]||h.store.urlToId[e]||t;return n};h.getLastSavedState=function(){return h.savedStates[h.savedStates.length-1]||t};h.getLastStoredState=function(){return h.storedStates[h.storedStates.length-1]||t};h.hasUrlDuplicate=function(e){var t=!1,n;n=h.extractState(e.url);t=n&&n.id!==e.id;return t};h.storeState=function(e){h.urlToId[e.url]=e.id;h.storedStates.push(h.cloneObject(e));return e};h.isLastSavedState=function(e){var t=!1,n,r,i;if(h.savedStates.length){n=e.id;r=h.getLastSavedState();i=r.id;t=n===i}return t};h.saveState=function(e){if(h.isLastSavedState(e))return!1;h.savedStates.push(h.cloneObject(e));return!0};h.getStateByIndex=function(e){var t=null;typeof e=="undefined"?t=h.savedStates[h.savedStates.length-1]:e<0?t=h.savedStates[h.savedStates.length+e]:t=h.savedStates[e];return t};h.getHash=function(){var e=h.unescapeHash(r.location.hash);return e};h.unescapeString=function(t){var n=t,r;for(;;){r=e.unescape(n);if(r===n)break;n=r}return n};h.unescapeHash=function(e){var t=h.normalizeHash(e);t=h.unescapeString(t);return t};h.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t};h.setHash=function(e,t){var n,i,s;if(t!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.setHash,args:arguments,queue:t});return!1}n=h.escapeHash(e);h.busy(!0);i=h.extractState(e,!0);if(i&&!h.emulated.pushState)h.pushState(i.data,i.title,i.url,!1);else if(r.location.hash!==n)if(h.bugs.setHash){s=h.getPageUrl();h.pushState(null,null,s+"#"+n,!1)}else r.location.hash=n;return h};h.escapeHash=function(t){var n=h.normalizeHash(t);n=e.escape(n);h.bugs.hashEscape||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?"));return n};h.getHashByUrl=function(e){var t=String(e).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");t=h.unescapeHash(t);return t};h.setTitle=function(e){var t=e.title,n;if(!t){n=h.getStateByIndex(0);n&&n.url===e.url&&(t=n.title||h.options.initialTitle)}try{r.getElementsByTagName("title")[0].innerHTML=t.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(i){}r.title=t;return h};h.queues=[];h.busy=function(e){typeof e!="undefined"?h.busy.flag=e:typeof h.busy.flag=="undefined"&&(h.busy.flag=!1);if(!h.busy.flag){u(h.busy.timeout);var t=function(){var e,n,r;if(h.busy.flag)return;for(e=h.queues.length-1;e>=0;--e){n=h.queues[e];if(n.length===0)continue;r=n.shift();h.fireQueueItem(r);h.busy.timeout=o(t,h.options.busyDelay)}};h.busy.timeout=o(t,h.options.busyDelay)}return h.busy.flag};h.busy.flag=!1;h.fireQueueItem=function(e){return e.callback.apply(e.scope||h,e.args||[])};h.pushQueue=function(e){h.queues[e.queue||0]=h.queues[e.queue||0]||[];h.queues[e.queue||0].push(e);return h};h.queue=function(e,t){typeof e=="function"&&(e={callback:e});typeof t!="undefined"&&(e.queue=t);h.busy()?h.pushQueue(e):h.fireQueueItem(e);return h};h.clearQueue=function(){h.busy.flag=!1;h.queues=[];return h};h.stateChanged=!1;h.doubleChecker=!1;h.doubleCheckComplete=function(){h.stateChanged=!0;h.doubleCheckClear();return h};h.doubleCheckClear=function(){if(h.doubleChecker){u(h.doubleChecker);h.doubleChecker=!1}return h};h.doubleCheck=function(e){h.stateChanged=!1;h.doubleCheckClear();h.bugs.ieDoubleCheck&&(h.doubleChecker=o(function(){h.doubleCheckClear();h.stateChanged||e();return!0},h.options.doubleCheckInterval));return h};h.safariStatePoll=function(){var t=h.extractState(r.location.href),n;if(!h.isLastSavedState(t)){n=t;n||(n=h.createStateObject());h.Adapter.trigger(e,"popstate");return h}return};h.back=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.back,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.back(!1)});p.go(-1);return!0};h.forward=function(e){if(e!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.forward,args:arguments,queue:e});return!1}h.busy(!0);h.doubleCheck(function(){h.forward(!1)});p.go(1);return!0};h.go=function(e,t){var n;if(e>0)for(n=1;n<=e;++n)h.forward(t);else{if(!(e<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(n=-1;n>=e;--n)h.back(t)}return h};if(h.emulated.pushState){var d=function(){};h.pushState=h.pushState||d;h.replaceState=h.replaceState||d}else{h.onPopState=function(t,n){var i=!1,s=!1,o,u;h.doubleCheckComplete();o=h.getHash();if(o){u=h.extractState(o||r.location.href,!0);if(u)h.replaceState(u.data,u.title,u.url,!1);else{h.Adapter.trigger(e,"anchorchange");h.busy(!1)}h.expectedStateId=!1;return!1}i=h.Adapter.extractEventData("state",t,n)||!1;i?s=h.getStateById(i):h.expectedStateId?s=h.getStateById(h.expectedStateId):s=h.extractState(r.location.href);s||(s=h.createStateObject(null,null,r.location.href));h.expectedStateId=!1;if(h.isLastSavedState(s)){h.busy(!1);return!1}h.storeState(s);h.saveState(s);h.setTitle(s);h.Adapter.trigger(e,"statechange");h.busy(!1);return!0};h.Adapter.bind(e,"popstate",h.onPopState);h.pushState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.pushState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.pushState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0};h.replaceState=function(t,n,r,i){if(h.getHashByUrl(r)&&h.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(i!==!1&&h.busy()){h.pushQueue({scope:h,callback:h.replaceState,args:arguments,queue:i});return!1}h.busy(!0);var s=h.createStateObject(t,n,r);if(h.isLastSavedState(s))h.busy(!1);else{h.storeState(s);h.expectedStateId=s.id;p.replaceState(s.id,s.title,s.url);h.Adapter.trigger(e,"popstate")}return!0}}if(s){try{h.store=l.parse(s.getItem("History.store"))||{}}catch(v){h.store={}}h.normalizeStore()}else{h.store={};h.normalizeStore()}h.Adapter.bind(e,"beforeunload",h.clearAllIntervals);h.Adapter.bind(e,"unload",h.clearAllIntervals);h.saveState(h.storeState(h.extractState(r.location.href,!0)));if(s){h.onUnload=function(){var e,t;try{e=l.parse(s.getItem("History.store"))||{}}catch(n){e={}}e.idToState=e.idToState||{};e.urlToId=e.urlToId||{};e.stateToId=e.stateToId||{};for(t in h.idToState){if(!h.idToState.hasOwnProperty(t))continue;e.idToState[t]=h.idToState[t]}for(t in h.urlToId){if(!h.urlToId.hasOwnProperty(t))continue;e.urlToId[t]=h.urlToId[t]}for(t in h.stateToId){if(!h.stateToId.hasOwnProperty(t))continue;e.stateToId[t]=h.stateToId[t]}h.store=e;h.normalizeStore();s.setItem("History.store",l.stringify(e))};h.intervalList.push(a(h.onUnload,h.options.storeInterval));h.Adapter.bind(e,"beforeunload",h.onUnload);h.Adapter.bind(e,"unload",h.onUnload)}if(!h.emulated.pushState){h.bugs.safariPoll&&h.intervalList.push(a(h.safariStatePoll,h.options.safariPollInterval));if(i.vendor==="Apple Computer, Inc."||(i.appCodeName||"")==="Mozilla"){h.Adapter.bind(e,"hashchange",function(){h.Adapter.trigger(e,"popstate")});h.getHash()&&h.Adapter.onDomLoad(function(){h.Adapter.trigger(e,"hashchange")})}}};h.init()})(window);$.getObject("Pb.History",!0).HistoryManager=function(){function e(){this.init()}var t={pageState:{},pageTitle:null,pageUrl:null,init:function(){this.bindEvents()},bindEvents:function(){$(document).on("HistoryManager::updatePageHistory",$.proxy(function(e){this.updatePageHistory(e)},this))},updatePageHistory:function(e){var t=e.replace?!0:!1;e.state&&this.setCurrentState(e.state);e.url&&this.setPageUrl(e.url);e.title&&this.setPageTitle(e.title);this.updateState(t)},updateState:function(e){if(typeof History!="undefined")try{e?History.replaceState(this.pageState,this.pageTitle,this.pageUrl):History.pushState(this.pageState,this.pageTitle,this.pageUrl)}catch(t){}},setCurrentState:function(e){this.pageState=$.extend(this.pageState,e)},setPageUrl:function(e){this.pageUrl=e},setPageTitle:function(e){this.pageTitle=e}};e.prototype=t;return e}();$.getObject("Pb.History",!0).HistoryManager=new Pb.History.HistoryManager;(function(){var e=typeof window!="undefined"?window:exports,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();e.btoa||(e.btoa=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u});e.atob||(e.atob=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u})})();$.getObject("Pb.Media",!0).MediaIdentifierFactory=function(){function e(){}var t={getIdentifier:function(e){var t;e instanceof Pb.Path.PBPath?t=this.fromPBPath(e):e.path?t=this.fromPBPath(new Pb.Path.PBPath(e.path)):t=null;return t},fromPBPath:function(e){var t=null;if(e.filename!=null){var n="path:";n+=e.location;n+=e.filename;t=btoa(n)}return t}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.Detail",!0).Stats=function(){function e(e){this.init(e)}var t={exifData:[],likesViewData:[],init:function(e){this.currentMedia=Pb.Data.get(Pb.Data.Shared.MEDIA);this.bindEvents();$.views.helpers({parseExifData:function(e){var t="";for(var n in e)n.length>0&&(t+="<li>"+n+":</li><li class='value'>"+e[n]+"</li>");return t}});this.link()},bindEvents:function(){$(document).on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));$(".detailStatsWrapper").on("click","#showmore",$.proxy(this.fetchExif,this))},setCurrentMedia:function(e){this.currentMedia=e},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);this.hideExif()},link:function(){Pb.JSTemplates.link("#statsExifTemplate","#exifData",[this.exifData]);Pb.JSTemplates.link("#likesViewsTemplate","#viewData",[this.likesViewData]);$("#statsCounts").hide()},fetchExif:function(){$(".moretoggle").hide();$("#statsLoading").show();Pb.Track.tr("detailpage_mediainfo_more_click");var e=new Pb.Path.PBPath(this.currentMedia.path),t=Pb.Media.MediaIdentifierFactory.getIdentifier(e),n={type:"GET",url:"/api/user/"+e.ownername+"/media/"+encodeURIComponent(t)+"/exif",messageHandler:function(){return!0},error:function(){this.showExif([])},success:$.proxy(function(e){e.status===1?this.showExif(e.data):this.showExif([])},this)};Pb.Ajax.ajax(n)},showExif:function(e){this.exifData=e;this.likesViewData={viewCount:this.currentMedia.viewCount.toString(),likeCount:this.currentMedia.likeCount.toString()};this.link();$("#statsCounts").show();$("#statsLoading").hide();$("#viewData").show()},hideExif:function(){this.exifData=[];this.link();$("#statsCounts").hide();$("#statsLoading").hide();$("#viewData").hide();this.currentMedia.mediaType!=="image"?$(".moretoggle").hide():$(".moretoggle").show()}};$.extend(e.prototype,t);return e}();!function(e){"use strict";var t=function(t,n){this.$element=e(t);this.options=e.extend({},e.fn.button.defaults,n)};t.prototype={constructor:t,setState:function(e){var t="disabled",n=this.$element,r=n.data(),i=n.is("input")?"val":"html";e+="Text";r.resetText||n.data("resetText",n[i]());n[i](r[e]||this.options[e]);setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},toggle:function(){var e=this.$element.parent('[data-toggle="buttons-radio"]');e&&e.find(".active").removeClass("active");this.$element.toggleClass("active")}};e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("button"),s=typeof n=="object"&&n;i||r.data("button",i=new t(this,s));n=="toggle"?i.toggle():n&&i.setState(n)})};e.fn.button.defaults={loadingText:"loading..."};e.fn.button.Constructor=t;e(function(){e("body").on("click.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn"));n.button("toggle")})})}(window.jQuery);$.getObject("Pb.Component.Common.Follow",!0).FollowAction=function(){function t(t){e=t;var n=u()||e.data("followee");i();var s={url:"/action/follow/follow",type:"POST",data:{followType:e.data("type"),followee:n,userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(s)}function n(t){e=t;var n=u()||e.data("followee");i();var s={url:"/action/follow/unfollow",type:"POST",data:{followType:e.data("type"),followee:n,userId:e.data("user-id")},success:r,error:o};Pb.Ajax.ajax(s)}function r(e){var t=e.status;t?s():o()}function i(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_start");$(e).trigger(t)}function s(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_complete");t.action=this.followState;$(e).trigger(t)}function o(){var t=$.Event("Pb.Component.Common.Follow.FollowAction::action_error");$(e).trigger(t)}function u(){var e=this.currentData||null;if(e){var e=Pb.Data.Shared.get("shared.media"),t=Pb.Data.Shared.get("shared.mediaSet"),n=t[e.offset].username;return n}}var e=null;if(Pb.Data.get(Pb.Data.Shared.MEDIA)){this.currentData=Pb.Data.get(Pb.Data.Shared.MEDIA);this.followState=this.currentData.isFollowing}return{follow:t,unfollow:n}}();$.getObject("Pb.Component.Common.Follow",!0).Button=function(){function e(){this.init.apply(this,arguments)}$.extend(e.prototype,{isLoggedIn:null,isMobile:!1,init:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.isMobile=Pb.Data.get("isMobile");this.initEvents()},initEvents:function(){var e=this;$(document.body).on("mouseover mouseout","a.follow.following",function(t){t.type==="mouseover"&&!e.isMobile?e.showHover($(this)):e.isMobile||e.hideHover($(this))}).on("click","a.follow:not(.postAuthAction)",function(t){t.preventDefault();Pb.Track.tr("follow button click");e.toggle($(this))}).on("Pb.Component.Common.Follow.FollowAction::action_start","a.follow",this.toggleStart).on("Pb.Component.Common.Follow.FollowAction::action_complete","a.follow",this.toggleComplete).on("Pb.Component.Common.Follow.FollowAction::action_error","a.follow",this.toggleReset)},showHover:function(e){e.find("span").text("Unfollow");e.hasClass("btn-link")||e.addClass("btn-secondary")},hideHover:function(e){e.find("span").text("Following");e.removeClass("btn-secondary");e.find("i").removeClass("sicon-minus-sign")},toggle:function(e){if(!this.isLoggedIn){e.tooltip({delay:{show:2e3,hide:2e3}});e.tooltip("show");return}if(!e.hasClass("disabled"))if(e.hasClass("following")){e.data("complete-text","Follow");Pb.Component.Common.Follow.FollowAction.unfollow(e)}else{e.data("complete-text","Following");Pb.Component.Common.Follow.FollowAction.follow(e)}},toggleStart:function(e){$(e.currentTarget).button("loading")},toggleComplete:function(e){if($(e.currentTarget).data("remove-id")){$("#"+$(e.currentTarget).data("remove-id")).remove();return}if($(e.currentTarget).hasClass("following")){$(e.currentTarget).removeClass("following");if(!Pb.Data.get("isMobile")){$(e.currentTarget).removeClass("btn-secondary");$(e.currentTarget).addClass("btn-primary")}}else{$(e.currentTarget).removeClass("btn-primary");$(e.currentTarget).addClass("btn-secondary");$(e.currentTarget).addClass("following")}$(e.currentTarget).button("complete");$(e.currentTarget).wrapInner("<span>");$(e.currentTarget).prepend("<i>")},toggleReset:function(e){Pb.Component.Element.Message.showDefaultErrorMessage();$(e.currentTarget).button("reset")}});return e}();Pb.InitEventQueue.addToDomReady(function(){new Pb.Component.Common.Follow.Button});$.getObject("Pb.Component.Detail",!0).DetailActions=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,isMobile:!1,actionTargetNormalId:"#detailActions",actionTargetCompactId:"#detailActionsCompact",actionTarget:null,actionTemplate:"#detailActionsTemplate",actionData:[],defaultActionData:[],showPagination:!0,eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.showPagination=e.showPagination;this.isMobile=Pb.Data.get("isMobile");this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();this.isMobile&&(this.actionTemplate="#detailActionsMobileTemplate");for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link()},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.btngroupsocial=this.setOwnerOptionPerms(this.actionData.btngroupsocial);this.actionData.btngroupshare=this.setOwnerOptionPerms(this.actionData.btngroupshare);this.actionData.btngrouptools.items=this.setOwnerOptionPerms(this.actionData.btngrouptools);this.actionData.btngroupnav.items=this.setOwnerOptionPerms(this.actionData.btngroupnav)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="edit"?(this.currentMediaIsOwner||this.currentMedia.cd)&&n&&t.push(i):i.jsAttributes.identifier==="slideshow"?this.showPagination&&this.currentMedia.context==="album"&&t.push(i):i.jsAttributes.identifier==="download_button"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="btnprev"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnnext"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnalbum"?this.showPagination&&t.push(i):i.jsAttributes.identifier==="btnzoom"?(this.showPagination||this.isMobile)&&t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailActions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));e.on("Pb.Component.Filmstrip.Filmstrip::compact",$.proxy(this.switchToCompactActions,this));e.on("Pb.Component.Filmstrip.Filmstrip::normal",$.proxy(this.switchToNormalActions,this));this.bindActions()},bindActions:function(){var e=$(document);e.on("DetailActions::facebook",$.proxy(function(e){Pb.Track.trf("detail_page_share_facebook_click");this.isMobile&&window.open($(e.pbEventTarget).attr("href"),"_blank");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"facebook",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::gplus",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_gplus_click");Pb.Component.Common.Social.GooglePlus.open(e.pbData.fullsizeUrl,"detail")},this));e.on("DetailActions::pinterest",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_pinterest_click");Pb.Component.Common.Social.Pinterest.open(e.pbData.linkUrl,"detail",e.pbData.fullsizeUrl)},this));e.on("DetailActions::tumblr",$.proxy(function(e){e.preventDefault();Pb.Track.trf("detail_page_share_tumblr_click");Pb.Component.Common.Social.Tumblr.open(e.pbData,"detail")},this));e.on("DetailActions::twitter",$.proxy(function(e){Pb.Track.trf("detail_page_share_twitter_click");this.isMobile&&window.open($(e.pbEventTarget).attr("href"),"_blank");$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"twitter",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::email",$.proxy(function(e){Pb.Track.trf("detail_page_share_email_click");this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"email",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::download_button",$.proxy(function(e){Pb.Track.trf("detail_page_download_button_click");this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);document.location="/component/Download-File?file="+encodeURIComponent(t.path);Pb.Component.Ad.AdRefresh.reloadAds()},this));e.on("DetailActions::links",$.proxy(function(e){Pb.Track.trf("detail_page_share_links_click");this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"links",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::other",$.proxy(function(e){Pb.Track.trf("detail_page_share_other_click");this.isMobile&&(location.href=$(e.pbEventTarget).attr("href"));$(document).trigger($.Event("Pb.Component.Share.ShareModal::show",{pbData:e.pbData,shareType:"social",shareMode:"media",pbEventTarget:e.pbEventTarget}))},this));e.on("DetailActions::slideshow",$.proxy(function(e){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/slideshow/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location},this));e.on("DetailActions::edit",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));if(!this.showPagination&&!this.isMobile)return;e.on("click","#btnprev",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_previous_click"))});e.on("click","#btnnext",function(){e.trigger($.Event("Pb.Component.Detail.DetailActions::media_next_click"))});e.on("click","#btnalbum",function(){var e=/\d+/.exec(Pb.Data.get(Pb.Data.Shared.MEDIA).subdomain)[0];document.location="http://s"+e+".photobucket.com/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/library/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location});e.on("click","#btnzoom",function(){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/media-full/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location+"/"+Pb.Data.get(Pb.Data.Shared.MEDIA).name+".html"})},switchToCompactActions:function(){if(this.isCompact)return;this.removeActionTarget();$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId);this.actionTemplate="#detailActionsCompactTemplate";this.link();this.isCompact=!0},switchToNormalActions:function(){if(!this.isCompact)return;this.removeActionTarget();$(".detailfilmstripwrap").before('<div id="detailActions" class="detailActions"></div>');this.actionTarget=$(this.actionTargetNormalId);this.actionTemplate="#detailActionsTemplate";this.bindActions();this.link();this.isCompact=!1},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailActionsCompact" class="detailActions detailActionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.isMobile&&this.actionTarget.find(".btn-social").each($.proxy(function(e,t){var n=$(t).attr("href");n=n.replace(/(\?u=).*/,"?u="+encodeURIComponent(document.location.href));n=n.replace(/(\?text=).*/,"?text="+encodeURIComponent(document.location.href));$(t).attr("href",n)},this));this.fetchShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},fetchShareThis:function(){typeof stLight=="undefined"&&!this.isMobile&&$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"})},this),cache:!0})},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Social",!0).GooglePlus=function(){function e(e,t){e.indexOf("?")>=0?e+="&":e+="?";var n="plus_share";t&&(n=t+"_"+n);e+="src=pb&evt="+n;e=encodeURIComponent(e);window.open("https://plus.google.com/share?url="+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600")}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Pinterest=function(){function e(e,t,n){var r=t+"_pinterest_share",i="http://www.pinterest.com/pin/create/button/?url=",s="",o={url:e,directUrl:n,trackingKey:r},u="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";Object.keys(o).forEach(function(e){o[e]=encodeURIComponent(o[e])});s+=o.url+"&media="+o.directUrl+"&src=pb&evt="+o.trackingKey;window.open(i+s,"",u)}return{open:e}}();$.getObject("Pb.Component.Common.Social",!0).Tumblr=function(){function e(e,t){var n=e.shareMode,e=e.shareObject?e.shareObject:e,r=t+"_tumblr_share",i="https://www.tumblr.com/share/",s="",o={trackingKey:r},u=e.description?e.description.text||e.description:"",a=e.title||e.name;windowParams="menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600";n==="media"||e.mediaType?i+="photo?source="+encodeURIComponent(e.fullsizeUrl)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.linkUrl):n==="story"?i+="video?embed="+encodeURIComponent(e.linkcodes[1].inputText)+"&caption="+encodeURIComponent(a)+"&clickthru="+encodeURIComponent(e.storyUrl):i+="link?url="+encodeURIComponent(e.url||e.URL)+"&name="+encodeURIComponent(a)+"&description="+encodeURIComponent(u);s+="&src=pb&evt="+o.trackingKey;window.open(i+s,"",windowParams)}return{open:e}}();$.getObject("Pb.Component.Share",!0).ShareModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={currentController:null,privacy:null,linkTitle:null,init:function(t){var n={eventName:"Pb.Component.Share.ShareModal::show",shownEvent:"Pb.Component.Share.ShareModal::shown",hideEvent:"Pb.Component.Share.ShareModal::hidden",modalId:"#shareModal",modalName:"shareModal",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n);Pb.InitEventQueue.addToPageLoad(function(){if(Pb.Data.get("shareModal")&&Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).io){Pb.Data.get(Pb.Data.Shared.MEDIA).spedit=!0;$("#detailActions #facebook").click()}})},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".shareModalAction",eventType:"click",event:e.eventName}}))},onShow:function(t){var n=t.pbData,r=t.shareMode,s=t.shareType,o=t.showPrint,u=t.pbEventTarget,a=t.url,f,l=!0;if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").sponsoredShareMessage;Pb.Data.get("shareModal").sponsor=Pb.Data.get("shareModal").sponsoredClass;Pb.Track.tr("share_modal_"+Pb.Data.get("shareModal").sponsoredClass+"_editor_view")}else{Pb.Data.get("shareModal").sponsor="";Pb.Data.get("shareModal").socialShare.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage;Pb.Data.get("shareModal").email.mediaDefaultMessage=Pb.Data.get("shareModal").shareMessage}r||(r=$(u).closest("[data-sharemode]").data("sharemode"));s||(s=$(u).closest("[data-sharetype]").data("sharetype"));if(!n&&$(".showingRecent").length){n=Pb.Data.Albums.getRootAlbum();n.slideshowUrl=null;n.data.url+="?view=recent";n.url=n.data.url;n.type="recent";this.privacy="Public";n.ownername=Pb.Data.get("libraryOwner")}r==="story"&&(n.items=Pb.Data.Shared.get("shared.albumStorySet"));if(!n&&($("#hashtagsSettings .hashtag").length||$(".emptyHashtagView").length)){r="hashtag";n={};n.slideshowUrl=null;n.url=a;$(".emptyHashtagView").length?n.hashtag=$(".emptyHashtagView").find(".hashtagLabel").text():n.hashtag=$("#hashtagsSettings .hashtag").text();this.privacy="Public";l=!1}n&&n.url&&n.url.length&&!n.fullsizeUrl&&(n.fullsizeUrl=n.url);f=this.getTitle(r,n);t.headerTitle=f;t.modalData={title:f,shareMode:r,shareType:s,shareObject:n,pbEventTarget:u};r==="story"&&(n.url=n.storyUrl);if(s==="gplus"){Pb.Component.Common.Social.GooglePlus.open(n.url,"share");return}if(s==="pinterest"){Pb.Component.Common.Social.Pinterest.open(n.url,"share",n.thumbUrl);return}if(s==="tumblr"){Pb.Component.Common.Social.Tumblr.open(t.modalData,"share");return}e.superclass.onShow.call(this,t);$(".spinner").hide();(r==="album"||r==="slideshow")&&this.setPrivacyMessage(t);var c=$(this.modalId);t.embed&&(c=$(this.embedId));$("#patentMessage").hide();r==="story"&&$("#patentMessage").show();t.embed?Pb.Track.tr("share_embed_"+r+"_view"):Pb.Track.tr("share_modal_"+r+"_view");$("#printPromotion").hide();if(o){if(n.mediaType==="image"){var h=n.fullsizeUrl.split(".").pop().toLowerCase();if(h!=="gif"){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?media="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?media="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+n.fullsizeUrl+"');")}}}else if(r==="media"||r==="search")$("#printPromotion").hide();else if(n.items){var p,d=n.items;for(i=0;i<d.length;i++){p=d[i];if(p===null)continue;if(p.mediaType==="image"||r==="slideshow"){var h=p.fullsizeUrl.split(".").pop().toLowerCase();if(h!=="gif"&&(p.isOwner||p.cd||n.cd)){$("#printPromotion").show();$("#framedPromoLink").attr("href","/print/homedecor/framedprints?album="+encodeURI(n.path));$("#canvasPromoLink").attr("href","/print/homedecor/canvasprints?album="+encodeURI(n.path));$(".promoImage").attr("style","background-image: url('"+p.fullsizeUrl+"');");break}}}}else $("#printPromotion").hide();c.find(".nav-tabs a#email").attr("data-target","#"+c.attr("id")+" #shareModal_email");c.find(".nav-tabs a#social").attr("data-target","#"+c.attr("id")+" #shareModal_social");c.find(".nav-tabs a").on("shown",$.proxy(function(e){var t=$(e.currentTarget).data("tabtype");$(".privacyMessage .infoText").hide();Pb.Data.data.shareModal.tabs.activeTab=t;switch(t){case"email":c.find(".privacyMessage .shareText").show();this.currentController=Pb.Component.Share.Email;$(document).trigger($.Event("Pb.Component.Share.ShareModal::emailTabShown",{modal:c.attr("id")}));break;case"followers":c.find(".privacyMessage .shareText").show();this.currentController=Pb.Component.Share.Followers;$(document).trigger($.Event("Pb.Component.Share.ShareModal::followersTabShown",{modal:c.attr("id")}));break;case"social":c.find(".privacyMessage .publicText").show();this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:c.attr("id")}));break;case"links":c.find(".privacyMessage .publicText").show();this.currentController=Pb.Component.Share.SocialShare;$(document).trigger($.Event("Pb.Component.Share.ShareModal::socialTabShown",{modal:c.attr("id")}))}c.find(".linkCodes").children().length===0&&$(document).trigger($.Event("Pb.Component.Share.ShareModal::linksTabShown",{modal:c.attr("id")}));if(this.privacy==="Private"){$(".privacyMessage .shareText").hide();$(".privacyMessage .publicText").show()}},this));$(".makeAlbumPublic").on("click",$.proxy(function(e){$(".privacyMessage").hide();$(".spinner").show();Pb.Ajax.ajax({url:"/action/album/update",data:{privacyLevel:"public",name:Pb.Data.data.shareModal.shareObject.name,albumPath:Pb.Data.data.shareModal.shareObject.path},success:function(e){if(e.status){var t=Pb.Data.Albums.getCurrentAlbum();t.mergeData(e.data);$(document).trigger($.Event("Pb.Component.Album.Edit.EditAlbum::editAlbumCompleted"));$(".spinner").hide()}else{$(".spinner").hide();$(".privacyMessage").show()}},error:function(e){$(".spinner").hide();$(".privacyMessage").show()}})},this));var v=c.find(".nav-tabs");if(s==="email"){v.find('a[data-tabtype="email"]').tab("show");Pb.Component.Share.SocialShare.setOptions(null)}else if(s==="followers")v.find('a[data-tabtype="followers"]').tab("show");else{v.find('a[data-tabtype="social"]').tab("show");v.find('a[data-tabtype="social"]').trigger($.Event("shown"));if(s==="facebook"||s==="twitter"){Pb.Component.Share.SocialShare.setOptions({service:s});Pb.Component.Share.SocialShare.updateUI()}else Pb.Component.Share.SocialShare.setOptions({showMore:!0})}c.find("#shareModal_email").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=c.find("form:visible");t.length&&this.onSubmit(e)}},this));c.find("#shareModal_social").find("#shareModalSubmit").on("click",$.proxy(function(e){e.preventDefault();if(!$(this).hasClass("disabled")){Pb.Data.data.shareModal.shareObject.hashtag&&Pb.Track.tr("share_modal_"+Pb.Data.data.shareModal.tabs.activeTab+"_hashtag_share_click");var t=c.find("form:visible");t.length&&this.onSubmit(e)}},this));l?c.find("#linksTitle").text(this.linkTitle):c.find("a#links").parent().css("display","none");if(r==="search"){$("#shareModal_links").hide();$("#shareModal_links").css("width","0px");$(".tabContainer").css("width","100%");$("#shareModal").css("width","586px")}if(Pb.Data.get("shareModal").isSponsoredEdit&&Pb.Data.get(Pb.Data.Shared.MEDIA).spedit){$("#shareModal").addClass(Pb.Data.get("shareModal").sponsoredClass);$("#socialmessage, #message").prop("placeholder",Pb.Data.get("shareModal").sponsoredShareMessage).val(Pb.Data.get("shareModal").sponsoredShareMessage)}},setPrivacyMessage:function(e){!e.modalData.shareObject.albumStats&&$(".showingRecent").length?this.privacy="Public":this.privacy=e.modalData.shareObject.albumStats.privacy.display;var t=e.modalData.shareMode,n=e.modalData.shareType;if(this.privacy!=="Public"){this.privacy==="Password"&&(this.privacy="Password Protected");$(".privacyMessage").html('<i class="icon-exclamtion-sign"></i>This album is '+this.privacy+'. <br/><span class="infoText shareText">Don\'t forget to share the password with your friends!</span><span class="infoText publicText">Make it Public <a href="#" class="makeAlbumPublic">here</a> so your friends can view the '+t+".</span>")}n==="email"&&this.privacy==="Password"?$(".privacyMessage .publicText").hide():$(".privacyMessage .shareText").hide()},onSuccess:function(t){e.superclass.onSuccess.call(this,t);$("textarea").val("");$("#toAddress, #fromAddress").val("");Pb.Data.get("shareModal").sponsor&&(Pb.Data.get(Pb.Data.Shared.ALBUM)?$("textarea").val(Pb.Data.get(Pb.Data.Shared.ALBUM).sponsoredShareMessage):$("textarea").val(Pb.Data.get("shareModal").sponsoredShareMessage))},buildSubmitData:function(){var e=null;if(this.currentController){this.submitUrl=this.currentController.getSubmitUrl();e=this.currentController.buildSubmitData(Pb.Data.get(this.modalName))}e&&Pb.Data.get("shareModal").sponsor&&(e.sponsor=Pb.Data.get("shareModal").sponsor);return e},onFail:function(){$(document).trigger({type:"Pb.Component.Share.ShareModal::error"})},enableSubmit:function(){$("#shareModalSubmit").removeClass("disabled")},disableSubmit:function(){$("#shareModalSubmit").addClass("disabled")},getTitle:function(e,t){var n,r;if(e==="album"||e==="slideshow")if(t.isSlideshow){n="Share this slideshow";this.linkTitle="Slideshow Links"}else if(t.dirName){n="Share the album: "+t.dirName;this.linkTitle="Album Links"}else{n="Share: "+t.ownername+"'s Library";this.linkTitle="Library Links"}else if(e==="story"){t.title?n="Share the story: "+t.title:n="Share the story: "+t.dirName;this.linkTitle="Story Links"}else if(e==="recent"){t.ownername&&(n="Share: "+t.ownername+"'s Recent Uploads");this.linkTitle="Recent Links"}else if(e==="recentUploads"){n="Share: Recent Uploads";this.linkTitle="Recent Links"}else if(e==="hashtag"){n="Share the hashtag: "+t.hashtag;linkTitle="Hashtag Links"}else if(e==="search"){n="Share these search results";this.linkTitle="Search Links"}else{r=t.mediaType;r==="image"&&(r="photo");n="Share the "+r;t.title&&(n+=": "+t.title);this.linkTitle=r.charAt(0).toUpperCase()+r.slice(1)+" Links"}return n}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).SocialShare=function(){function e(){this.init()}var t={options:null,facebookFeedUrl:"https://www.facebook.com/dialog/feed",twitterFeedUrl:"http://twitter.com/intent/tweet",init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::socialTabShown",$.proxy(this.onTabShown,this))},onModalShown:function(e){var t=Pb.Data.get("shareModal"),n="input[name=defaultMessage_"+t.shareMode+"]",r=Pb.Data.get("shareModal"),i=r.embed?"#"+r.id+"Embed":"#"+r.id,s=$(i),o=s.find("#socialShare").find("form");s.find("#socialmessage").attr("placeholder",o.find(n).val());s.find("#socialShare_more_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find("#socialShare_less_label").on("click",$.proxy(this.onLessOrMoreClick,this));s.find(".extra-service-selector .pinterest").on("click",function(){this.mode==="search"?Pb.Component.Common.Social.Pinterest.open(Pb.Data.Shared.get("shared.searchSetCollection").data.url,"search",Pb.Data.Shared.get("shared.searchSetCollection").data.items[0].fullsizeUrl):this.mode==="recentUploads"?Pb.Component.Common.Social.Pinterest.open(t.pbEventTarget.target.URL,"recentUploads",Pb.Data.Shared.get("shared.recentSetCollection").data.items[0].fullsizeUrl):Pb.Component.Common.Social.Pinterest.open(t.shareObject.url,"share",t.shareObject.thumbUrl)});s.find(".extra-service-selector .tumblr").on("click",function(e){var n=t.shareMode==="search"||t.shareMode==="recentUploads"?t.pbEventTarget:t;Pb.Component.Common.Social.Tumblr.open(n,"share")});s.find(".moreIconsButton").on("click",function(){s.find("#socialShare_more").show();s.find(".moreIconsButton").hide();s.find(".lessIconsButton").show()});s.find(".lessIconsButton").on("click",function(){s.find("#socialShare_more").hide();s.find(".lessIconsButton").hide();s.find(".moreIconsButton").show()});s.find("#socialShare div.connectionInfo").on("Pb_Component_ExternalSite_Connection::success Pb_Component_ExternalSite_Connection::selectCheckbox Pb_Component_ExternalSite_Connection::unselectCheckbox Pb_Component_ExternalSite_Connection::error",$.proxy(this.onServiceClick,this));s.find("#socialShare .service-selector li > input").on("change",$.proxy(this.onServiceClick,this));this.fetchShareThis();this.reset();this.updateUI();this.updateMessage()},updateMessage:function(){var e=Pb.Data.get("shareModal");e.shareMode==="hashtag"&&($("#service_twitter").is(":checked")?$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "):$("#service_facebook").is(":checked")?$("#socialmessage").val("I've got my own Photobucket Hashtag!  Add my hashtag "+e.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "):$("#socialmessage").val("I got a @Photobucket Hashtag! Use "+e.shareObject.hashtag+" to share photos & videos with me! All our pics will be in this album: "))},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){var e=Pb.Data.get("shareModal"),t=this.getExternalShareData(e.shareMode,e.shareObject);$(".extra-service-selector span:not(.native)").empty();$(".extra-service-selector span:not(.native)").each(function(e,n){var r={service:$(this).attr("class"),element:this,url:t.url,title:t.name,type:"large",image:t.picture};stWidget.addEntry(r)});$(".moreIconsButton").show()}},onModalHidden:function(){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t);n.find("#socialShare_more_label").off("click");n.find("#socialShare_less_label").off("click");n.find(".service-selector li input").off("change");n.find(".service-selector").off(".socialShare");n.find("#socialmessage").val("")},onLessOrMoreClick:function(){$("#socialShare_more_label").is(":visible")?this.toggleMore(!0):this.toggleMore(!1)},onServiceClick:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);if(e.type==="Pb_Component_ExternalSite_Connection::success"||e.type==="Pb_Component_ExternalSite_Connection::selectCheckbox"){$(e.currentTarget.parentNode).addClass("selected");e.siteAuth&&e.siteAuth.siteId===2&&e.siteAuth.publishState.toLowerCase()!=="auto"&&r.one("hide",function(){Pb.Component.ExternalSite.AutoPublishModal.onShow()})}else e.type==="Pb_Component_ExternalSite_Connection::unselectCheckbox"||e.type==="Pb_Component_ExternalSite_Connection::error"?$(e.currentTarget.parentNode).removeClass("selected"):$(e.currentTarget.parentNode).toggleClass("selected");this.updateMessage()},onTabShown:function(e){e.stopImmediatePropagation();var t=Pb.Data.get("shareModal"),n,r,i,s,o=t.embed?"#"+t.id+"Embed":"#"+t.id,u=$(o);if(t&&t.socialShare&&t.socialShare.sites){n=t.socialShare.sites;for(r=0;r<n.length;r++){i={connectionData:n[r],element:o+" #"+n[r].service+"Connection",promptForAutoPublish:n[r].promptForAutoPublish};s=new Pb.Component.ExternalSite.Connection(i);Pb.Data.add("connection-"+n[r].service,s)}}if(!Pb.Data.get("isLoggedIn")){var a=u.find(".connectionInfo"),f=this.getExternalShareData(t.shareMode,t.shareObject);a.find('input[type="checkbox"]').each(function(){$(this).hide()});u.find(".service-selector").on("click.socialShare",".facebook-icon, #lbl_facebook, .twitter-icon, #lbl_twitter",$.proxy(function(e){var t=$(e.currentTarget),n,r,i="";if(t.hasClass("facebook-icon")||t.attr("id")==="lbl_facebook"){n={app_id:Pb.Data.get("connection-facebook").connectionData.serviceAppId,link:decodeURIComponent(f.url),name:f.name,picture:decodeURIComponent(f.picture),caption:f.caption,description:f.description,redirect_uri:"http://"+document.location.hostname+"/externalpopup",display:"popup"};i=$.param(n);i=i.replace(/\+/g,"%20");r=this.facebookFeedUrl+"?"+i;window.open(r,"Share","width=550,height=420")}else if(t.hasClass("twitter-icon")||t.attr("id")==="lbl_twitter"){r=this.twitterFeedUrl+"?url="+encodeURIComponent(f.url.replace(" ","%20"));f.pbTitle!==""&&(r+="&text="+escape(f.pbTitle));window.open(r,"Share","width=550,height=420")}},this));Pb.Component.Share.ShareModal.disableSubmit()}else Pb.Component.Share.ShareModal.enableSubmit()},getSubmitUrl:function(){return $("#socialShare").find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$("#socialShare:visible").first().find("form"),r=n.find(".service-selector").find("input:checked:not(:disabled)"),i=null,s=r.map(function(){return this.id}).get().join(","),o=e.shareMode==="slideshow"?e.shareObject.slideshowUrl:e.shareObject.fullsizeUrl||e.shareObject.url||e.shareObject.data.url,t={targetType:e.shareMode,services:s,message:n.find("#socialShare_message textarea").val()};e.shareMode==="search"?i=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl:e.shareMode==="recentUploads"?i=e.shareObject.data.thumbUrl:e.shareMode==="story"&&(i=Pb.Data.get("storyPage").thumbUrl);i&&(t.targetThumbUrl=i);t.target=o;return t},reset:function(){this.toggleMore(!0)},setOptions:function(e){this.options=e},toggleMore:function(e){var t=Pb.Data.get("shareModal"),n=t.embed?"#"+t.id+"Embed":"#"+t.id,r=$(n);if(e){r.find("#socialShare_more_label").hide();r.find("#socialShare_less_label").show();r.find("#socialShare_more_content").show()}else{r.find("#socialShare_more_label").show();r.find("#socialShare_less_label").hide();r.find("#socialShare_more_content").hide()}},updateUI:function(){if(this.options){this.options.showMore&&this.toggleMore(!0);if(this.options.service){var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t),r=n.find("#service_"+this.options.service);r.trigger("Pb_Component_ExternalSite_Connection::checkboxChange");n.find("#service_facebook, #service_twitter").removeAttr("checked");n.find("#service_"+this.options.service).prop("checked","checked")}}},getExternalShareData:function(e,t){var n={url:"",caption:"photobucket.com",description:"",name:"",picture:"",pbTitle:""};if(e==="album"||e==="slideshow"){n.url=e==="slideshow"?t.slideshowUrl:t.url;t.thumbFileName?n.picture="http://"+t.subdomain+".photobucket.com"+t.path+"/bth_"+t.thumbFileName:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"library":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:""}else if(e==="recent"){n.url=t.data.url;n.name="Recent Uploads on Photobucket"}else if(e==="recentUploads"){n.url=t.data.url;n.name="Recent Uploads on Photobucket";n.picture=t.data.thumbUrl}else if(e==="story"){n.url=t.storyUrl;t.thumbUrl?n.picture=t.thumbUrl:t.media&&t.media.length>0?n.picture=t.media[0].thumbUrl:t.items&&t.items.length>0&&(n.picture=t.items[0].thumbUrl);n.name=t.ownername+"'s ";n.name+=t.isRootAlbum?"story":t.name+" "+e;n.name+=" on Photobucket";n.description=t.description?t.description.text:"";n.pbTitle=n.name}else if(e==="search"){n.url=t.data.url;n.name=t.data.title;n.picture=t.data.items[0].thumbUrl;n.pbTitle=n.name;n.description=t.data.description?t.data.description:""}else if(e==="hashtag"){n.url=t.url;n.name=t.hashtag}else{n.url=t.linkUrl;n.picture=t.thumbUrl;if(t.title!==""){n.name=t.title;n.pbTitle=n.name}else{n.name=t.username+"'s ";n.name+=t.mediaType==="image"?" photo":t.mediaType;n.name+=" on Photobucket"}n.description=t.description?t.description.text:""}n.url+=n.url.indexOf("?")===-1?"?src=pb_unauth":"&src=pb_unauth";return n}};$.extend(e.prototype,t);return new e}();$.getObject("Pb.Component.ExternalSite",!0).Connection=function(){function e(e){this.init(e)}var t={init:function(e){this.element=$(e.element);this.connectionData=e.connectionData;e.hasOwnProperty("promptForAutoPublish")?this.promptForAutoPublish=e.promptForAutoPublish:this.promptForAutoPublish=!0;this.linkData();this.initEvents()},initEvents:function(){if(Pb.Data.get("isLoggedIn")){this.connectionData.connectMethod==="checkbox"?this.element.find("input[type=checkbox]").on("click Pb_Component_ExternalSite_Connection::checkboxChange",$.proxy(this.connectByCheckbox,this)):this.element.on("click",".connectLink",$.proxy(function(e){e.preventDefault();var t=$(e.currentTarget);this.toggleConnection(t)},this));this.element.on("change",".autoShare input",$.proxy(function(e){this.toggleAutoshare(e.currentTarget.checked)},this))}},toggleConnection:function(e){var t=e.attr("href"),n=e.data("connected"),r=$(e).data("track");if(n)this.disconnect();else{if($(e).hasClass("mobile")&&r){Pb.Track.tr(r);location.href=t;return}this.doConnect(t)}},connect:function(e){this.doConnect(e.href)},doConnect:function(e){$(document).one("Pb.Component.ExternalSite.Connect::connect",$.proxy(this.connectCallback,this));Pb.Component.ExternalSite.Connect.connect(e,!this.promptForAutoPublish)},connectByCheckbox:function(e){e.type==="Pb_Component_ExternalSite_Connection::checkboxChange"&&(e.target.checked=!e.target.checked);if(e.target.checked)if(this.connectionData.isConnected)this.element.trigger("Pb_Component_ExternalSite_Connection::selectCheckbox");else{this.doConnect($(e.target).data("connecturl"));e.target.disabled=!0}else this.element.trigger("Pb_Component_ExternalSite_Connection::unselectCheckbox")},connectCallback:function(e){var t,n,r;if(e.status){n=e.connectInfo.siteAuth;this.connectionData.isConnected=!0;this.connectionData.siteUsername=n.siteUsername;this.connectionData.siteUserLink=n.siteUserLink;this.connectionData.siteUserImage=n.siteUserImage;this.connectionData.style==="verbose"?this.connectionData.connectionLabel="Connected as "+n.siteUsername:this.connectionData.connectionLabel=n.siteUsername;if(this.connectionData.actionBtn){var i=this.connectionData.actionBtn;i.classString=i.classString.replace(/btn-primary/,"btn-secondary");i.label="Disconnect";i.iconClass="icon-minus-sign";i.extraAttributes="data-connected='true'"}this.connectionData.autoshare&&(n.publishState&&n.publishState.toLowerCase()==="auto"?this.connectionData.autoshare.boxes[0].value="true":this.connectionData.autoshare.boxes[0].value="false");this.linkData();this.element.trigger({type:"Pb_Component_ExternalSite_Connection::success",siteAuth:n})}else{r={type:"Pb_Component_ExternalSite_Connection::error"};t=this.element.find("input[type=checkbox]");if(t.length){t.prop("disabled",!1);t.prop("checked",!1)}this.element.trigger(r)}},linkData:function(){var e;Pb.JSTemplates.link("#connectionItem",this.element,this.connectionData);if(this.connectionData.connectMethod==="checkbox"&&this.connectionData.isConnected){e=this.element.find("input[type=checkbox]");if(e.length){e.prop("disabled",!1);e.prop("checked",!0)}}this.connectionData.autoshare&&this.element.find(".autoShare input").prop("checked",this.connectionData.autoshare.boxes[0].value==="true")},disconnectSuccess:function(e){if(e.status){this.connectionData.isConnected=!1;if(this.connectionData.actionBtn){var t=this.connectionData.actionBtn;t.classString=t.classString.replace(/btn-secondary/,"btn-primary");t.label="Connect";t.iconClass="";t.extraAttributes="data-connected='false'"}this.connectionData.autoshare&&(this.connectionData.autoshare.boxes[0].value="false");this.linkData()}},disconnect:function(){Pb.Component.ExternalSite.DisconnectConfirm&&Pb.Component.ExternalSite.DisconnectConfirm.show(this.connectionData.siteId,$.proxy(this.disconnectSuccess,this))},handleAutoshareSuccess:function(e){var t=this.element.find(".autoShare input");this.connectionData.autoshare.boxes[0].value=t.prop("checked")?"true":"false"},handleAutoshareError:function(e){var t;if(e.data&&e.data.requiredPermissions){t=this.element.find(".actionButton");if(t.length){$(document).one("Pb.Component.ExternalSite.Connect::permissions",$.proxy(function(e){e.status===1?this.toggleAutoshare(!0):this.resetAutoshare()},this));Pb.Component.ExternalSite.Connect.getPermissions(t.attr("href"),e.data.requiredPermissions)}}else this.resetAutoshare()},resetAutoshare:function(){var e=this.element.find(".autoShare input");e.prop("checked",!e.prop("checked"));this.connectionData.autoshare.boxes[0].value=e.prop("checked")?"true":"false"},toggleAutoshare:function(e){Pb.Ajax.ajax({url:"/action/externalSite/updateAutoShare",data:{siteId:this.connectionData.siteId,autoshare:e},success:$.proxy(function(e){e.status?this.handleAutoshareSuccess(e):this.handleAutoshareError(e)},this),error:$.proxy(this.handleAutoshareError,this)})}};e.prototype=t;return e}();$.getObject("Pb.Component.ExternalSite",!0).DisconnectConfirm=function(){function e(){e.superclass.constructor.call(this)}if(!Pb.Modal||!Pb.Modal.ModalActionBase)return null;var t,n={init:function(t){var n={modalId:"#disconnectConfirm",modalName:"disconnectConfirm",submitButtonId:"#disconnectSubmit",submitUrl:"/action/externalSite/disconnect",showProgress:!0};t&&$.extend(n,t);e.superclass.init.call(this,n)},show:function(e,t,n){$(this.modalId).find("#siteId").val(e);t&&(this.onSuccess=this.getSuccessCallback(t));n&&(this.onFail=n);this.onShow()},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={siteId:e.find("#siteId").val()};return t},getSuccessCallback:function(e){return function(t){Pb.Component.Common.ProfilePic.ProfilePic.update(t.data.profilePic);$(document).trigger({type:"DisconnectConfirm::success",siteId:t.data.siteId});e.call(this,t)}}};Pb.subclass(e,Pb.Modal.ModalActionBase,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Share",!0).Email=function(){function e(){this.init()}var t={init:function(){this.initEvents()},initEvents:function(){$(document).on("Pb.Component.Share.ShareModal::shown",$.proxy(this.onModalShown,this));$(document).on("Pb.Component.Share.ShareModal::hidden",$.proxy(this.onModalHidden,this));$(document).on("Pb.Component.Share.ShareModal::emailTabShown",$.proxy(this.onTabShown,this))},onCaptchaSuccess:function(){Pb.Component.Share.ShareModal.enableSubmit()},onModalShown:function(){Pb.Component.Element.Form.Honeypot.init($(".shareEmail"));var e=Pb.Data.get("shareModal"),t=e.embed?"#"+e.id+"Embed":"#"+e.id,n=$(t),r=n.find(".shareEmail").find("form");r.length>0&&r.get(0).reset();var i="input[name=defaultMessage_"+e.shareMode+"]";r.find("#message").attr("placeholder",r.find(i).val());var s=r.find(".sliderCaptcha");if(s.length){this.captcha=new Pb.Component.Element.Captcha.Slider({container:s});this.captcha.on("success",$.proxy(this.onCaptchaSuccess,this))}else Pb.Component.Share.ShareModal.enableSubmit();e.shareMode==="hashtag"&&$("#message").val("I've got my own Photobucket Hashtag!  Add my hashtag "+e.shareObject.hashtag+" when you post pictures to Twitter, Instagram or Photobucket to share your photos with me!  All our pictures will be in this album on Photobucket: "+e.shareObject.url);$(document).on("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onModalHidden:function(){$(document).off("Pb.Component.Share.ShareModal::error",$.proxy(this.onFail,this))},onTabShown:function(e){e.stopImmediatePropagation();var t=$("#"+e.modal);t.find("#shareModalSubmit").show();var n=t.find(".sliderCaptcha");n.length?t.find("#shareModalSubmit").addClass("disabled"):t.find("#shareModalSubmit").removeClass("disabled")},getSubmitUrl:function(){return $(".shareEmail").first().find("form").attr("action")},buildSubmitData:function(e){var t=Pb.Data.get("shareModal"),n=$(".shareEmail:visible").first().find("form"),r,i=e.shareObject.fullsizeUrl,s=null,t={targetType:e.shareMode};r=n.find("input");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;r=n.find("textarea");for(var o=0;o<r.length;o++)t[r[o].name]=r[o].value;this.captcha&&(t.hashCash=this.captcha.getHashCash());if(!i){i=e.shareObject.url;e.shareMode==="slideshow"&&(i=e.shareObject.slideshowUrl);if(e.shareMode==="search"){i=e.shareObject.data.url;s=Pb.Data.get(Pb.Data.Shared.SEARCH_SET)[0].thumbUrl}else if(e.shareMode==="recentUploads"){i=e.shareObject.data.url;s=e.shareObject.data.thumbUrl}else e.shareMode==="story"&&(s=Pb.Data.get("storyPage").thumbUrl)}t.target=i;s&&(t.targetThumbUrl=s);return t},setOptions:function(e){this.options=e},onFail:function(){if(this.captcha){Pb.Component.Share.ShareModal.disableSubmit();this.captcha.reset()}}};$.extend(e.prototype,t);return new e}();(function(e,t){function h(e,t,n){var r=u[t.type]||{},i=t.empty||n;if(i&&e==null)return null;if(t.def&&e==null)return t.def;r.floor?e=~~e:e=parseFloat(e);if(e==null||isNaN(e))return t.def;if(r.mod){e%=r.mod;return e<0?r.mod+e:e}return r.min>e?r.min:r.max<e?r.max:e}function p(t){var n=s(),r=n._rgba=[];t=t.toLowerCase();c(i,function(e,i){var s=i.re.exec(t),u=s&&i.parse(s),a,f=i.space||"rgba",l=o[f].cache;if(u){a=n[f](u);n[l]=a[l];r=n._rgba=a._rgba;return!1}});if(r.length!==0){Math.max.apply(Math,r)===0&&e.extend(r,l.transparent);return n}if(t=l[t])return t}function d(e,t,n){n=(n+1)%1;return n*6<1?e+(t-e)*6*n:n*2<1?t:n*3<2?e+(t-e)*(2/3-n)*6:e}var n="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color outlineColor".split(" "),r=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],s=e.Color=function(t,n,r,i){return new e.Color.fn.parse(t,n,r,i)},o={rgba:{cache:"_rgba",props:{red:{idx:0,type:"byte",empty:!0},green:{idx:1,type:"byte",empty:!0},blue:{idx:2,type:"byte",empty:!0},alpha:{idx:3,type:"percent",def:1}}},hsla:{cache:"_hsla",props:{hue:{idx:0,type:"degrees",empty:!0},saturation:{idx:1,type:"percent",empty:!0},lightness:{idx:2,type:"percent",empty:!0}}}},u={"byte":{floor:!0,min:0,max:255},percent:{min:0,max:1},degrees:{mod:360,floor:!0}},a=o.rgba.props,f=s.support={},l,c=e.each;o.hsla.props.alpha=a.alpha;s.fn=s.prototype={constructor:s,parse:function(n,r,i,u){if(n===t){this._rgba=[null,null,null,null];return this}if(n instanceof e||n.nodeType){n=n instanceof e?n.css(r):e(n).css(r);r=t}var f=this,d=e.type(n),v=this._rgba=[],m;if(r!==t){n=[n,r,i,u];d="array"}if(d==="string")return this.parse(p(n)||l._default);if(d==="array"){c(a,function(e,t){v[t.idx]=h(n[t.idx],t)});return this}if(d==="object"){n instanceof s?c(o,function(e,t){n[t.cache]&&(f[t.cache]=n[t.cache].slice())}):c(o,function(e,t){c(t.props,function(e,r){var i=t.cache;if(!f[i]&&t.to){if(n[e]==null||e==="alpha")return;f[i]=t.to(f._rgba)}f[i][r.idx]=h(n[e],r,!0)})});return this}},is:function(e){var t=s(e),n=!0,r=this;c(o,function(e,i){var s=t[i.cache],o;if(s){o=r[i.cache]||i.to&&i.to(r._rgba)||[];c(i.props,function(e,t){if(s[t.idx]!=null){n=s[t.idx]==o[t.idx];return n}})}return n});return n},_space:function(){var e=[],t=this;c(o,function(n,r){t[r.cache]&&e.push(n)});return e.pop()},transition:function(e,t){var n=s(e),r=n._space(),i=o[r],a=this[i.cache]||i.to(this._rgba),f=a.slice();n=n[i.cache];c(i.props,function(e,r){var i=r.idx,s=a[i],o=n[i],l=u[r.type]||{};if(o===null)return;if(s===null)f[i]=o;else{l.mod&&(o-s>l.mod/2?s+=l.mod:s-o>l.mod/2&&(s-=l.mod));f[r.idx]=h((o-s)*t+s,r)}});return this[r](f)},blend:function(t){if(this._rgba[3]===1)return this;var n=this._rgba.slice(),r=n.pop(),i=s(t)._rgba;return s(e.map(n,function(e,t){return(1-r)*i[t]+r*e}))},toRgbaString:function(){var t="rgba(",n=e.map(this._rgba,function(e,t){return e==null?t>2?1:0:e});if(n[3]===1){n.pop();t="rgb("}return t+n.join(",")+")"},toHslaString:function(){var t="hsla(",n=e.map(this.hsla(),function(e,t){e==null&&(e=t>2?1:0);t&&t<3&&(e=Math.round(e*100)+"%");return e});if(n[3]==1){n.pop();t="hsl("}return t+n.join(",")+")"},toHexString:function(t){var n=this._rgba.slice(),r=n.pop();t&&n.push(~~(r*255));return"#"+e.map(n,function(e,t){e=(e||0).toString(16);return e.length==1?"0"+e:e}).join("")},toString:function(){return this._rgba[3]===0?"transparent":this.toRgbaString()}};s.fn.parse.prototype=s.fn;o.hsla.to=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/255,n=e[1]/255,r=e[2]/255,i=e[3],s=Math.max(t,n,r),o=Math.min(t,n,r),u=s-o,a=s+o,f=a*.5,l,c;o===s?l=0:t===s?l=60*(n-r)/u+360:n===s?l=60*(r-t)/u+120:l=60*(t-n)/u+240;f===0||f===1?c=f:f<=.5?c=u/a:c=u/(2-a);return[Math.round(l)%360,c,f,i==null?1:i]};o.hsla.from=function(e){if(e[0]==null||e[1]==null||e[2]==null)return[null,null,null,e[3]];var t=e[0]/360,n=e[1],r=e[2],i=e[3],s=r<=.5?r*(1+n):r+n-r*n,o=2*r-s,u,a,f;return[Math.round(d(o,s,t+1/3)*255),Math.round(d(o,s,t)*255),Math.round(d(o,s,t-1/3)*255),i]};c(o,function(n,i){var o=i.props,u=i.cache,a=i.to,f=i.from;s.fn[n]=function(n){a&&!this[u]&&(this[u]=a(this._rgba));if(n===t)return this[u].slice();var r=e.type(n),i=r==="array"||r==="object"?n:arguments,l=this[u].slice(),p;c(o,function(e,t){var n=i[r==="object"?e:t.idx];n==null&&(n=l[t.idx]);l[t.idx]=h(n,t)});if(f){p=s(f(l));p[u]=l;return p}return s(l)};c(o,function(t,i){if(s.fn[t])return;s.fn[t]=function(s){var o=e.type(s),u=t==="alpha"?this._hsla?"hsla":"rgba":n,a=this[u](),f=a[i.idx],l;if(o==="undefined")return f;if(o==="function"){s=s.call(this,f);o=e.type(s)}if(s==null&&i.empty)return this;if(o==="string"){l=r.exec(s);l&&(s=f+parseFloat(l[2])*(l[1]==="+"?1:-1))}a[i.idx]=s;return this[u](a)}})});c(n,function(t,n){e.cssHooks[n]={set:function(t,r){var i;if(e.type(r)!=="string"||(i=p(r))){r=s(i||r);if(!f.rgba&&r._rgba[3]!==1){var o,u=n==="backgroundColor"?t.parentNode:t;do o=e.curCSS(u,"backgroundColor");while((o===""||o==="transparent")&&(u=u.parentNode)&&u.style);r=r.blend(o&&o!=="transparent"?o:"_default")}r=r.toRgbaString()}t.style[n]=r}};e.fx.step[n]=function(t){if(!t.colorInit){t.start=s(t.elem,n);t.end=s(t.end);t.colorInit=!0}e.cssHooks[n].set(t.elem,t.start.transition(t.end,t.pos))}});e(function(){var e=document.createElement("div"),t=e.style;t.cssText="background-color:rgba(1,1,1,.5)";f.rgba=t.backgroundColor.indexOf("rgba")>-1});l=e.Color.names={aqua:"#00ffff",azure:"#f0ffff",beige:"#f5f5dc",black:"#000000",blue:"#0000ff",brown:"#a52a2a",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkviolet:"#9400d3",fuchsia:"#ff00ff",gold:"#ffd700",green:"#008000",indigo:"#4b0082",khaki:"#f0e68c",lightblue:"#add8e6",lightcyan:"#e0ffff",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightyellow:"#ffffe0",lime:"#00ff00",magenta:"#ff00ff",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#ffa500",pink:"#ffc0cb",purple:"#800080",violet:"#800080",red:"#ff0000",silver:"#c0c0c0",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=window.Crypto={},n=t.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return n.rotl(e,8)&16711935|n.rotl(e,24)&4278255360;for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++){t.push((e[n]>>>4).toString(16));t.push((e[n]&15).toString(16))}return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(t){if(typeof btoa=="function")return btoa(s.bytesToString(t));for(var n=[],r=0;r<t.length;r+=3){var i=t[r]<<16|t[r+1]<<8|t[r+2];for(var o=0;o<4;o++)r*8+o*6<=t.length*8?n.push(e.charAt(i>>>6*(3-o)&63)):n.push("=")}return n.join("")},base64ToBytes:function(t){if(typeof atob=="function")return s.stringToBytes(atob(t));t=t.replace(/[^A-Z0-9+\/]/ig,"");for(var n=[],r=0,i=0;r<t.length;i=++r%4){if(i==0)continue;n.push((e.indexOf(t.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|e.indexOf(t.charAt(r))>>>6-i*2)}return n}},r=t.charenc={},i=r.UTF8={stringToBytes:function(e){return s.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(s.bytesToString(e)))}},s=r.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}();(typeof Crypto=="undefined"||!Crypto.util)&&function(){var e=window.Crypto={},t=e.util={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return t.rotl(e,8)&16711935|t.rotl(e,24)&4278255360;for(var n=0;n<e.length;n++)e[n]=t.endian(e[n]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(Math.random()*256));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=(e[n]&255)<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<e.length*32;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((e[n]&15).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){if(typeof btoa=="function")return btoa(n.bytesToString(e));for(var t=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],s=0;s<4;s++)r*8+s*6<=e.length*8?t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>>6*(3-s)&63)):t.push("=");return t.join("")},base64ToBytes:function(e){if(typeof atob=="function")return n.stringToBytes(atob(e));for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),t=[],r=0,i=0;r<e.length;i=++r%4)i!=0&&t.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<i*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(r))>>>6-i*2);return t}},e=e.charenc={};e.UTF8={stringToBytes:function(e){return n.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bytesToString(e)))}};var n=e.Binary={stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n)&255);return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}}();(function(){var e=Crypto,t=e.util,n=e.charenc,r=n.UTF8,i=n.Binary,s=e.SHA1=function(e,n){var r=t.wordsToBytes(s._sha1(e));return n&&n.asBytes?r:n&&n.asString?i.bytesToString(r):t.bytesToHex(r)};s._sha1=function(e){e.constructor==String&&(e=r.stringToBytes(e));var n=t.bytesToWords(e),i=e.length*8,e=[],s=1732584193,o=-271733879,u=-1732584194,f=271733878,l=-1009589776;n[i>>5]|=128<<24-i%32;n[(i+64>>>9<<4)+15]=i;for(i=0;i<n.length;i+=16){for(var c=s,h=o,p=u,d=f,v=l,g=0;g<80;g++){if(g<16)e[g]=n[i+g];else{var y=e[g-3]^e[g-8]^e[g-14]^e[g-16];e[g]=y<<1|y>>>31}y=(s<<5|s>>>27)+l+(e[g]>>>0)+(g<20?(o&u|~o&f)+1518500249:g<40?(o^u^f)+1859775393:g<60?(o&u|o&f|u&f)-1894007588:(o^u^f)-899497514);l=f;f=u;u=o<<30|o>>>2;o=s;s=y}s+=c;o+=h;u+=p;f+=d;l+=v}return[s,o,u,f,l]};s._blocksize=16;s._digestsize=20})();$.getObject("Pb.Component.Element.Captcha",!0).Slider=function(){function e(e){this.init(e)}var t={container:null,deltaChanges:0,startTime:0,init:function(e){if(!e.container)return;this.container=e.container;this.container.find(".arrow").css({left:4}).removeClass("nodrag");this.bindEvents()},bindEvents:function(){var e=this.container.find(".arrow"),t=this;e.drag("start",function(e,n){if(!t.initialOffset){t.initialOffset=t.container.find(".arrow").offset().left;t.parentOffset=t.container.offset().left;t.mouseOffset=e.pageX-t.initialOffset}t.deltaChanges=0;t.startTime=(new Date).getTime();n.limit={};n.limit.left=t.initialOffset-t.parentOffset;n.limit.right=n.limit.left+(t.container.outerWidth()-8)-$(this).outerWidth();$(this).addClass("dragging")}).drag(function(e,n){var r=e.pageX-t.parentOffset-t.mouseOffset;$(this).css({left:Math.min(n.limit.right,Math.max(n.limit.left,r))});n.deltaX>0&&t.deltaChanges++}).drag("end",function(e,n){$(this).removeClass("dragging");var r=parseInt($(this).css("left"),10),i=n.limit.right,s="",o=(new Date).getTime();if(r/i*100>85&&t.deltaChanges>0){$(this).animate({left:i+"px"},50);t.container.data("hashCash",t.container.data("seed")+":"+t.startTime+":"+o+":"+t.deltaChanges);t.container.trigger("Pb.Component.Element.Captcha.Slider::success",{delta:t.deltaChanges,hash:s});$(this).unbind("drag").addClass("nodrag");t.deltaChanges=0}else $(this).animate({left:4},50)});$("div.sliderCaptcha").tooltip({placement:"right",delay:{show:300,hide:100}})},destroy:function(){var e=this.container.find(".arrow");e.unbind("draginit dragstart drag dragend");this.initialOffset=null;this.parentOffset=null;this.mouseOffset=null},getHashCash:function(){return this.container.data("hashCash")},on:function(e,t){e=="success"&&this.container.on("Pb.Component.Element.Captcha.Slider::success",t)},reset:function(){this.destroy();this.container.find(".arrow").css({left:4}).removeClass("nodrag");this.bindEvents()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Element.Form",!0).Honeypot=function(){function e(e){e.find(".fpc").each(function(){$(this).attr("value",$(this).data("val"))})}return{init:e}}();(function(){function e(e){e.stopImmediatePropagation();new Pb.Component.Common.Links.LinkCodes({selector:"#"+e.modal+" .linkCodes",prefix:e.modal});$("#"+e.modal+" .linkCodes").trigger({type:"Pb.Component.Common.Links.LinkCodes::refresh",objectData:Pb.Data.get("shareModal").shareObject})}$(document).on("Pb.Component.Share.ShareModal::linksTabShown",e)})();$.getObject("Pb.Path",!0).PBPath=function(){function e(e){this.pathString=decodeURIComponent(e);this.parse(this.pathString)}var t={pathFormat:/^\/?([^\/]+)\/([^\/]+)\/([^\/]+)\/(.*\/)?([^\/]+)$/,parse:function(e){var t=this.pathFormat.exec(e);if(t==null){this.albumType=null;this.vee=null;this.ownername=null;this.location=null;this.filename=null}else{this.albumType=t[1];this.vee=t[2];this.ownername=t[3];this.location=t[4]===undefined?"":t[4];this.filename=t[5]}}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Common.Links",!0).LinkCodes=function(){function e(e){this.init(e)}function t(e,t){switch(e){case"email":return"Email & IM";case"direct":return"Direct";case"html":return t==="verbose"?"HTML <span>(for eBay, Craigslist, blogs, websites)</span>":"HTML";case"htmlThumb":return"HTML thumb";case"img":return t==="verbose"?"IMG codes <span>(for forums, boards)</span>":"IMG";case"imgThumb":return"IMG thumb";case"slideshow":return"Slideshow";case"story":return"Story";case"embed":return"Embed";default:return""}}function n(e,n,r,i,s,o){var u=t(e,o),a=null;u&&(a={zclipId:i+"_zeroclipboard_"+r,cclipboardId:i+"_copycode_"+r,ccInputId:i+"_ccinput_"+r,inputLabel:u,inputText:$("<div />").html(n).text(),tracking:"share_file_get_link_code_"+e+"_click",type:s});return a}var r={init:function(e){if(!e.selector)return;this.element=$(e.selector);this.prefix=e.prefix;this.labelType=e.labelType;this.inputType=e.inputType;this.inputType||(this.inputType="input");this.linkCodesData=[];this.initEvents();this.element.length&&Pb.JSTemplates.link("#copyCodeTemplate",this.element,this.linkCodesData)},initEvents:function(){this.element.on("Pb.Component.Common.Links.LinkCodes::refresh",$.proxy(this.refresh,this))},populateCodes:function(e){var t=[],n=0;if($.isArray(e)){for(n=0;n<e.length;n++){e[n].zclipId=this.prefix+"_zeroclipboard_"+n;e[n].cclipboardId=this.prefix+"_copycode_"+n;e[n].ccInputId=this.prefix+"_ccinput_"+n}$.observable(this.linkCodesData).refresh(e);this.bindCopyCodes()}else if(!$.isEmptyObject(e)){t=this.buildLinkCodesFromArray(e);$.observable(this.linkCodesData).refresh(t);this.bindCopyCodes()}else this.element.html('<p class="noLinkCodes">No link options enabled</p>')},buildLinkCodesFromArray:function(e){var t,r=0,i,s=[];for(t in e)if(e.hasOwnProperty(t)){i=n(t,e[t],r,this.prefix,this.inputType,this.labelType);if(i){s.push(i);r++}}return s},refresh:function(e){var t,n,r,i,s,o;if(e.objectData&&e.objectData.linkcodes){t=e.objectData.linkcodes;if(typeof t=="string"){t=$.parseJSON(t);e.objectData.linkcodes=t}this.populateCodes(t)}else if(e.objectData.type==="Pb_Component_Media_MediaThumbnail"||e.objectData.type==="Pb_Component_Library_MediaSelector_MediaThumbnail"){if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);n=new Pb.Path.PBPath(e.objectData.path);r=Pb.Media.MediaIdentifierFactory.getIdentifier(n);i={type:"GET",url:"/api/user/"+n.ownername+"/media/"+encodeURIComponent(r)+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="album"){var u;if(e.objectData.linkCodesConfig){o=e.objectData.linkCodesConfig;t=[];for(s=0;s<o.length;s++)t[o[s]]="Loading...";$.observable(this.linkCodesData).refresh(this.buildLinkCodesFromArray(t))}else $.observable(this.linkCodesData).refresh([]);u=e.objectData.path.split("/");if(u.length<3)return;var a=u[2];n=u.slice(3).join("/");i={type:"GET",url:"/api/user/"+a+"/album/"+n+"/links",error:$.proxy(this.onRetrieveLinksError,this),success:$.proxy(function(t){this.onRetrieveLinksSuccess(t,e.objectData)},this)};Pb.Ajax.ajax(i)}else if(e.objectData.type==="recent"){var t=this.buildLinkCodesFromArray({email:Pb.Data.Albums.getRootAlbum().url});e.objectData.linkcodes=t;this.populateCodes(t)}else if(e.objectData.data.type==="recent"){var t=this.buildLinkCodesFromArray({email:e.objectData.data.url});e.objectData.linkcodes=t;this.populateCodes(t)}},bindCopyCodes:function(){var e=Pb.Component.Common.CopyCode.CopyCode,t=0;for(t=0;t<this.linkCodesData.length;t++)e.createZeroClipboard("#"+this.linkCodesData[t].ccInputId,!1)},onRetrieveLinksError:function(e,t,n){typeof console!="undefined"&&console.error(n)},onRetrieveLinksSuccess:function(e,t){t.linkcodes=e.data;this.populateCodes(e.data)}};$.extend(e.prototype,r);$.views.helpers({buildLinkCodeData:n,getLinkCodeLabel:t,unescapeLinkCode:function(e){return $("<div />").html(e).text()}});return e}();(function(){"use strict";var e=function(e,t){var n=e.style[t];e.currentStyle?n=e.currentStyle[t]:window.getComputedStyle&&(n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t));if(n=="auto"&&t=="cursor"){var r=["a"];for(var i=0;i<r.length;i++)if(e.tagName.toLowerCase()==r[i])return"pointer"}return n},t=function(e){if(!c.prototype._singleton)return;e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement);c.prototype._singleton.setCurrent(t)},n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},r=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},i=function(e,t){if(e.addClass){e.addClass(t);return e}if(t&&typeof t=="string"){var n=(t||"").split(/\s+/);if(e.nodeType===1)if(!e.className)e.className=t;else{var r=" "+e.className+" ",i=e.className;for(var s=0,o=n.length;s<o;s++)r.indexOf(" "+n[s]+" ")<0&&(i+=" "+n[s]);e.className=i.replace(/^\s+|\s+$/g,"")}}return e},s=function(e,t){if(e.removeClass){e.removeClass(t);return e}if(t&&typeof t=="string"||t===undefined){var n=(t||"").split(/\s+/);if(e.nodeType===1&&e.className)if(t){var r=(" "+e.className+" ").replace(/[\n\t]/g," ");for(var i=0,s=n.length;i<s;i++)r=r.replace(" "+n[i]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},o=function(t){var n={left:0,top:0,width:t.width||t.offsetWidth||0,height:t.height||t.offsetHeight||0,zIndex:1000050},r=e(t,"zIndex");r&&r!="auto"&&(n.zIndex=parseInt(r,10));n.left=$(t).offset().left;while(t){var i=parseInt(e(t,"borderLeftWidth"),10),s=parseInt(e(t,"borderTopWidth"),10);$(t).scrollLeft()&&(n.left+=$(t).scrollLeft()*-1);n.left+=isNaN(i)?0:i;n.top+=isNaN(t.offsetTop)?0:t.offsetTop;n.top+=isNaN(s)?0:s;t=t.offsetParent}return n},u=function(e){return(e.indexOf("?")>=0?"&":"?")+"nocache="+(new Date).getTime()},a=function(e){var t=[];e.trustedDomains&&(typeof e.trustedDomains=="string"?t.push("trustedDomain="+e.trustedDomains):t.push("trustedDomain="+e.trustedDomains.join(",")));return t.join("&")},f=function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1},l=function(e){if(typeof e=="string")throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},c=function(e,t){e&&(c.prototype._singleton||this).glue(e);if(c.prototype._singleton)return c.prototype._singleton;c.prototype._singleton=this;this.options={};for(var n in d)this.options[n]=d[n];for(var r in t)this.options[r]=t[r];this.handlers={};c.detectFlashSupport()&&v()},h,p=[];c.prototype.setCurrent=function(t){h=t;this.reposition();t.getAttribute("title")&&this.setTitle(t.getAttribute("title"));this.setHandCursor(e(t,"cursor")=="pointer")};c.prototype.setText=function(e){if(e&&e!==""){this.options.text=e;this.ready()&&this.flashBridge.setText(e)}};c.prototype.setTitle=function(e){e&&e!==""&&this.htmlBridge.setAttribute("title",e)};c.prototype.setSize=function(e,t){this.ready()&&this.flashBridge.setSize(e,t)};c.prototype.setHandCursor=function(e){this.ready()&&this.flashBridge.setHandCursor(e)};c.version="1.1.7";var d={moviePath:"http://pic2.pbsrc.com/flash/ZeroClipboardFV3.swf",trustedDomains:document.location.hostname,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"always"};c.setDefaults=function(e){for(var t in e)d[t]=e[t]};c.destroy=function(){c.prototype._singleton.unglue(p);var e=c.prototype._singleton.htmlBridge;e.parentNode.removeChild(e);delete c.prototype._singleton};c.detectFlashSupport=function(){var e=!1;try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0)}return e};var v=function(){var e=c.prototype._singleton,t=document.getElementById("global-zeroclipboard-html-bridge");if(!t){var n='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+e.options.moviePath+u(e.options.moviePath)+'"/>         <param name="allowScriptAccess" value="'+e.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+a(e.options)+'"/>         <embed src="'+e.options.moviePath+u(e.options.moviePath)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+a(e.options)+'"           scale="exactfit">         </embed>       </object>';t=document.createElement("div");t.id="global-zeroclipboard-html-bridge";t.setAttribute("class","global-zeroclipboard-container");t.setAttribute("data-clipboard-ready",!1);t.style.position="absolute";t.style.left="-9999px";t.style.top="-9999px";t.style.width="15px";t.style.height="15px";t.style.zIndex="1000050";t.innerHTML=n;document.body.appendChild(t)}e.htmlBridge=t;e.flashBridge=document["global-zeroclipboard-flash-bridge"]||t.children[0].lastElementChild};c.prototype.resetBridge=function(){this.htmlBridge.style.left="-9999px";this.htmlBridge.style.top="-9999px";this.htmlBridge.removeAttribute("title");this.htmlBridge.removeAttribute("data-clipboard-text");s(h,this.options.activeClass);h=null;this.options.text=null};c.prototype.ready=function(){var e=this.htmlBridge.getAttribute("data-clipboard-ready");return e==="true"||e===!0};c.prototype.reposition=function(){if(!h)return!1;var e=o(h);this.htmlBridge.style.top=e.top+"px";this.htmlBridge.style.left=e.left+"px";this.htmlBridge.style.width=e.width+"px";this.htmlBridge.style.height=e.height+"px";this.htmlBridge.style.zIndex=e.zIndex+1;this.setSize(e.width,e.height)};c.dispatch=function(e,t){c.prototype._singleton.receiveEvent(e,t)};c.prototype.on=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");this.handlers[e]||(this.handlers[e]=t)}this.handlers.noflash&&!c.detectFlashSupport()&&this.receiveEvent("onNoFlash",null)};c.prototype.addEventListener=c.prototype.on;c.prototype.off=function(e,t){var n=e.toString().split(/\s/g);for(var r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");for(var i in this.handlers)i===e&&this.handlers[i]===t&&delete this.handlers[i]}};c.prototype.removeEventListener=c.prototype.off;c.prototype.receiveEvent=function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");var n=h;switch(e){case"load":if(t&&parseFloat(t.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10){this.receiveEvent("onWrongFlash",{flashVersion:t.flashVersion});return}this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":i(n,this.options.hoverClass);break;case"mouseout":s(n,this.options.hoverClass);this.resetBridge();break;case"mousedown":i(n,this.options.activeClass);break;case"mouseup":s(n,this.options.activeClass);break;case"datarequested":var r=n.getAttribute("data-clipboard-target"),o=r?document.getElementById(r):null;if(o){var u=$(o).closest(".copycode").attr("data-clipboard-text");u&&this.setText(u)}else{var a=n.getAttribute("data-clipboard-text");a&&this.setText(a)}break;case"complete":this.options.text=null}if(this.handlers[e]){var f=this.handlers[e];typeof f=="function"?f.call(n,this,t):typeof f=="string"&&window[f].call(n,this,t)}};c.prototype.glue=function(e){e=l(e);for(var r=0;r<e.length;r++)if(f(e[r],p)==-1){p.push(e[r]);n(e[r],"mouseover",t)}};c.prototype.unglue=function(e){e=l(e);for(var n=0;n<e.length;n++){r(e[n],"mouseover",t);var i=f(e[n],p);i!=-1&&p.splice(i,1)}};typeof module!="undefined"?module.exports=c:window.ZeroClipboard=c})();$.getObject("Pb.Component.Common.CopyCode",!0).CopyCode=function(){function e(e){var t=e.closest(".zeroclipboard").data("tracking");t&&Pb.Track.trf(t)}function t(t){t.attr("readonly",!1);t.click(function(){t.select();e(t)});$(t).on("keydown cut",function(e){e.keyCode!==9&&e.preventDefault()})}function n(n,r){var i=$(n),s=swfobject.getFlashPlayerVersion(),o,u,a,f,l,c,h,p,d;if(r||s.major<9){t(i);return}var v=[];f=i.val();l=i.closest(".copycode");c=i.closest(".zeroclipboard");if(!l.length||!c.length){a=n.split(" ");if(a.length===1)p=n.split("_");else{h=a[a.length-1];p=h.split("_")}d=p[0];d.match(/^[.#]/)&&(d=d.substring(1));u=p[2];v.push(document.getElementById(d+"_copycode_"+u))}else v.push(l[0]);o=new ZeroClipboard(v);o.addEventListener("onComplete",function(t,n){i=$(this).find("input");i.length===0&&(i=$(this).find("textarea"));n.text===i.val()&&i.val("Copied").css("backgroundColor","#FFFF66").fadeTo("normal",.4,function(){$(this).fadeTo("normal",1,function(){$(this).css("backgroundColor","#FFFFFF").val(n.text)});e(i)})})}return{createZeroClipboard:n}}();$.getObject("Pb.Component.Detail",!0).Options=function(){function e(e){this.init(e)}var t={isLoggedIn:!1,isCompact:!1,actionTargetNormalId:"#detailOptions",actionTargetCompactId:"#detailOptionsCompact",actionTarget:null,actionTemplate:"#detailOptionsTemplate",actionData:[],defaultActionData:[],eventRegister:null,currentMedia:null,currentMediaUrl:null,currentMediaIsOwner:!1,rotatePostUrl:"/action/media/rotate",init:function(e){this.defaultActionData=e;this.actionData=$.extend(!0,{},this.defaultActionData);this.setCurrentMedia(Pb.Data.Shared.get(Pb.Data.Shared.MEDIA));this.getElements();for(var t=0;t<this.actionData.eventRegister.length;t++)$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:this.actionData.eventRegister[t].eventSelector,eventType:this.actionData.eventRegister[t].eventType,event:this.actionData.eventRegister[t].event}}));this.bindEvents();this.link();$(this.actionTargetNormalId).tooltip({placement:"right",selector:".btn",delay:{show:300,hide:100}});$(".sharing_list").on("click",function(e){var t=$(e.target).parents(".sh_btn").attr("id");(t==="wordpress"||t==="sharethis")&&Pb.Track.trf("detail_page_share_"+t+"_click")});$("#more_sharing_more").click(function(){$("#more_sharing_less").removeClass("dim");$(this).addClass("dim");$(".sharing_list").addClass("more")});$("#more_sharing_less").click(function(){$("#more_sharing_more").removeClass("dim");$(this).addClass("dim");$(".sharing_list").removeClass("more")})},fetchShareThis:function(){typeof stLight=="undefined"?$.ajax({url:"http://w.sharethis.com/button/buttons.js",dataType:"script",success:$.proxy(function(){stLight.options({publisher:"6b3cc47e-c11d-420e-a208-11704eb2c43b"});stLight.subscribe("click",this.trackShareThis);this.updateShareThis()},this),cache:!0}):this.updateShareThis()},updateShareThis:function(){if(typeof stWidget!="undefined"){$(".sharing_list span").empty();var e=this;$(".sharing_list span").each(function(t,n){stWidget.addEntry({service:$(this).attr("id"),element:this,url:e.currentMedia.linkUrl,title:e.currentMedia.titleOrFilename,type:"large",image:e.currentMedia.fullsizeUrl})})}},trackShareThis:function(e,t){Pb.Track.trf("detail_page_share_"+t+"_"+e)},setCurrentMedia:function(e){this.isLoggedIn=Pb.Data.get("isLoggedIn");this.currentMedia=e;this.currentMediaUrl=e.fullsizeUrl;this.currentMediaIsOwner=e.io;this.actionData.iconLink.items=this.setOwnerOptionPerms(this.actionData.iconLink);this.actionData.dropdownLink.items=this.setOwnerOptionPerms(this.actionData.dropdownLink)},setOwnerOptionPerms:function(e){var t=[],n=this.currentMedia.mediaType==="image";for(var r=0;r<e.length;r++){var i=e[r];i.jsAttributes.checkperms?i.jsAttributes.identifier==="printdecor"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="metalprints"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="prints"?this.currentMedia.cp&&t.push(i):i.jsAttributes.identifier==="effects"?this.currentMedia.cd&&n&&t.push(i):i.jsAttributes.identifier==="move"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="rotateleft"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="crop"?this.currentMedia.cd&&n&&t.push(i):i.jsAttributes.identifier==="rotateright"?this.currentMediaIsOwner&&n&&t.push(i):i.jsAttributes.identifier==="delete"?this.currentMediaIsOwner&&t.push(i):i.jsAttributes.identifier==="download"?this.currentMedia.cd&&this.currentMedia.downloadUrl&&t.push(i):i.jsAttributes.identifier==="copy"?this.currentMedia.cd&&t.push(i):i.jsAttributes.identifier==="flag"?this.currentMediaIsOwner||t.push(i):i.jsAttributes.identifier==="story"?this.currentMediaIsOwner&&this.currentMedia.mediaType!=="flash"&&this.currentMedia.mediaType!=="slideshow"&&t.push(i):this.currentMediaIsOwner&&t.push(i):t.push(i)}return t},getElements:function(){this.actionTarget=$("#detailOptions")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleMediaContentUpdate,this));$("#mediaTemplate").on("mouseenter","#optionsBtn",$.throttle(300,function(){$("#detailOptionsMenu").show()})).on("mouseenter",".detailHoverBtn:not(#optionsBtn)",$.throttle(100,function(){$("#detailOptionsMenu").hide()})).on("mouseleave","#detailOptionsMenu",$.throttle(100,function(){$("#detailOptionsMenu").hide()})).on("mouseleave",$.throttle(100,function(){$("#detailOptionsMenu").hide()}));this.bindActions()},bindActions:function(){var e=$(document);e.on("Options::download",$.proxy(function(e){var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);document.location="/component/Download-File?file="+encodeURIComponent(t.path);Pb.Component.Ad.AdRefresh.reloadAds()},this));e.on("Options::move",$.proxy(function(e){$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::edit2",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::effects",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=effects&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::crop",$.proxy(function(e){document.location="/editor?image="+escape(this.currentMediaUrl)+"&tool=crop&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("Options::delete",$.proxy(function(e){$(document).trigger($.Event("DeleteMediaModal::show",{pbData:e.pbData,pbEventTarget:e.pbEventTarget}))},this));e.on("click","#viewalbum",function(){var e=/\d+/.exec(Pb.Data.get(Pb.Data.Shared.MEDIA).subdomain)[0];document.location="http://s"+e+".photobucket.com/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/library/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location});e.on("Options::copy",$.proxy(function(e){var t=e.pbData?e.pbData:Pb.Data.get(Pb.Data.Shared.MEDIA);$(document).trigger($.Event("CopyMoveMediaModal::show",{pbData:t,pbEventTarget:e.pbEventTarget}))},this));e.on("Options::rotateleft",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:270},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this));e.on("Options::rotateright",$.proxy(function(e){var t={mediaUrl:this.currentMediaUrl,degrees:90},n={url:this.rotatePostUrl,type:"POST",data:t,showProgressModal:!0,progressTitle:"Rotating photo",success:$.proxy(function(e){this.handleEditResponse(e)},this)};Pb.Ajax.ajax(n)},this))},handleMediaContentUpdate:function(e){this.setCurrentMedia(e.newTarget);if(this.isCompact){$("#mediaTemplateTarget").append('<div id="detailOptionsCompact" class="detailOptions detailOptionsCompact"></div>');this.actionTarget=$(this.actionTargetCompactId)}this.link();this.fetchShareThis();this.currentMedia.mediaType==="image"?$(".imageOnly").removeClass("hide"):$(".imageOnly").addClass("hide")},link:function(){Pb.JSTemplates.link(this.actionTemplate,this.actionTarget,this.actionData);Pb.JSTemplates.link("#detailOptionsDropdown","#detailOptionsMenu",this.actionData)},removeActionTarget:function(){this.actionTarget.off();this.actionTarget.parent()[0].removeChild(this.actionTarget[0])},handleEditResponse:function(e){e.status===1&&setTimeout(function(){document.location.reload()},1e3)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Media.Delete",!0).DeleteMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={init:function(t){var n={eventName:"DeleteMediaModal::show",modalId:"#deleteMediaModal",modalName:"deleteMediaModal",submitButtonId:"#deleteMediaSubmitButton",submitUrl:"/action/media/delete",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".deleteMediaAction",eventType:"click",event:this.eventName}}))},buildSubmitData:function(){var e=$(this.modalId).find("> form [name=mediaPath]"),t=[];e.each(function(){t.push($(this).val())});return{mediaPath:t}},onShow:function(t){e.superclass.onShow.call(this,t);var n=$(this.modalId).find("form"),r=[],i,s=[],o,u,a;this.modalData=t.pbData;this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);if($.isArray(this.modalData))for(o=0;o<this.modalData.length;o++){r.push(this.modalData[o].titleOrFilename);s.push(this.modalData[o].path)}else{r.push(this.modalData.titleOrFilename);s.push(this.modalData.path)}r.length===1?i="'"+r[0]+"'":i="the selected "+r.length+" photos or videos";a=this.modalData.mediaType;i=unescape(i.replace(/\+/g," "));$("#deleteMediaTitle").text(i);$("#deleteMediaPronoun").text(a);$(this.modalId).find("input[name=mediaPath]").remove();for(o=0;o<s.length;o++){u=$('<input type="hidden" name="mediaPath" />');u.val(s[o]);n.append(u)}},onSuccess:function(e){e.status===1&&(!this.refreshOnSuccess||Pb.Data.Albums?$(document).trigger("MediaDelete::deleteMediaCompleted",e.data):location.href=e.data.albumUrl)}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();$.getObject("Pb.Component.Media.CopyMove",!0).CopyMoveMediaModal=function(){function e(){e.superclass.constructor.call(this)}var t={copy:!0,location:null,destUrl:null,chooser:null,init:function(t){var n={eventName:"CopyMoveMediaModal::show",modalId:"#copyMoveMediaModal",modalName:"copyMoveMediaModal",submitButtonId:"#copyMoveMediaSubmitButton",showProgress:!0,refreshAdsOnHide:!0};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents(n)},initEvents:function(e){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".copyMoveMediaAction",eventType:"click",event:e.eventName}}))},buildSubmitData:function(){var e=$("#copyMoveMediaSubdomain").val(),t=$(this.modalId).find("> form [name=mediaUrl]"),n;if(this.copy){this.submitUrl="/action/media/copy";n=t.val()}else{this.submitUrl="/action/media/move";n=[];t.each(function(){n.push($(this).val())})}var r={albumPath:$("#copyMoveMediaAlbumPath").val(),mediaUrl:n,albumUrl:this.destUrl,subdomain:e};return r},onShow:function(t){var n=Pb.Data.get("isLoggedIn");if(!n){location.href="/login?returnUrl="+encodeURIComponent(document.location.href);return}this.modalData=t.pbData;$.isArray(this.modalData)||(this.modalData=[this.modalData]);this.determineMode(t.pbEventTarget);t.headerTitle=this.getHeaderTitle();this.refreshOnSuccess=!0;t.hasOwnProperty("refreshOnSuccess")&&(this.refreshOnSuccess=t.refreshOnSuccess);this.bulkAction=!1;t.hasOwnProperty("bulkAction")&&(this.bulkAction=t.bulkAction);e.superclass.onShow.call(this,t);var r=$("#copyMoveMediaAlbumChooser");r.on("AlbumChooserDropdown::albums_loading.copyMoveMediaModal",$.proxy(this.onAlbumsLoading,this));r.on("AlbumChooserDropdown::albums_loaded.copyMoveMediaModal",$.proxy(this.onAlbumsLoaded,this));r.on("AlbumChooserDropdown::album_selected.copyMoveMediaModal",$.proxy(this.onAlbumSelected,this));var i=Pb.Data.get("currentAlbum");this.chooser=new Pb.Component.Album.Chooser.AlbumChooserDropdown({albumChooserId:"#copyMoveMediaAlbumChooser",filter:i?"self":"none"});this.loadAlbums(this.getAlbumPath())},loadAlbums:function(e){$("#copyMoveMediaSubmitButton").val(this.getButtonLabel()).attr("disabled",!0);this.chooser.loadAlbums(e)},onAlbumsLoading:function(){$("#copyMoveMediaAlbumChooser .dropdown").hide()},onAlbumsLoaded:function(){$("#copyMoveMediaAlbumChooser .dropdown").show();this.chooser.setSelectedAlbum()},onAlbumSelected:function(e){this.destUrl=e.albumData.albumurl;$("#copyMoveMediaSubmitButton").attr("disabled",!1)},onSuccess:function(e){if(e.status===1)if(!this.refreshOnSuccess||Pb.Data.Albums){var t="CopyMoveMediaModal::moveSuccess";this.copy&&(t="CopyMoveMediaModal::copySuccess");$(document).trigger({type:t,response:e})}else{var n=e.data.albumUrl;location.host.indexOf("media.")>=0&&(n=location.protocol+"//"+location.host.replace("media.","")+n);location.href=n}},determineMode:function(e){var t=$(e);if(typeof t!="object"){this.copy=!0;return}var n=t.data("copymovemode");n?this.copy=n==="move"?!1:!0:this.copy=t.text().toLowerCase()==="move"?!1:!0},getHeaderTitle:function(e){return this.copy?"Copy to album":"Move to album"},prepareDataForTemplate:function(e){e.label=this.getLabel();e.mediaUrls=this.getMediaUrls();e.albumPath=this.getAlbumPath();e.copy=this.copy;return e},getLabel:function(){var e="Where do you want to ",t,n=[],r;this.copy?e+="copy ":e+="move ";for(r=0;r<this.modalData.length;r++)n.push(this.modalData[r].titleOrFilename);n.length===1?t="'"+n[0]+"'":t="the selected "+n.length+" photos or videos";t=unescape(t.replace(/\+/g," "));e+=t;e+=" to?";return e},getMediaUrls:function(){var e,t,n=[];for(e=0;e<this.modalData.length;e++){t=this.modalData[e].fullsizeUrl;n.push(t)}return n},getAlbumPath:function(){return this.modalData.length>0?this.modalData[0].albumPath:null},getButtonLabel:function(){return this.copy?"Copy":"Move"}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init();return n}();(function(){function e(){e.superclass.constructor.call(this)}var t={modal:null,init:function(t){var n={modalId:"#reportModal",modalName:"reportModal",eventName:"ReportModal::show",submitUrl:"/action/flag/media",submitButtonId:"#reportModalSubmitButton"};t&&$.extend(n,t);e.superclass.init.call(this,n);this.initEvents()},initEvents:function(){$(document).trigger($.Event("ActionEventsDispatcher::registerevent",{pbEvent:{eventSelector:".showReportModal",eventType:"click",event:this.eventName}}))},bindModalEvents:function(){var t=$(this.modalId);if(t.length){t.find("input[name=type]").on("change",$.proxy(this.onTypeChange,this));e.superclass.bindModalEvents.call(this)}},onShow:function(t){var n=!1;if(t.pbData){t.pbData.fullsizeUrl&&(this.mediaUrl=t.pbData.fullsizeUrl);t.pbData.hashtagMedia&&(n=!0)}this.mediaUrl||(this.mediaUrl=$(t.pbEventTarget).data("url"));this.mediaUrl||(this.mediaUrl=Pb.Data.get("shared.media").fullsizeUrl);e.superclass.onShow.call(this,t);n?$("#reportType input[value=hashtag]").parent().show():$("#reportType input[value=hashtag]").parent().hide()},onHide:function(e){var t=$(this.modalId).find("form");t.length&&t.get(0).reset();this.mediaUrl=null},onSubmit:function(t){t.preventDefault();this.validate()&&e.superclass.onSubmit.call(this,t)},buildSubmitData:function(){var e=$(this.modalId).find("form"),t={type:e.find('input[name="type"]:checked').val(),comment:e.find("#reportComment").val(),email:e.find("#reportEmail").val(),mediaUrl:this.mediaUrl};return t},validate:function(){var e=$(this.modalId).find("form"),t=e.find('input[name="type"]:checked'),n=e.find("#reportComment"),r=e.find("#reportEmail"),i;if(t.val()==="racism"||t.val()==="other"){$(".control-group",this.form).removeClass("error");$(".help-inline",this.form).html("");if(n.val()===""){i="Please provide comments for your report";n.parents(".control-group").addClass("error");n.parents(".controls").find(".help-inline").html(i);return!1}if(r.val()===""){i="Please provide an email address";r.parents(".control-group").addClass("error");r.parents(".controls").find(".help-inline").html(i);return!1}}return!0},onTypeChange:function(e){var t=$(e.currentTarget).val(),n=$(this.modalId);if(t==="nudity"){n.find(".reportExtra").hide();n.find("input[type=submit]").show()}else if(t==="dmca"){n.find(".reportExtra").hide();Pb.Component.Element.Message.show({status:1,message:'If you own the copyright to material on the Photobucket site, please file an official Digital Millennium Copyright Act (DMCA) complaint by following the instructions posted on our <a href="/copyright/" target="_blank">Copyright policy page</a>.'});n.find("input[type=submit]").hide()}else{n.find(".reportExtra").show();n.find("input[type=submit]").show()}}};Pb.subclass(e,Pb.Component.Element.Modal,t);var n=new e;n.init()})();$.getObject("Pb.Component.Common.Likes",!0).Likes=function(){function e(){this.init()}var t={isLoggedIn:null,likeUrl:"/action/likes/like",unlikeUrl:"/action/likes/unlike",clickTarget:null,init:function(){this.isLoggedIn=Pb.Data.get("isLoggedIn");var e=$(document);e.on("click","a.like",$.proxy(this.handleLikeClick,this));e.on("click","a.unlike",$.proxy(this.handleUnLikeClick,this));e.on("mouseenter","a.unlike",$.proxy(this.handleUnLikeHoverOn,this));e.on("mouseleave","a.unlike",$.proxy(this.handleUnLikeHoverOut,this));e.on("click","a.likelogin",$.proxy(this.handleLikeLogin,this))},handleUnLikeHoverOn:function(e){var t=$(e.currentTarget+":not(.detailHoverBtn)"),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-secondary").addClass("btn-primary");r.removeClass("heartfill").addClass("heartempty");n.text("UnLike")},handleUnLikeHoverOut:function(e){var t=$(e.currentTarget),n=t.find(".liketext"),r=t.find(".heart");t.removeClass("btn-primary").addClass("btn-secondary");r.removeClass("heartempty").addClass("heartfill");n.text("Liked")},handleLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.likeUrl,data:r,success:$.proxy(this.handleLikeResponse,this)})},handleLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".unlike");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get("shared.media").offset,r=Pb.Data.Shared.get("shared.mediaSet")[n],i=parseInt(r.likeCount,10);isNaN(i)||(r.likeCount=i>=0?i+1:0);r.isLiked=!0;r.isPersisted=!0;$("#likeCount").html(r.likeCount)}if(this.clickTarget.data("context")==="as"){var s=this.clickTarget.parents(".activityEvent"),o=s.attr("id").split("_").pop(),u=s.data("objectid"),a=$.Event("Pb.Component.Common.Likes::like_added");a.rowIndex=o;a.objectId=u;$(".activitiesTarget").trigger(a)}else $(document).trigger($.Event("Pb.Component.Common.Likes::like_click"));if(this.clickTarget.data("context")==="story"){this.clickTarget.hide();this.clickTarget.siblings().filter(".unlike").show();var f=$("#end-of-story").find(".stat.likes .count"),l=parseInt(f.text(),10);isNaN(l)||(l=l>=0?l+1:0);f.text(l)}}},handleUnLikeClick:function(e){if(!this.isLoggedIn){var t=$(e.currentTarget);t.tooltip({delay:{show:2e3,hide:2e3}});t.tooltip("show");return}this.clickTarget=$(e.currentTarget);var n=this.clickTarget.data("likeurl"),r={likeableUrl:n};Pb.Ajax.ajax({url:this.unlikeUrl,data:r,success:$.proxy(this.handleUnLikeResponse,this)})},handleUnLikeResponse:function(e){if(e.status===1){if(this.clickTarget.data("context")==="detail"){var t=this.clickTarget.siblings(".like");t.show();this.clickTarget.hide();var n=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA),r=parseInt(n.likeCount,10);isNaN(r)||(n.likeCount=r>0?r-1:0);n.isLiked=!1;$("#likeCount").html(n.likeCount)}if(this.clickTarget.data("context")==="as"){var i=this.clickTarget.parents(".activityEvent"),s=i.attr("id").split("_").pop(),o=i.data("objectid"),u=$.Event("Pb.Component.Common.Likes::like_removed");u.rowIndex=s;u.objectId=o;$(".activitiesTarget").trigger(u)}if(this.clickTarget.data("context")==="story"){this.clickTarget.hide();this.clickTarget.siblings().filter(".like").show();var a=$("#end-of-story").find(".stat.likes .count"),f=parseInt(a.text(),10)-1;a.text(f)}}},handleLikeLogin:function(e){var t=encodeURIComponent(document.location.href);document.location.href="/login?returnUrl="+t}};$.extend(e.prototype,t);return e}();Pb.InitEventQueue.addToDomReady(function(){var e=new Pb.Component.Common.Likes.Likes});$.getObject("Pb.Component.Media",!0).Media=function(){function l(e){this.init(e)}var e=1e3,t=620,n=1024,r=580,i=320,s=225,o=1024,u=350,a=320,f=240,c={currentTarget:null,canEdit:!1,canCopy:!1,isMobile:!1,mediaTemplateTarget:null,mediaImg:null,mediaTitle:null,mediaDesc:null,commentCnt:null,rescaler:null,windowResizeBound:!1,winWidth:null,winHeight:null,pendingLoad:!1,direction:1,showPagination:!0,mediaSet:null,mediaMaxDims:{},swfDims:{},expressInstallPath:"/resources/common/swf/expressInstall.swf",init:function(e){var t=new Image;t.src=Pb.Data.get("picUrl")+"common/loading.gif";e.currentTarget&&(this.currentTarget=e.currentTarget);e.canEdit&&(this.canEdit=!0);e.canCopy&&(this.canCopy=!0);this.showPagination=e.showPagination;this.isMobile=Pb.Data.get("isMobile");this.rescaler=new Pb.ClientImageRescaler;this.getElements();this.setMediaMaxDims();this.addHelpers();this.bindEvents();this.preloadMediaFullsize()},getElements:function(){this.mediaTemplateTarget=$("#mediaTemplateTarget");this.mediaTemplate=$("#mediaTemplate");this.optionsHandle=$("#optionsBtn");this.mediaImg=$(".mediawrapper.currentMedia img")},addHelpers:function(){var e={shortText:function(e,t){return e?e.length>t?e.substring(0,t-3)+"...":e:""},toggleFullTitleLink:function(e,t){return e?e.length>t:!1}};$.views.helpers(e);return e},bindEvents:function(){var e=$(document);e.on("Detail::first_batch_received",$.proxy(function(e){this.currentTarget=Pb.Data.get(Pb.Data.Shared.MEDIA);this.mediaSet=Pb.Data.Shared.get("shared.mediaSet");if(this.isMobile&&typeof Pb.Animation!="undefined"){this.currentTarget.sequence="currentMedia";this.resizeMediaToFitWindow(e)}},this));e.on("Pb.Component.Media.Media::preloadMediaFullsize",$.proxy(this.handleMediaFullsizePreload,this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.handleTemplateUpdate,this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.hidePagination,this));e.on("Pb.Component.Media.Media::replacePlaceHolder",$.proxy(this.resizeMediaToFitWindow,this));e.on("Pb.Component.Detail.Detail::current_media_update",$.proxy(this.handleMediaContentUpdate,this));e.on("click","#editBtn",$.proxy(function(e){document.location="/editor?image="+escape(this.currentTarget.fullsizeUrl)+"&detailUrl="+Pb.Data.get(Pb.Data.Shared.MEDIA).linkUrl},this));e.on("click","#slideshowBtn",$.proxy(function(e){document.location="/user/"+Pb.Data.get(Pb.Data.Shared.MEDIA).ownername+"/slideshow/"+Pb.Data.get(Pb.Data.Shared.MEDIA).location},this));e.on("click",".like",function(){Pb.Track.tr("detailpage_like_click")});e.on("click",".unlike",function(){Pb.Track.tr("detailpage_unlike_click")});this.mediaTemplate.on("click","#zoomBtn",$.proxy(function(e){if(this.currentTarget.mediaType==="video")return;Pb.Track.tr("detail_page_zoom_click");this.currentTarget.maxWidth=$(window).width();$(".contentWrapper").addClass("zoomed");Pb.JSTemplates.link("#zoomOriginalTemplate",".contentWrapper",this.currentTarget);Pb.Component.Ad.AdRefresh.reloadAds();var t={path:this.currentTarget.path,url:this.currentTarget.originalUrl,title:this.currentTarget.name};window.history.pushState(t,this.currentTarget.name,this.currentTarget.linkUrl);window.onpopstate=function(e){document&&window.location.reload()}},this));this.isMobile||this.mediaTemplate.hoverIntent({over:function(){$(".hoverOptions").fadeIn(100);$(".imageController").show()},out:function(){$(".hoverOptions").fadeOut(100);$(".imageController").hide()}});$(window).resize($.throttle(500,$.proxy(function(e){var t=$(window).width(),n=$(window).height();if(t!==this.winWidth||n!==this.winHeight){this.winWidth=t;this.winHeight=n;this.resizeMediaToFitWindow(e)}},this)));if(!this.canEdit&&!this.canCopy){e.on("contextmenu",".imageController",function(e){e.preventDefault()});e.on("contextmenu",".mediawrapper",function(e){e.preventDefault()})}else{e.on("mousedown",".is_moz .imageController",function(e){if(e.button===2){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()}});e.on("mouseenter mouseleave",".is_moz .contextMenu",$.proxy(this.mozHideContextMenu,this));e.on("mouseenter mouseleave",".is_moz .contextMenu img",$.proxy(this.mozHideContextMenu,this));e.on("mouseup",".imageController",$.proxy(function(e){e.button===2&&this.showContextMenu(e)},this));e.on("contextmenu",".imageController",$.proxy(this.showContextMenu,this))}},mozShowContextMenu:function(e){e.stopPropagation();$(".contentWrapper").addClass("contextMenu");$(".imageController").hide()},mozHideContextMenu:function(e){$(".contextMenu").removeClass("contextMenu");$(".imageController").show()},showContextMenu:function(e){e.stopPropagation();$(".imageController").hide();setTimeout(function(){$(".imageController").show()},1e3)},bindInPlaceEditors:function(){if(!this.canEdit||this.isMobile)return;var e=this;this.mediaTitle=$("#mediaTitle");this.mediaTitle.length>0&&this.mediaTitle.find(".editable-field").first().editInPlace({callback:function(t,n,r){e.updateTitle(n,r);n===""&&(n="Click to add title");return n},show_buttons:!0,save_button:'<button class="btn btn-small btn-primary inplace_save icon-ok"></button>',cancel_button:'<button class="btn btn-small inplace_cancel icon-remove"></button>',default_text:"Click to add title",short_text:!1,maxlength:250,checkFullValue:!0,pb_track:function(){Pb.Track.trf("detailpage_title_click")},pb_validation:function(e){var t=!0;e=$.trim(e);if(e.length>250){var n={status:0,message:"Title cannot be more than 250 characters",details:""};Pb.Component.Element.Message.show(n);t=!1}return t},pb_helpers:this.addHelpers()})},preloadMediaFullsize:function(){if(this.currentTarget.mediaType!=="image")!this.isMobile&&typeof Pb.Animation=="undefined"&&this.resizeMediaToFitWindow();else if(!this.currentTarget.fsWidth){this.isMobile&&typeof Pb.Animation!="undefined"&&(this.windowResizeBound=!0);var e=new Pb.ClientImagePreloader,t=[this.currentTarget.fullsizeUrl];e.preLoad("Pb.Component.Media.Media::preloadMediaFullsize",t)}},handleMediaFullsizePreload:function(e){var t=e.dimensions[this.currentTarget.fullsizeUrl];this.currentTarget.fsWidth=t.width;this.currentTarget.fsHeight=t.height;this.currentTarget.nextClass="hidden";this.currentTarget.prevClass="hidden";if(this.currentTarget.rsWidth==="")if(t.width>this.mediaMaxDims.width||t.height>this.mediaMaxDims.height){var n=new Pb.ClientImageRescaler(this.mediaMaxDims),r=n.rescale(t);this.currentTarget.rsWidth=r.width;this.currentTarget.rsHeight=r.height;this.mediaImg.css({width:this.currentTarget.rsWidth+"px",height:this.currentTarget.rsHeight+"px"})}else this.mediaImg.css({width:this.currentTarget.fsWidth+"px",height:this.currentTarget.fsHeight+"px"});this.mediaImg.attr("src",this.currentTarget.fullsizeUrl);if(!this.windowResizeBound){this.windowResizeBound=!0;this.resizeMediaToFitWindow(e)}},handleMediaContentUpdate:function(e){$("#mediaTemplateTarget").removeClass("noBackground");this.currentTarget=e.newTarget;this.resizeMediaToFitWindow(e)},resizeMediaToFitWindow:function(e){if(this.videoPlaying())return;var t,n,r,i,s,o=$(window),u=o.width(),a=$(".topLinksContainer"),f=a.outerWidth()-10,l;this.setMediaMaxDims();this.mediaTemplateTarget.html("");this.linkToTemplate();this.bindInPlaceEditors();if(this.currentTarget.mediaType==="video"||this.currentTarget.mediaType==="slideshow"){n=this.swfDims.width;t=this.swfDims.height}else{if(!this.currentTarget.fsWidth){this.currentTarget.placeHold=!0;this.pendingLoad=!0;this.setMinDefault();return}u<1024?this.rescaler.setMaxWidth(this.mediaMaxDims.width):this.rescaler.setMaxWidth(f);this.rescaler.setMaxHeight(this.mediaMaxDims.height);var c={width:this.currentTarget.fsWidth,height:this.currentTarget.fsHeight},h=this.rescaler.rescale(c);t=h.height;n=h.width}if(this.isMobile){l=this.getMobileWebDims(n,t);n=l.w;t=l.h}var p=this.getPolaroidDims(n,t),d=p.frameW,v=p.frameH,m=p.tableVerticalMargin,g=Math.min(d,this.mediaMaxDims.width),y=Math.min(v,this.mediaMaxDims.height),b=Math.min(n,this.mediaMaxDims.width),w=Math.min(t,this.mediaMaxDims.height);r=$(".mediawrapper.currentMedia");i=r.find(".tableWrapper");s=i.find("img");if(this.isMobile){if(n>this.mediaMaxDims.width){w=this.mediaMaxDims.width*t/n;b=this.mediaMaxDims.width}else{b=this.mediaMaxDims.height*n/t;w=this.mediaMaxDims.height}w<this.mediaMaxDims.height&&(m=(this.mediaMaxDims.height-w)/2);this.mediaTemplateTarget.css({width:Math.ceil(b)+"px",height:this.mediaMaxDims.height+"px",paddingLeft:Math.ceil((this.mediaMaxDims.width-b)/2),paddingRight:Math.ceil((this.mediaMaxDims.width-b)/2)})}r.css({width:Math.ceil(b)+"px",height:this.isMobile?"auto":w+"px"});i.css({width:b+"px",height:w+"px"});this.isMobile&&i.css({marginTop:m+"px",marginBottom:m+"px"});this.currentTarget.defaultWidth=g+"px";this.currentTarget.rsWidth=n;this.currentTarget.rsHeight=t;this.currentTarget.placeHold&&this.replacePlaceHolder();$("#mediaTemplateTarget").addClass("noBackground");this.isMobile||s.css({marginTop:($("#mediaTemplateTarget").height()-w)/2});s.css({width:b+"px",height:w+"px"})},setupPreviousNext:function(e){if(this.isMobile){var t=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET),n=e-1,r=e+1,i,s,o,u,l,c,h,p,d;this.currentTarget.marginLeft=0;this.currentTarget.defaultHeight=null;this.currentTarget.tableW=null;this.currentTarget.tableH=null;this.currentTarget.tableMt=null;this.currentTarget.tableMt=null;this.currentTarget.defaultWidth=null;this.currentTarget.previous=[];this.currentTarget.next=[];if(t&&t[n]!==undefined){t[n].rsWidth?i=this.getMobileWebDims(t[n].rsWidth,t[n].rsHeight):i=this.getMobileWebDims(a,f);u=i.w;l=i.h;s=this.getPolaroidDims(u,l);c=Math.min(s.frameW,this.mediaMaxDims.width);h=Math.min(s.frameH,this.mediaMaxDims.height);if(u>this.mediaMaxDims.width){d=this.mediaMaxDims.width*l/u;p=this.mediaMaxDims.width}else{p=this.mediaMaxDims.height*u/l;d=this.mediaMaxDims.height}d<this.mediaMaxDims.height&&(s.tableVerticalMargin=(this.mediaMaxDims.height-d)/2);t[n].sequence="previousMedia";t[n].defaultHeight=h+"px";t[n].defaultWidth=c+"px";t[n].rsWidth=p;t[n].rsHeight=d;t[n].tableW=p+"px";t[n].tableH=d+"px";t[n].tableMt=s.tableVerticalMargin+"px";t[n].tableMb=s.tableVerticalMargin+"px";t[n].marginLeft="-"+c+"px";this.currentTarget.previous.push(t[n])}if(t&&t[r]!==undefined){t[r].rsWidth?i=this.getMobileWebDims(t[r].rsWidth,t[r].rsHeight):i=this.getMobileWebDims(a,f);u=i.w;l=i.h;o=this.getPolaroidDims(u,l);c=Math.min(o.frameW,this.mediaMaxDims.width);h=Math.min(o.frameH,this.mediaMaxDims.height);if(u>this.mediaMaxDims.width){d=this.mediaMaxDims.width*l/u;p=this.mediaMaxDims.width}else{p=this.mediaMaxDims.height*u/l;d=this.mediaMaxDims.height}d<this.mediaMaxDims.height&&(o.tableVerticalMargin=(this.mediaMaxDims.height-d)/2);t[r].sequence="nextMedia";t[r].marginLeft=0;t[r].defaultHeight=h+"px";t[r].defaultWidth=c+"px";t[r].rsWidth=p;t[r].rsHeight=d;t[r].tableW=p+"px";t[r].tableH=d+"px";t[r].tableMt=o.tableVerticalMargin+"px";t[r].tableMb=o.tableVerticalMargin+"px";this.currentTarget.next.push(t[r])}}},getMobileWebDims:function(e,t){e=s*e/t;t=s;return{w:e,h:t}},getPolaroidDims:function(e,t){var n,r,i=0,s=a,o=f;if(e<s&&t<o){n=s;r=o;i=t<o?(o-t)/2:0}else if(e<s&&t>=o){n=s;r=t;i=0}else if(e>=s&&t<o){n=e;r=o;i=(o-t)/2}else{n=e;r=t}return{frameW:n,frameH:r,tableVerticalMargin:i}},replacePlaceHolder:function(){var e=$("#"+this.currentTarget.placeHolderId);e.length>0&&e.attr("src",this.currentTarget.fullsizeUrl).css({width:this.currentTarget.rsWidth,height:this.currentTarget.rsHeight});this.currentTarget.placeHold=!1;this.pendingLoad=!1},setMediaMaxDims:function(){var l,c,h,p,d=$(window),v=0,m=0;m=$(".navbar").height();v=d.height()-m-$(".detailActionsWrapper").height();$("#bannerAd").length&&(v-=$("#bannerAd").height());if(this.isMobile){v=Math.min(u,v);i=Math.max(a-40,$(".detailCompWrapper").width()-5);s=Math.max(f,v)}else{v=Math.min(o,v-40);n=Math.max(r,v)}if(d.width()<=1024){l=this.isMobile?i:t;this.isMobile||(l=Math.min(d.width()-40,l));c=this.isMobile?s:n;h=this.isMobile?Math.min(d.width()-40,l):l}else{l=this.isMobile?i:e;c=this.isMobile?s:n;h=this.isMobile?Math.min(d.width()-40,l):$(".topLinksContainer").outerWidth()-10}this.mediaMaxDims={width:l,height:c};Pb.Data.add("mediaMaxDims",this.mediaMaxDims);p=h/4*3;this.swfDims={width:h,height:p}},setMinDefault:function(){var e={width:$(".topLinksContainer").width()+"px",height:"auto"};$(".mediawrapper").css(e);$(".mediawrapper > table").css(e);$(".mediawrapper img:not(.placeHold)").css(e)},linkToTemplate:function(){var e,t=this.currentTarget.mediaType;switch(t){case"video":case"slideshow":case"flash":e="swfTemplate";break;default:if(!this.currentTarget.rsWidth){this.currentTarget.rsWidth=this.mediaMaxDims.width;this.currentTarget.placeHold=!0}e="imageTemplate"}this.currentTarget.likebutton[0].likeurl=this.currentTarget.fullsizeUrl;this.currentTarget.sequence="currentMedia";this.setupPreviousNext(this.currentTarget.id);this.isMobile?Pb.JSTemplates.link("mediaWrapperTemplate",this.mediaTemplateTarget,this.currentTarget):Pb.JSTemplates.link(e,this.mediaTemplateTarget,this.currentTarget);(this.currentTarget.title||this.currentTarget.io||this.currentTarget.hashtagMedia)&&Pb.JSTemplates.link("#metatitleTemplate","#metatitleTarget",this.currentTarget);Pb.JSTemplates.link("#likesButtonStarTemplate","#likeTarget",this.currentTarget);this.updateLikeButtonState(this.currentTarget);this.updateFollowButtonState(this.currentTarget);var n=$.Event("Pb.Component.Media.Media::template-update",{mediaType:t,newTarget:this.currentTarget});$(document).trigger(n);var r=this.mediaTemplateTarget.find("div#previous"),i=this.mediaTemplateTarget.find("div#next");i.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_next_click"))});r.on("click",function(e){$(document).trigger($.Event("Pb.Component.Media.Media::media_previous_click"))})},updateLikeButtonState:function(e){var t=$("#likeTarget .like"),n=$("#likeTarget .unlike");t.data("likeurl",e.fullsizeUrl);n.data("likeurl",e.fullsizeUrl);if(e.isLiked){t.hide();n.show()}else{t.show();n.hide()}},updateFollowButtonState:function(e){var t=$("a.follow");if(!t.hasClass("disabled"))if(e.isFollowing){t.addClass("following");t.text("Following");t.data("complete-text","Following")}else{t.removeClass("following");t.addClass("btn-primary");t.removeClass("btn-secondary");t.text("Follow");t.data("complete-text","Follow")}},handleTemplateUpdate:function(e){var t=["#slideshowBtn","#zoomBtn","#editBtn"];if(e.mediaType==="video"){var n=$(document.documentElement);(n.hasClass("is_iPad")||n.hasClass("is_iPhone")||n.hasClass("is_android")||this.isMobile)&&Modernizr.video.h264?this.loadVideoTag():this.loadFlashVideo();$.each(t,function(e,t){$(t).hide()});$("#detailOptionsMenu.dropdown-menu").addClass("video");$("#mediaTemplateTarget").addClass("video")}else if(e.mediaType==="slideshow")this.loadSlideshow();else if(e.mediaType==="flash")this.loadSwf();else if(e.mediaType==="image"){$.each(t,function(e,t){$(t).show()});$("#detailOptionsMenu.dropdown-menu").removeClass("video");$("#mediaTemplateTarget").removeClass("video")}},loadVideoTag:function(){$("video").remove();var e=$(".currentMedia #flashcontent"),t=$("html").hasClass("is_iPhone"),n=$("html").hasClass("is_android"),r=$("html").hasClass("is_webkit"),i=this.currentTarget.fullsizeUrl,s=t?'style="height: 1px; width: 1px;"':'style="height: '+this.swfDims.height+"px; width: "+this.swfDims.width+'px;"',o=this.isMobile?"":'autoplay="autoplay"';this.isMobile&&!t&&(s='style="max-height:'+this.mediaMaxDims.height+'px" width="98%"');i=i.replace(/^http:\/\/i/,"http://vid");i=i.replace(/^http:\/\/gi/,"http://gvid");e.html("");var u="";if(t){u+='<img src="'+this.currentTarget.posterUrl+'" '+s+' id="videoPoster" />';u+='<div class="thumbnailOverlay"></div>'}u+='<video class="video" poster="'+this.currentTarget.posterUrl+'" id="video'+this.currentTarget.id+'" '+s+' controls="controls" '+o+">";u+='<source src="'+i+'" type=\'video/mp4; codecs="avc1.42E01E, mp4a.40.2"\' />';u+="Your browser does not support the video tag.";u+="</video>";e.html(u);if(this.isMobile){(t||n&&r)&&$(e).swipe({tap:$.proxy(function(){var e=document.getElementById("video"+this.currentTarget.id);e.paused?e.play():e.pause()},this)});e.parent().parent().css({height:this.swfDims.height+"px",width:this.swfDims.width+"px"})}},loadFlashVideo:function(){var e=this.currentTarget.fullsizeUrl;e=e.replace(/^http:\/\/i/,"http://vid");e=e.replace(/^http:\/\/gi/,"http://gvid");var t=Pb.Data.get("picUrl")+"flash/oldplayer/Player.swf",n={file:e,os:1,ap:1,title:encodeURIComponent(this.currentTarget.title)},r={wmode:"transparent",allowScriptAccess:"always",allowNetworking:"all",allowFullscreen:"true"};swfobject.embedSWF(t,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,n,r)},loadSlideshow:function(){var e="/resources/common/swf/pbwidget.swf",t={pbwurl:this.currentTarget.fullsizeUrl},n={wmode:"transparent"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},loadSwf:function(){var e=this.currentTarget.fullsizeUrl,t={},n={wmode:"transparent",allowScriptAccess:"never",allowNetworking:"internal"};swfobject.embedSWF(e,"flashcontent",this.swfDims.width,this.swfDims.height,"6.0.65",this.expressInstallPath,t,n)},videoPlaying:function(){var e=document.getElementById("video"+this.currentTarget.id);return e?!0:!1},updateTitle:function(e,t){var n="/action/media/updateTitle",r={title:e,mediaUrl:this.currentTarget.fullsizeUrl};Pb.Component.Ad.AdRefresh.reloadAds();Pb.Ajax.ajax({url:n,data:r,success:$.proxy(function(e){if(e.status===1){this.currentTarget.title=e.data.title;this.currentTarget.isPersisted=!0;return!0}return!1},this)})},hidePagination:function(){var e="hidePagination",t={hoverArrows:"#mediaTemplate",prevnextButtons:".prevnext"};this.showPagination||$.each(t,function(t,n){$(n).addClass(e)})}};$.extend(l.prototype,c);return l}();(function(e){function n(e,t){this.settings=e;this.dom=t;this.originalValue=null;this.fullValue=null;this.didInsertDefaultText=!1;this.shouldDelayReinit=!1}function r(e){if(e.url||e.callback)return;throw new Error("Need to set either url: or callback: option for the inline editor to work.")}function i(e){if(""===e)return;var t=new Image;t.src=e}function s(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function o(e){return undefined===e||null===e?!1:0===e.length?!1:!0}e.fn.editInPlace=function(t){var s=e.extend({},e.fn.editInPlace.defaults,t);r(s);i(s.saving_image);return this.each(function(){var t=e(this);if(t.data("editInPlace"))return;t.data("editInPlace",!0);var r=new n(s,t);r.init();t.data("editInPlaceEditor",r)})};e.fn.editInPlace.defaults={pb_validation:null,pb_track:null,openOnClick:!0,url:"",bg_over:"#ffc",bg_out:"transparent",hover_class:"editHover",show_buttons:!1,save_button:'<button class="inplace_save">Save</button>',cancel_button:'<button class="inplace_cancel">Cancel</button>',params:"",field_type:"text",default_text:"(Click here to add text)",use_html:!1,textarea_rows:10,textarea_cols:25,select_text:"Choose new value",select_options:"",short_text:!0,text_size:null,saving_text:undefined,saving_image:"",saving_animation_color:"transparent",value_required:!1,element_id:"element_id",update_value:"update_value",original_value:"original_value",original_html:"original_html",save_if_nothing_changed:!1,on_blur:"save",cancel:"",callback:null,callback_skip_dom_reset:!1,success:null,error:null,error_sink:function(e,t){alert(t)},preinit:null,postclose:null,delegate:null};var t={shouldOpenEditInPlace:function(e,t,n){},willOpenEditInPlace:function(e,t){},didOpenEditInPlace:function(e,t){},shouldCloseEditInPlace:function(e,t,n){},willCloseEditInPlace:function(e,t){},didCloseEditInPlace:function(e,t){},missingCommaErrorPreventer:""};e.extend(n.prototype,{isOpened:!1,init:function(){this.setDefaultTextIfNeccessary();this.connectOpeningEvents()},reinit:function(){if(this.shouldDelayReinit)return;this.triggerCallback(this.settings.postclose,this.dom);this.triggerDelegateCall("didCloseEditInPlace");this.markEditorAsInactive();this.connectOpeningEvents()},setDefaultTextIfNeccessary:function(){if(""!==e.trim(this.dom.html()))return;this.dom.html(this.settings.default_text);this.didInsertDefaultText=!0},connectOpeningEvents:function(){var e=this;this.dom.bind("mouseenter.editInPlace",function(){e.addHoverEffect()}).bind("mouseleave.editInPlace",function(){e.removeHoverEffect()});this.settings.openOnClick&&this.dom.bind("click.editInPlace",function(t){e.openEditor(t)})},disconnectOpeningEvents:function(){this.dom.unbind(".editInPlace")},addHoverEffect:function(){this.settings.hover_class?this.dom.addClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_over)},removeHoverEffect:function(){this.settings.hover_class?this.dom.removeClass(this.settings.hover_class):this.dom.css("background-color",this.settings.bg_out)},openEditor:function(e){if(!this.shouldOpenEditor(e))return;typeof this.settings.pb_track=="function"&&this.settings.pb_track();this.disconnectOpeningEvents();this.removeHoverEffect();this.removeInsertedDefaultTextIfNeccessary();this.saveOriginalValue();this.markEditorAsActive();this.replaceContentWithEditor();this.setInitialValue();this.workAroundMissingBlurBug();this.connectClosingEventsToEditor();this.triggerDelegateCall("didOpenEditInPlace")},shouldOpenEditor:function(e){return this.isClickedObjectCancelled(e.target)?!1:!1===this.triggerCallback(this.settings.preinit,this.dom)?!1:!1===this.triggerDelegateCall("shouldOpenEditInPlace",!0,e)?!1:this.isOpened?!1:!0},removeInsertedDefaultTextIfNeccessary:function(){if(!this.didInsertDefaultText||this.dom.html()!==this.settings.default_text)return;this.dom.html("");this.didInsertDefaultText=!1},isClickedObjectCancelled:function(t){if(!this.settings.cancel)return!1;var n=e(t).parents().andSelf(),r=n.filter(this.settings.cancel);return 0!==r.length},saveOriginalValue:function(){if(this.settings.use_html)this.originalValue=this.dom.html();else{if(this.settings.checkFullValue){var e;this.dom.next().length?e=this.dom.next().val():e=this.dom.val();e.length>0&&(this.fullValue=e)}this.originalValue=s(this.dom.text())}},restoreOriginalValue:function(){var e;if(this.originalValue===""){e=this.settings.default_text;this.didInsertDefaultText=!0}else e=this.originalValue;this.setClosedEditorContent(e)},setClosedEditorContent:function(e){this.settings.use_html?this.dom.html(e):this.dom.text(e)},workAroundMissingBlurBug:function(){var e=this.dom.find(":input");this.dom.parents(":last").find(".editInPlace-active :input").not(e).blur()},replaceContentWithEditor:function(){var e=this.settings.show_buttons?'<span class="editctrls">'+this.settings.cancel_button+" "+this.settings.save_button+"</span>":"",t=this.createEditorElement();this.dom.html('<form class="inplace_form" style="display: inline; margin: 0; padding: 0;"></form>').find("form").append(t).append(e)},createEditorElement:function(){if(-1===e.inArray(this.settings.field_type,["text","textarea","select"]))throw"Unknown field_type <fnord>, supported are 'text', 'textarea' and 'select'";var t=null;"select"===this.settings.field_type?t=this.createSelectEditor():"text"===this.settings.field_type?t=e('<input type="text" '+this.inputNameAndClass()+' size="'+this.settings.text_size+'"'+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'"':"")+" />"):"textarea"===this.settings.field_type&&(t=e("<textarea "+this.inputNameAndClass()+(this.settings.maxlength?' maxlength="'+this.settings.maxlength+'" ':"")+' rows="'+this.settings.textarea_rows+'" '+' cols="'+this.settings.textarea_cols+'" />'));return t},setInitialValue:function(){var e=this.triggerDelegateCall("willOpenEditInPlace",this.originalValue);this.settings.checkFullValue&&this.fullValue&&(e=this.fullValue);var t=this.dom.find(":input");t.val(e);t.val()!==e&&t.val("")},inputNameAndClass:function(){return' name="inplace_value" class="inplace_field" '},createSelectEditor:function(){var t=e("<select"+this.inputNameAndClass()+">"+'<option disabled="true" value="">'+this.settings.select_text+"</option>"+"</select>"),n=this.settings.select_options;e.isArray(n)||(n=n.split(","));for(var r=0;r<n.length;r++){var i=n[r];e.isArray(i)||(i=i.split(":"));var o=s(i[1]||i[0]),u=s(i[0]),a=e("<option>").val(o).text(u);t.append(a)}return t},connectClosingEventsToEditor:function(){function t(t){e.handleCancelEditor(t);return!1}function n(t){e.handleSaveEditor(t);return!1}var e=this,r=this.dom.find("form");r.find(".inplace_field").focus().select();r.find(".inplace_cancel").click(t);r.find(".inplace_save").click(n);this.settings.show_buttons||("save"===this.settings.on_blur?r.find(".inplace_field").blur(n):r.find(".inplace_field").blur(t));r.keyup(function(e){var n=27;if(n===e.which)return t()});this.bindSubmitOnEnterInInput();r.submit(n)},bindSubmitOnEnterInInput:function(){if("textarea"===this.settings.field_type)return;var e=this;this.dom.find(":input").keydown(function(t){var n=13;if(n===t.which)return e.dom.find("form").submit()})},handleCancelEditor:function(t){if(!1===this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);this.restoreOriginalValue();var r=this.dom.parent();r.removeClass("error");r.find(".help-inline").each(function(){e(this).remove()});this.reinit()},handleSaveEditor:function(t){if(!this.triggerDelegateCall("shouldCloseEditInPlace",!0,t))return;var n=this.dom.find(":input").val();n=this.triggerDelegateCall("willCloseEditInPlace",n);if(this.isDisabledDefaultSelectChoice()||this.isUnchangedInput(n)){this.handleCancelEditor(t);return}if(this.didForgetRequiredText(n)){this.handleCancelEditor(t);this.reportError("Error: You must enter a value to save this field");return}n=e.trim(n);if(n===this.originalValue){this.handleCancelEditor(t);return}if(typeof this.settings.pb_validation=="function"){var r=this.settings.pb_validation(n,this.originalValue);if(!r)return}this.showSaving(n);this.settings.callback?this.handleSubmitToCallback(n):this.handleSubmitToServer(n)},didForgetRequiredText:function(e){return this.settings.value_required&&(""===e||undefined===e||null===e)},isDisabledDefaultSelectChoice:function(){return this.dom.find("option").eq(0).is(":selected:disabled")},isUnchangedInput:function(e){return!this.settings.save_if_nothing_changed&&this.originalValue===e},showSaving:function(t){if(this.settings.callback&&this.settings.callback_skip_dom_reset)return;var n=t;o(this.settings.saving_text)&&(n=this.settings.saving_text);o(this.settings.saving_image)&&(n=e("<img />").attr("src",this.settings.saving_image).attr("alt",n));this.dom.html(n)},handleSubmitToCallback:function(t){this.enableOrDisableAnimationCallbacks(!0,!1);var n=this.triggerCallback(this.settings.callback,this.id(),t,this.originalValue,this.settings.params,this.savingAnimationCallbacks());if(this.settings.checkFullValue&&this.settings.pb_helpers){var r=this.settings.pb_helpers;if(r.toggleFullTitleLink(n,40)){this.dom.next().val(n);e("#mediaTitleFull").text(n);this.settings.short_text&&(n=r.shortText(n,40));e("#mediaTitleFullLink").show()}else if(n==="Click to add title"){e("#mediaTitleOverlayWrap").hide();e("#mediaTitleFullLink").hide();this.fullValue="";e("#mediaTitleFull").text("");e("#fullText").val("")}}if(this.settings.callback_skip_dom_reset)return;if(undefined===n){this.reportError("Error: Failed to save value: "+t);this.restoreOriginalValue()}else this.dom.html(n);if(this.didCallNoCallbacks()){this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit()}},handleSubmitToServer:function(t){var n=this.settings.update_value+"="+encodeURIComponent(t)+"&"+this.settings.element_id+"="+this.dom.attr("id")+(this.settings.params?"&"+this.settings.params:"")+"&"+this.settings.original_html+"="+encodeURIComponent(this.originalValue)+"&"+this.settings.original_value+"="+encodeURIComponent(this.originalValue);this.enableOrDisableAnimationCallbacks(!0,!1);this.didStartSaving();var r=this;e.ajax({url:r.settings.url,type:"POST",data:n,dataType:"html",complete:function(e){r.didEndSaving()},success:function(e){var t=e||r.settings.default_text;r.dom.html(t);r.triggerCallback(r.settings.success,e)},error:function(e){r.dom.html(r.originalHTML);r.settings.error?r.triggerCallback(r.settings.error,e):r.reportError("Failed to save value: "+e.responseText||"Unspecified Error")}})},triggerCallback:function(e){if(!e)return;var t=Array.prototype.slice.call(arguments,1);return e.apply(this.dom[0],t)},triggerDelegateCall:function(t,n,r){if(!this.settings.delegate||!e.isFunction(this.settings.delegate[t]))return n;var i=this.settings.delegate[t](this.dom,this.settings,r);return undefined===i?n:i},reportError:function(e){this.triggerCallback(this.settings.error_sink,this.id(),e)},id:function(){return this.dom.attr("id")},markEditorAsActive:function(){this.dom.addClass("editInPlace-active");this.isOpened=!0},markEditorAsInactive:function(){this.dom.removeClass("editInPlace-active");this.isOpened=!1},savingAnimationCallbacks:function(){var e=this;return{didStartSaving:function(){e.didStartSaving()},didEndSaving:function(){e.didEndSaving()}}},enableOrDisableAnimationCallbacks:function(e,t){this.didStartSaving.enabled=e;this.didEndSaving.enabled=t},didCallNoCallbacks:function(){return this.didStartSaving.enabled&&!this.didEndSaving.enabled},assertCanCall:function(e){if(!this[e].enabled)throw new Error("Cannot call "+e+" now. See documentation for details.")},didStartSaving:function(){this.assertCanCall("didStartSaving");this.shouldDelayReinit=!0;this.enableOrDisableAnimationCallbacks(!1,!0);this.startSavingAnimation()},didEndSaving:function(){this.assertCanCall("didEndSaving");this.shouldDelayReinit=!1;this.enableOrDisableAnimationCallbacks(!1,!1);this.reinit();this.stopSavingAnimation()},startSavingAnimation:function(){var e=this;this.dom.animate({backgroundColor:this.settings.saving_animation_color},400).animate({backgroundColor:"transparent"},400,"swing",function(){setTimeout(function(){e.startSavingAnimation()},10)})},stopSavingAnimation:function(){this.dom.stop(!0).css({backgroundColor:""})},missingCommaErrorPreventer:""})})(jQuery);$.getObject("Pb.Component.Media",!0).ZoomModal=function(){function e(){e.superclass.constructor.call(this)}var t,n={templateLinked:!1,modalData:[],init:function(t){var n={modalId:"#zoomModal",modalName:"zoomModal",showProgress:!0,refreshAdsOnHide:!0,shownEvent:"Pb.Component.Media.ZoomModal::shown",hideEvent:"Pb.Component.Media.ZoomModal::hide"};t&&$.extend(n,t);$.views.helpers({getImageUrl:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA);return e.fullsizeUrl}});e.superclass.init.call(this,n)},prepareDataForTemplate:function(e){return e},onShow:function(t){e.superclass.onShow.call(this,t);this.fitModal();$(window).resize(this.fitModal);$("#zoomModal").on("click",".zoomOriginal",function(){$(".contentWrapper").addClass("zoomed");var e=Pb.Data.get(Pb.Data.Shared.MEDIA);e.maxWidth=$(window).width();Pb.JSTemplates.link("#zoomOriginalTemplate",".contentWrapper",e);var t={path:e.path,url:e.originalUrl,title:e.name};window.history.pushState(t,e.name,e.linkUrl);window.onpopstate=function(e){document&&window.location.reload()};$("#zoomModal").modal("hide")});$(".zoomOriginal").tooltip({placement:"top",delay:{show:300,hide:100}})},fitModal:function(){var e=Pb.Data.get(Pb.Data.Shared.MEDIA),t=e.fsHeight,n=10,r=$(window).height(),i=$(window).width();$(".zoomModal").css("max-height",r-n+"px");$(".zoomModal").css("max-width",i-n+"px");$(".zoomModal").find("img").css("max-height",r-n*2+"px");$(".zoomModal").find("img").css("max-width",i-n*2+"px");parseInt($(".zoomModal").css("min-height"),10)>r&&$(".zoomModal").css("min-height",r+"px");var s=$(".zoomModal").height(),o=(s-t)/2;o>0&&$(".zoomModal").find("img").css("margin-top",o+"px")}};Pb.subclass(e,Pb.Component.Element.Modal,n);t=new e;Pb.InitEventQueue.add(function(){t.init()});return t}();$.getObject("Pb.Component.Detail",!0).MoreContentContainer=function(){function e(e){this.init(e)}var t={properties:{trendingContainer:".trending",templateId:"#thumbnailMediaTemplate",urlRoot:"/component/Detail-MoreContentContainer"},init:function(e){$.extend(this.properties,e);this.properties.trendingUrl=this.properties.urlRoot+"?"+this.properties.trendingQuery;this.properties.container=$(this.properties.containerId);Pb.JSTemplates.link(this.properties.templateId,this.properties.trendingContainer,[]);this.fetch(this.properties.trendingUrl,this.properties.trendingContainer)},initEvents:function(){},fetch:function(e,t){Pb.Ajax.ajax({url:e,success:$.proxy(function(e){Pb.JSTemplates.link(this.properties.templateId,t,e)},this),type:"get"})}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Navigation",!0).DetailBreadcrumbs=function(){function e(e){this.init(e)}var t={offsetElement:null,init:function(e){this.offsetElement=$("#offset");this.bindEvents()},bindEvents:function(){var e=$(document);e.on("Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",$.proxy(this.updateOffset,this));e.on("Pb.Component.Detail.MediaManager::media_offset_update",$.proxy(this.updateOffset,this))},updateOffset:function(e){var t=e.currentOffset+1;this.offsetElement.text(t)}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.Detail",!0).MediaManager=function(){function e(e){this.init(e)}var t={libData:null,libDataMax:null,libDataMin:null,currentOffset:0,total:null,mediaPrevArrow:null,mediaNextArrow:null,contentUpdateInfo:null,isFetching:!1,lastFetchOffset:null,fetchMoreEvent:"Pb.Component.Detail.MediaManager::media_manager_update",offsetUpdateEvent:"Pb.Component.Detail.MediaManager::media_offset_update",init:function(e){e.currentOffset&&(this.currentOffset=parseInt(e.currentOffset,10));e.total&&(this.total=e.total);this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.getElements();this.bindEvents();this.toggleMediaArrow();this.preloadFullsizeImages(this.currentOffset-1,this.currentOffset+1)},getElements:function(){this.mediaPrevArrow=$("#mediaTemplate a#previous");this.mediaNextArrow=$("#mediaTemplate a#next")},bindEvents:function(){var e=$(document);e.bind("preloadFullsize",$.proxy(function(e){this.handlePreloadedFullsize(e)},this));e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("Pb.Component.Media.Media::template-update",$.proxy(this.toggleMediaArrow,this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.isFetching=!1;this.contentUpdateInfo={dir:e.dir,start:e.startOffset};var t=e.startOffset-3;t<0&&(t=0);typeof e!="undefined"&&this.preloadFullsizeImages(t,e.startOffset)},testThresholds:function(e){var t=20,n=this.currentOffset+t,r={isFirstRender:!1,dir:e},i=!1;if(e===1&&this.libDataMax<=n){i=!0;r.startOffset=this.libDataMax+1}if(i){var s=$.Event(this.fetchMoreEvent,r);$(document).trigger(s)}},preloadFullsizeImages:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};var u=Pb.Data.get("mediaMaxDims");if(i.fsWidth>u.width||i.fsHeight>u.height){var a=new Pb.ClientImageRescaler(u);o=a.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}}i.placeHold===!0&&$(document).trigger($.Event("Pb.Component.Media.Media::replacePlaceHolder"))}},move:function(e){var t=this.currentOffset,n=0,r;this.currentOffset=this.currentOffset+e;this.currentOffset<0?this.currentOffset=0:n=this.currentOffset-2;r=this.currentOffset+2;n=n<0?0:n;r=r>this.total-1?this.total-1:r;this.preloadFullsizeImages(n,r);var i=$.Event(this.offsetUpdateEvent,{currentOffset:this.currentOffset,oldOffset:t});$(document).trigger(i);this.toggleMediaArrow();this.testThresholds(e)},toggleMediaArrow:function(){var e=this.currentOffset,t=e===0?"hidden":"visible";this.mediaPrevArrow.css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0);var n=e===this.total-1?"hidden":"visible";this.mediaNextArrow.css("visibility",n);$("#mediaTemplate").data("next",n);$("#btnnext").toggleClass("disabled",e===this.total-1)}};$.extend(e.prototype,t);return e}();(function(e){function t(t){var n=t||window.event,r=[].slice.call(arguments,1),i=0,s=!0,o=0,u=0;return t=e.event.fix(n),t.type="mousewheel",n.wheelDelta&&(i=n.wheelDelta/120),n.detail&&(i=-n.detail/3),u=i,n.axis!==undefined&&n.axis===n.HORIZONTAL_AXIS&&(u=0,o=-1*i),n.wheelDeltaY!==undefined&&(u=n.wheelDeltaY/120),n.wheelDeltaX!==undefined&&(o=-1*n.wheelDeltaX/120),r.unshift(t,i,o,u),(e.event.dispatch||e.event.handle).apply(this,r)}var n=["DOMMouseScroll","mousewheel"];if(e.event.fixHooks)for(var r=n.length;r;)e.event.fixHooks[n[--r]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=n.length;e;)this.addEventListener(n[--e],t,!1);else this.onmousewheel=t},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],t,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})(jQuery);(function(e){function t(e,t){var n=parseInt(e.css(t),10);if(n)return n;var r=e[0].currentStyle;return r&&r.width&&parseInt(r.width,10)}function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}function i(t,i){var s=this,o=t.add(s),u=t.children(),f=0,l=i.vertical;r||(r=s),u.length>1&&(u=e(i.items,t)),i.size>1&&(i.circular=!1),e.extend(s,{getConf:function(){return i},getIndex:function(){return f},getSize:function(){return s.getItems().size()},getNaviButtons:function(){return m.add(g)},getRoot:function(){return t},getItemWrap:function(){return u},getItems:function(){return u.find(i.item).not("."+i.clonedClass)},move:function(e,t){return s.seekTo(f+e,t)},next:function(e){return s.move(i.size,e)},prev:function(e){return s.move(-i.size,e)},begin:function(e){return s.seekTo(0,e)},end:function(e){return s.seekTo(s.getSize()-1,e)},focus:function(){r=s;return s},addItem:function(t){t=e(t),i.circular?(u.children().last().before(t),u.children().first().replaceWith(t.clone().addClass(i.clonedClass))):(u.append(t),g.removeClass("disabled")),o.trigger("onAddItem",[t]);return s},seekTo:function(t,n,c){t.jquery||(t*=1);if(i.circular&&t===0&&f==-1&&n!==0)return s;if(!i.circular&&t<0||t>s.getSize()||t<-1)return s;var h=t;t.jquery?t=s.getItems().index(t):h=s.getItems().eq(t);var p=e.Event("onBeforeSeek");if(!c){o.trigger(p,[t,n]);if(p.isDefaultPrevented()||!h.length)return s}var v=l?{top:-h.position().top}:{left:-h.position().left};f=t,r=s,n===undefined&&(n=i.speed),u.animate(v,n,i.easing,c||function(){o.trigger("onSeek",[t])});return s}}),e.each(["onBeforeSeek","onSeek","onAddItem"],function(t,n){e.isFunction(i[n])&&e(s).bind(n,i[n]),s[n]=function(t){t&&e(s).bind(n,t);return s}});if(i.circular){var h=s.getItems().slice(-1).clone().prependTo(u),p=s.getItems().eq(1).clone().appendTo(u);h.add(p).addClass(i.clonedClass),s.onBeforeSeek(function(e,t,n){if(!e.isDefaultPrevented()){if(t==-1){s.seekTo(h,n,function(){s.end(0)});return e.preventDefault()}t==s.getSize()&&s.seekTo(p,n,function(){s.begin(0)})}});var v=t.parents().add(t).filter(function(){if(e(this).css("display")==="none")return!0});v.length?(v.show(),s.seekTo(0,0,function(){}),v.hide()):s.seekTo(0,0,function(){})}var m=n(t,i.prev).click(function(e){e.stopPropagation(),s.prev()}),g=n(t,i.next).click(function(e){e.stopPropagation(),s.next()});i.circular||(s.onBeforeSeek(function(e,t){setTimeout(function(){e.isDefaultPrevented()||(m.toggleClass(i.disabledClass,t<=0),g.toggleClass(i.disabledClass,t>=s.getSize()-1))},1)}),i.initialIndex||m.addClass(i.disabledClass)),s.getSize()<2&&m.add(g).addClass(i.disabledClass),i.mousewheel&&e.fn.mousewheel&&t.mousewheel(function(e,t){if(i.mousewheel){s.move(t<0?1:-1,i.wheelSpeed||50);return!1}});if(i.touch){var y={};u[0].ontouchstart=function(e){var t=e.touches[0];y.x=t.clientX,y.y=t.clientY},u[0].ontouchmove=function(e){if(e.touches.length==1&&!u.is(":animated")){var t=e.touches[0],n=y.x-t.clientX,r=y.y-t.clientY;s[l&&r>0||!l&&n>0?"next":"prev"](),e.preventDefault()}}}i.keyboard&&e(document).bind("keydown.scrollable",function(t){if(!(!i.keyboard||t.altKey||t.ctrlKey||t.metaKey||e(t.target).is(":input"))){if(i.keyboard!="static"&&r!=s)return;var n=t.keyCode;if(!(!l||n!=38&&n!=40)){s.move(n==38?-1:1);return t.preventDefault()}if(!l&&(n==37||n==39)){s.move(n==37?-1:1);return t.preventDefault()}}}),i.initialIndex&&s.seekTo(i.initialIndex,0,function(){})}e.tools=e.tools||{version:"v1.2.6"},e.tools.scrollable={conf:{activeClass:"active",circular:!1,clonedClass:"cloned",disabledClass:"disabled",easing:"swing",initialIndex:0,item:"> *",items:".items",keyboard:!0,mousewheel:!1,next:".next",prev:".prev",size:1,speed:400,vertical:!1,touch:!0,wheelSpeed:0}};var r;e.fn.scrollable=function(t){var n=this.data("scrollable");if(n)return n;t=e.extend({},e.tools.scrollable.conf,t),this.each(function(){n=new i(e(this),t),e(this).data("scrollable",n)});return t.api?n:this}})(jQuery);(function(e){function n(t,n){var r=e(n);return r.length<2?r:t.parent().find(n)}var t=e.tools.scrollable;t.navigator={conf:{navi:".navi",naviItem:null,activeClass:"active",indexed:!1,idPrefix:null,history:!1}};e.fn.navigator=function(r){typeof r=="string"&&(r={navi:r}),r=e.extend({},t.navigator.conf,r);var i;this.each(function(){function h(e,n,r){t.seekTo(n),r.preventDefault(),f&&history.pushState({i:n})}function p(){return s.find(r.naviItem||"> *")}function v(t){var n=e("<"+(r.naviItem||"a")+"/>").click(function(n){h(e(this),t,n)});t===0&&n.addClass(u),r.indexed&&n.text(t+1),r.idPrefix&&n.attr("id",r.idPrefix+t);return n.appendTo(s)}var t=e(this).data("scrollable"),s=r.navi.jquery?r.navi:n(t.getRoot(),r.navi),o=t.getNaviButtons(),u=r.activeClass,f=r.history&&history.pushState,l=t.getConf().size;t&&(i=t),t.getNaviButtons=function(){return o.add(s)},f&&(history.pushState({i:0}),e(window).bind("popstate",function(e){var n=e.originalEvent.state;n&&t.seekTo(n.i)}));p().length?p().each(function(t){e(this).click(function(n){h(e(this),t,n)})}):e.each(t.getItems(),function(e){e%l==0&&v(e)}),t.onBeforeSeek(function(e,t){setTimeout(function(){if(!e.isDefaultPrevented()){var n=t/l,r=p().eq(n);r.length&&p().removeClass(u).eq(n).addClass(u)}},1)}),t.onAddItem(function(e,n){var r=t.getItems().index(n);r%l==0&&v(r)})});return r.api?i:this}})(jQuery);$.getObject("Pb.Component.Filmstrip",!0).Filmstrip=function(){function e(e){this.init(e)}var t={libData:null,libDataMax:null,libDataMin:null,libDataCount:null,thumbData:null,currentOffset:0,total:null,currentThumb:null,startThumb:null,endThumb:null,mediaPrevArrow:null,mediaNextArrow:null,filmstripWrapper:null,filmstripLoading:null,filmstripPrevArrow:null,filmstripNextArrow:null,scrollableWrapper:".detailCompWrapper",scrollableId:null,itemContainer:null,scrollableWidth:0,scrollableHeight:0,thumbPaddingBorder:20,verticalHeight:450,verticalThumbHeight:90,maxThumbDims:{width:82,height:82},placeHoldThumb:null,hasResized:!1,contentUpdateInfo:null,win:null,isCompact:!1,windowWidth:null,isFetching:!1,lastLeftFetchOffset:null,lastRightFetchOffset:null,onPageLoad:!1,lastSlideIndex:null,slideExpired:!1,isSideFilmStrip:!1,filmstripCompactEvent:"Pb.Component.Filmstrip.Filmstrip::compact",filmstripNormalEvent:"Pb.Component.Filmstrip.Filmstrip::normal",preloadThumbsEvent:"Pb.Component.Filmstrip.Filmstrip::preloadFilmstripThumbs",filmstripSlideEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_slide_update",filmstripArrowClickEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_arrow_click",fullsizePreloadEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_fullsize_preloaded",filmstripOffsetUpdateEvent:"Pb.Component.Filmstrip.Filmstrip::filmstrip_offset_update",init:function(e){this.placeHoldThumb=Pb.Data.get("picUrl")+"backgrounds/placeholder_thumb.jpg";e.currentOffset&&(this.currentOffset=parseInt(e.currentOffset,10));e.total&&(this.total=e.total);typeof e.scrollableWrapper!="undefined"&&(this.scrollableWrapper=e.scrollableWrapper);$(".detailfilmstripwrap").closest(".sidebar").length>0&&(this.isSideFilmStrip=!0);this.scrollableId="#"+e.scrollableId;this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.libDataCount=Pb.Data.get("libDataCount");this.getElements();this.bindEvents();this.configureScrollable()},getElements:function(){this.win=$(window);this.filmstripWrapper=$("div.detailfilmstripwrap");this.mediaPrevArrow=$("#mediaTemplate div#previous");this.mediaNextArrow=$("#mediaTemplate div#next");this.filmstripPrevArrow=this.filmstripWrapper.find("a.prev");this.filmstripNextArrow=this.filmstripWrapper.find("a.next");this.filmstripLoading=$("#filmstripLoadingShroud")},bindEvents:function(){var e=$(document);this.win.resize($.proxy(function(){this.hasResized=!0;this.configureScrollable()},this));e.bind("preloadFullsize",$.proxy(function(e){this.handlePreloadedFullsize(e)},this));e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on(this.preloadThumbsEvent,$.proxy(this.handlePreloadThumbs,this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));this.filmstripPrevArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_previous_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(-1)},this));this.filmstripNextArrow.on("click",$.proxy(function(e){Pb.Track.trf("detail_filmstrip_next_click");var t=$.Event(this.filmstripArrowClickEvent);$(document).trigger(t);this.moveSlide(1)},this));$("#detailfilmstrip").on("click","a",$.proxy(function(e,t){this.handleThumbClick(e,t)},this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n!==37&&n!==188||!!this.onPageLoad){if((n===39||n===190)&&!this.onPageLoad){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}}else{Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMin=Pb.Data.get("libDataMin");this.libDataMax=Pb.Data.get("libDataMax");this.libDataCount=Pb.Data.get("libDataCount");this.isFetching=!1;this.contentUpdateInfo={dir:e.dir,start:e.startOffset,end:e.endOffset};this.handleUpdateLibData();this.slideExpired&&this.doSlideExpired()},handleUpdateLibData:function(){var e,t,n,r;if(this.contentUpdateInfo.dir===-1)if(this.onPageLoad&&this.contentUpdateInfo.start!==0){this.onPageLoad=!1;e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);r=this.thumbData.length;$.observable(this.thumbData).insert(r,n);this.lastLeftFetchOffset=e;this.toggleMediaArrow()}else{e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);r=0;if(t===parseInt(this.total,10)-1||t===this.libDataMax)r=this.thumbData.length;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastLeftFetchOffset&&(r=i);this.lastLeftFetchOffset=e;$.observable(this.thumbData).insert(r,n)}else if(this.onPageLoad){this.onPageLoad=!1;e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);if(e===0||e===this.libDataMin)r=0;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastRightFetchOffset-1&&(r=i+1);$.observable(this.thumbData).insert(r,n);this.lastRightFetchOffset=t+1;this.toggleMediaArrow()}else{e=this.contentUpdateInfo.start;t=this.contentUpdateInfo.end;n=this.createThumbs(e,t);if(e===0||e===this.libDataMin)r=0;else for(var i=0;i<this.thumbData.length;i++)parseInt(this.thumbData[i].dataIndex,10)===this.lastRightFetchOffset-1&&(r=i+1);this.lastRightFetchOffset=t+1;$.observable(this.thumbData).insert(r,n)}},doSlideExpired:function(){this.toggleLoading();this.slideExpiredData.dir===-1?this.startThumb=$("#thumb_"+this.slideExpiredData.start):this.endThumb=$("#thumb_"+this.slideExpiredData.start);this.slideExpired=!1;this.moveSlide(this.slideExpiredData.dir)},shouldResize:function(){var e=this.win.width();if(this.windowWidth===e)return!1;this.windowWidth=e;return!0},configureLayout:function(){var e=this.win.width();if(!this.shouldResize())return;e<=1024&&!this.isCompact?this.switchCompact():e>1024&&this.isCompact&&this.switchNormal()},switchCompact:function(){var e=$("#mediaTemplateTarget");this.isCompact=!0;var t=$.Event(this.filmstripCompactEvent);$(document).trigger(t);e.addClass("compact");this.filmstripWrapper.addClass("compact");$("#detailfilmstrip").width(120).height(450)},switchNormal:function(){var e=$("#mediaTemplateTarget");this.isCompact=!1;var t=$.Event(this.filmstripNormalEvent);$(document).trigger(t);e.removeClass("compact");this.filmstripWrapper.removeClass("compact")},configureScrollable:function(){if(!this.shouldResize())return;this.hasResized&&(this.itemContainer[0].innerHTML="");this.scrollableWidth=$(this.scrollableWrapper).outerWidth();this.scrollableHeight=this.verticalThumbHeight;if(!this.isCompact){$(this.scrollableId).width(this.scrollableWidth);$(this.scrollableId).height(this.scrollableHeight)}this.createStrip(this.libDataMin,this.libDataMax)},preloadThumbs:function(e,t){var n=[];if(n.length>0){var r=new Pb.ClientImagePreloader;r.preLoad(this.preloadThumbsEvent,n)}},handlePreloadThumbs:function(e){var t,n,r,i;if(e.dimensions){r=e.dimensions;for(var s in this.libData){if(this.libData.hasOwnProperty(s)){t=this.libData[s];if(r[t.thumbUrl]){t.thWidth=r[t.thumbUrl].width;t.thHeight=r[t.thumbUrl].height}}if(!t.thWidth||!t.thHeight)continue;if(t.thWidth>t.thHeight){i=(t.thWidth*70/t.thHeight-70)/2;n="margin-left: -"+i+"px; max-height: 70px"}else{i=(t.thHeight*70/t.thWidth-70)/2;n="margin-top: -"+i+"px; max-width: 70px"}if(t.thPlaceHold){var o=$("#thumb_"+t.offset+" img");o.attr("src",t.thumbUrl).attr("style",n);t.thPlaceHold=!1}}}},createStrip:function(e,t){this.itemContainer=$("#itemContainer");this.thumbData=this.createThumbs(e,t);Pb.JSTemplates.link("#thumbTemplate","#itemContainer",this.thumbData);this.itemContainer.css("visibility","visible");this.startThumb=$("#thumb_"+this.currentOffset);this.startThumb.addClass("selected");this.currentThumb=this.startThumb;var n=this.getSlideOffsetData(this.currentOffset,this.libDataMax,1);this.endThumb=$("#thumb_"+n.endOffset);this.moveSlideMargins(n);this.toggleThumbVisibility(this.currentOffset,n.endOffset);if(this.currentOffset<20&&parseInt(this.total,10)>20){this.lastLeftFetchOffset=this.libDataMin;this.lastRightFetchOffset=this.libDataMax+1;this.onPageLoad=!0;this.testThresholds(-1);parseInt(this.total,10)>40&&this.testThresholds(1)}else if(this.currentOffset>parseInt(this.total,10)-20&&parseInt(this.total,10)>20){this.lastRightFetchOffset=this.libDataMax+1;this.lastLeftFetchOffset=this.libDataMin;this.onPageLoad=!0;this.testThresholds(1);parseInt(this.total,10)>40&&this.testThresholds(-1)}else{this.lastRightFetchOffset=this.libDataMax+1;this.testThresholds(1)}this.toggleMediaArrow()},testThresholds:function(e){var t=this.endThumb.data("index")-this.startThumb.data("index")+20,n=this.endThumb.data("index")+1+t;if(n>this.total&&this.lastRightFetchOffset===parseInt(this.total,10)){n-=parseInt(this.total,10);this.lastRightFetchOffset=0}else if(n>this.total&&!this.lastRightFetchOffset){n=parseInt(this.total,10)-1;this.lastRightFetchOffset=this.libDataMax+1}var r=this.startThumb.data("index")-1-t;if(r<0&&this.libDataMin<2&&this.lastLeftFetchOffset===0){r=parseInt(this.total,10)+r;this.lastLeftFetchOffset=parseInt(this.total,10)}else if(r<0&&!this.lastLeftFetchOffset&&this.lastLeftFetchOffset!==0){r=0;this.lastLeftFetchOffset=this.libDataMin}var i={dir:e},s=!1;if(e===1&&this.libDataCount<this.total){s=!0;i.startOffset=this.lastRightFetchOffset}else if(e===-1&&this.libDataCount<this.total){s=!0;i.startOffset=this.lastLeftFetchOffset}if(s){this.isFetching=!0;var o=$.Event(this.filmstripSlideEvent,i);$(document).trigger(o)}else this.slideExpired&&this.doSlideExpired()},createThumbs:function(e,t){var n=[];for(var r=e;r<=t;r++){var i,s,o,u=this.libData[r];if(u){u.thPlaceHold=!1;i=u.thumbUrl;var a={thumbId:"thumb_"+r,dataIndex:""+r,altText:u.altText,thumbUrl:i,imgStyle:o,mediaType:u.mediaType,sizeClass:u.sizeClass};n.push(a)}}return n},moveSlideMargins:function(e){if(this.isCompact){this.startThumb.css("margin-top",e.diff+"px");this.endThumb.css("margin-bottom",e.diff+"px")}else{this.startThumb.css("margin-left",e.diff+"px");this.endThumb.css("margin-right",e.diff+"px")}},resetMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":"16px","margin-right":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":"16px"})},resetSideFilmstripMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":"16px","margin-right":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":0})},clearMargins:function(){this.startThumb.css({"margin-top":0,"margin-left":0,"margin-right":0,"margin-bottom":0});this.endThumb.css({"margin-bottom":0,"margin-right":0,"margin-left":0,"margin-top":0})},toggleThumbVisibility:function(e,t){this.hideThumbVisibility();for(var n=e;n<=t;n++)$("#thumb_"+n).show();this.preloadThumbs(e,t);this.filmstripWrapper.hasClass("off")&&this.filmstripWrapper.removeClass("off").fadeTo(300,1);e-=3;e<0&&(e=0);this.preloadFullsizeImages(e,t)},hideThumbVisibility:function(){for(var e in this.libData)this.libData.hasOwnProperty(e)&&$("#thumb_"+e).hide()},getSlideOffsetData:function(e,t,n){var r;this.isCompact?r=this.getVerticalOffset(e,n):r=this.getHorizontalOffset(e,n);return r},getHorizontalOffset:function(e,t){var n,r,i,s,o,u=70+this.thumbPaddingBorder;this.scrollableWidth>400?n=Math.floor(this.scrollableWidth/u-.6):n=Math.floor(this.scrollableWidth/u);n=Math.min(9,n);r=n*u;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var a=o*u;a<this.scrollableWidth?i=(this.scrollableWidth-a)/2:i=(this.scrollableWidth-r)/2;return{diff:i,endOffset:s}},getVerticalOffset:function(e,t){var n,r,i,s,o;n=Math.floor(this.verticalHeight/this.verticalThumbHeight);r=n*this.verticalThumbHeight;if(t===-1){s=e-(n-1);s<0&&(s=this.libDataMin);o=e-s+1}else{s=e+(n-1);s>this.total-1&&(s=this.libDataMax);o=s-e+1}var u=o*this.verticalThumbHeight;u<this.verticalHeight?i=(this.verticalHeight-u)/2:i=(this.verticalHeight-r)/2;return{diff:i,endOffset:s}},moveSlide:function(e){var t,n,r;if(this.slideExpired)return;if(e===-1){var i=this.startThumb.data("index");if(i===0||i===this.libDataMin)i=parseInt(this.thumbData[this.thumbData.length-1].dataIndex,10)+1;this.lastSlideIndex=i;t=parseInt(i,10)-1;n=this.libDataMin;r=this.getSlideOffsetData(t,n,e);if(r.endOffset<this.libDataMin){this.handleSlideExpired(e);return}this.isSideFilmStrip&&this.clearMargins();this.startThumb=$("#thumb_"+r.endOffset);this.endThumb=$("#thumb_"+t);this.isSideFilmStrip?this.resetSideFilmstripMargins():this.resetMargins();this.toggleThumbVisibility(r.endOffset,t)}else if(e===1){var s=this.endThumb.data("index");if(s===parseInt(this.total,10)-1||s===this.libDataMax)s=-1;this.lastSlideIndex=s;t=parseInt(s,10)+1;n=this.libDataMax;r=this.getSlideOffsetData(t,n,e);if(r.endOffset>this.libDataMax){this.handleSlideExpired(e);return}this.isSideFilmStrip&&this.clearMargins();this.startThumb=$("#thumb_"+t);this.endThumb=$("#thumb_"+r.endOffset);this.isSideFilmStrip?this.resetSideFilmstripMargins():this.resetMargins();this.toggleThumbVisibility(t,r.endOffset)}this.moveSlideMargins(r);this.testThresholds(e)},handleSlideExpired:function(e){this.hideThumbVisibility();this.toggleLoading();this.slideExpired=!0;this.slideExpiredData={start:this.lastSlideIndex,dir:e}},preloadFullsizeImages:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};var u=Pb.Data.get("mediaMaxDims");if(i.fsWidth>u.width||i.fsHeight>u.height){var a=new Pb.ClientImageRescaler(u);o=a.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}}i.placeHold===!0&&$(document).trigger($.Event("Pb.Component.Media.Media::replacePlaceHolder"))}$(document).trigger($.Event(this.fullsizePreloadEvent))},handleThumbClick:function(e,t){var n=this.currentOffset;this.currentThumb.removeClass("selected");this.currentThumb=$(e.currentTarget).parents(".wrap");this.currentThumb.addClass("selected");this.currentThumb.data("isprevnextclick")!=="true"&&t!=="prevnextclick"?Pb.Track.trf("detail_filmstrip_thumbnail_click"):this.currentThumb.removeData("isprevnextclick");this.currentOffset=this.currentThumb.data("index");var r=this.currentOffset-3;r<0&&(r=0);var i=this.currentOffset+3;i>this.total&&(i=this.total);this.preloadFullsizeImages(r,i);var s=$.Event(this.filmstripOffsetUpdateEvent,{currentOffset:this.currentOffset,oldOffset:n});$(document).trigger(s)},move:function(e){var t=this.currentOffset+e;if(t<0||t<this.libDataMin){t=parseInt(this.thumbData[this.thumbData.length-1].dataIndex,10);this.moveSlide(-1);Pb.Track.trf("detail_pagination_end_album_click")}else if(t===parseInt(this.total,10)||t>this.libDataMax){t=0;this.moveSlide(1);Pb.Track.trf("detail_pagination_beginning_album_click")}this.libData[t]||(t=this.findNextThumb(t,e));var n=this.startThumb.data("index")-1;n<0&&(n=0);var r=this.endThumb.data("index")+1;r>this.libDataMax&&(r=this.libDataMax);if(e===-1&&t===this.startThumb.data("index")+3){var i=n-10;i<0&&(i=0);this.preloadFullsizeImages(i,n)}else if(e===1&&t===this.endThumb.data("index")-3){var s=r+10;s>this.libDataMax&&(s=this.libDataMax);this.preloadFullsizeImages(r,s)}t<this.startThumb.data("index")&&e===-1?this.moveSlide(-1):t>this.endThumb.data("index")&&e===1&&this.moveSlide(1);var o=$("#thumb_"+t);o.data("isprevnextclick","true");o.find("a").trigger("click",["prevnextclick"])},findNextThumb:function(e,t){if(t===-1){for(var n=e;n>this.libDataMin;n--)if(this.libData[n])return n}else for(var n=e;n<this.libDataMax;n++)if(this.libData[n])return n},toggleMediaArrow:function(){var e=this.currentOffset,t=e===0&&this.onPageLoad?"hidden":"visible";$("#mediaTemplate div#previous").css("visibility",t);$("#mediaTemplate").data("prev",t);var n=e===this.total-1&&this.onPageLoad?"hidden":"visible";$("#mediaTemplate div#next").css("visibility",n);$("#mediaTemplate").data("next",n)},toggleLoading:function(){this.filmstripLoading.toggle()}};$.extend(e.prototype,t);return e}();$.getObject("Pb.Component.RecentUploads",!0).RecentUploadsDetailManager=function(){function e(e){this.init(e)}var t={start:0,end:19,current:0,libData:null,libDataMax:null,libDataMin:null,mediaPrevArrow:null,mediaNextArrow:null,maxFullSizeDims:{width:600,height:450},init:function(){this.updateLibData();this.bindEvents();this.preloadFullsize(this.start,this.end);this.getElements()},getElements:function(){this.mediaPrevArrow=$("#mediaTemplate a#previous");this.mediaNextArrow=$("#mediaTemplate a#next")},bindEvents:function(){var e=$(document);e.on("Pb.Component.Media.Media::media_previous_click",$.proxy(function(){Pb.Track.trf("detail_pagination_previous_click");this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_click",$.proxy(function(){Pb.Track.trf("detail_pagination_next_click");this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_next_click",$.proxy(function(e){this.move(1)},this)).on("Pb.Component.Detail.DetailActions::media_previous_click",$.proxy(function(e){this.move(-1)},this)).on("Pb.Component.Media.Media::media_next_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_next_swipe");this.move(1)},this)).on("Pb.Component.Media.Media::media_previous_swipe",$.proxy(function(e){Pb.Track.trf("detail_pagination_previous_swipe");this.move(-1)},this));e.on("keyup.mediadetail",$.proxy(this.onKeyUp,this));e.on("Pb.Component.Media.ZoomModal::shown",function(){$(document).off("keyup.mediadetail")});e.on("Pb.Component.Media.ZoomModal::hide",$.proxy(function(e){$(document).on("keyup.mediadetail",$.proxy(this.onKeyUp,this))},this));e.on("Pb.Component.Detail.Fetcher::libdata_update",$.proxy(this.updateLibData,this));e.on("preloadFullsize",$.proxy(this.handlePreloadedFullsize,this))},onKeyUp:function(e){var t=e.target.tagName;if(t==="INPUT"||t==="TEXTAREA")return;var n=e.keyCode;if(n===37||n===188){Pb.Track.trf("detail_pagination_left_keyboard_click");this.move(-1)}else if(n===39||n===190){Pb.Track.trf("detail_pagination_right_keyboard_click");this.move(1)}},updateLibData:function(e){this.libData=Pb.Data.Shared.get(Pb.Data.Shared.MEDIA_SET);this.libDataMax=Pb.Data.get("libDataMax");this.libDataMin=Pb.Data.get("libDataMin");typeof e!="undefined"&&this.preloadFullsize(e.startOffset,this.libDataMax)},preloadFullsize:function(e,t){var n=[];for(var r=e;r<=t;r++){var i=this.libData[r];typeof i!="undefined"&&i.mediaType==="image"&&(i.fsWidth||n.push(i.fullsizeUrl))}if(n.length>0){var s=new Pb.ClientImagePreloader;s.preLoad("preloadFullsize",n,{start:e,end:t})}},handlePreloadedFullsize:function(e){var t=e.dimensions,n=e.memo;for(var r=n.start;r<=n.end;r++){var i=this.libData[r];if(typeof i=="undefined")continue;var s=i.fullsizeUrl,o;if(i.mediaType==="image"){if(t[s]){i.fsWidth=t[s].width;i.fsHeight=t[s].height}if(i.rsWidth===""){o={width:i.fsWidth,height:i.fsHeight};if(i.fsWidth>this.maxFullSizeDims.width||i.fsHeight>this.maxFullSizeDims.height){var u=new Pb.ClientImageRescaler(this.maxFullSizeDims);o=u.rescale(o)}if(o){i.rsWidth=o.width;i.rsHeight=o.height}}if(i.placeHold){var a=$("#"+i.placeHolderId);a.length>0&&a.attr("src",i.fullsizeUrl).css({width:i.rsWidth+"px",height:i.rsHeight+"px"});i.placeHold=!1}}}},move:function(e){var t=this.current;this.current=this.current+e;this.current<0&&(this.current=0);var n=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_offset_update",{currentOffset:this.current,oldOffset:t});$(document).trigger(n);this.testThresholds(e)},testThresholds:function(e){var t=20,n=this.current+t,r={isFirstRender:!1,dir:e},i=!1;if(e===1&&this.libDataMax<=n){i=!0;r.startOffset=this.libDataMax+1}if(i){var s=$.Event("Pb.Component.RecentUploads.RecentUploadsDetailManager::recentuploads_update",r);$(document).trigger(s)}},toggleMediaArrow:function(){var e=this.current,t=e===0?"hidden":"visible";this.mediaPrevArrow.css("visibility",t);$("#mediaTemplate").data("prev",t);$("#btnprev").toggleClass("disabled",e===0)}};$.extend(e.prototype,t);return e}();$.getObject("Pb",!0).StorageMessage=function(){function e(e){var t={name:e},n={url:"/action/notification/update",data:t};Pb.Ajax.ajax(n);Pb.Utilities.cookie("pbStorage",!0)}return{close:e}}();$.getObject("Pb.Component.Bandwidth",!0).BandwidthNotification=function(){function e(e){var t={name:"bandwidthNotificationShown"},n={url:"/action/notification/update",data:t,success:function(){e&&(location.href=e)}};Pb.Ajax.ajax(n)}function t(){$("#bandwidthWarning").on("close",function(){e()})}Pb.InitEventQueue.add(t);return{setViewed:e}}();